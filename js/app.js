// --------------------------------------
// 
//    _  _ _/ .  _  _/ /_ _  _  _        
//   /_|/_ / /|//_  / / //_ /_// /_/     
//   https://activetheory.net    _/      
// 
// --------------------------------------
//   7/18/18 3:55p
// --------------------------------------

if(typeof console==="undefined"){window.console={};console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}}window.performance=function(){if(window.performance&&window.performance.now)return window.performance;else return Date}();Date.now=Date.now||function(){return+new Date};if(!window.requestAnimationFrame){window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){const start=Date.now();return function(callback){window.setTimeout(()=>callback(Date.now()-start),1e3/60)}}()}()}window.defer=window.requestAnimationFrame;window.clearTimeout=function(){const _clearTimeout=clearTimeout;return function(ref){if(window.Timer)return Timer.__clearTimeout(ref)||_clearTimeout(ref);return _clearTimeout(ref)}}();window.requestIdleCallback=function(){const _requestIdleCallback=window.requestIdleCallback;return function(callback,max){if(_requestIdleCallback){return _requestIdleCallback(callback,max?{timeout:max}:null)}return defer(()=>{callback({didTimeout:false})},0)}}();window.onIdle=window.requestIdleCallback;if(typeof Float32Array=="undefined")Float32Array=Array;Math.sign=function(x){x=+x;if(x===0||isNaN(x))return Number(x);return x>0?1:-1};Math._round=Math.round;Math.round=function(value,precision=0){let p=Math.pow(10,precision);return Math._round(value*p)/p};Math._random=Math.random;Math.rand=Math.random=function(min,max,precision){if(!precision)precision=0;if(typeof min==="undefined")return Math._random();if(min===max)return min;min=min||0;max=max||1;if(precision==0)return Math.floor(Math._random()*(max+1-min)+min);return Math.round(min+Math._random()*(max-min),precision)};Math.degrees=function(radians){return radians*(180/Math.PI)};Math.radians=function(degrees){return degrees*(Math.PI/180)};Math.clamp=function(value,min=0,max=1){return Math.min(Math.max(value,Math.min(min,max)),Math.max(min,max))};Math.map=Math.range=function(value,oldMin=-1,oldMax=1,newMin=0,newMax=1,isClamp){const newValue=(value-oldMin)*(newMax-newMin)/(oldMax-oldMin)+newMin;if(isClamp)return Math.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax));return newValue};Math.mix=function(a,b,alpha){return a*(1-alpha)+b*alpha};Math.step=function(edge,value){return value<edge?0:1};Math.smoothStep=function(min,max,value){const x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)};Math.fract=function(value){return value-Math.floor(value)};Math.mod=function(value,n){return(value%n+n)%n};Array.prototype.shuffle=function(){let i=this.length-1;let temp,r;while(i!==0){r=Math.random(0,i,0);i-=1;temp=this[i];this[i]=this[r];this[r]=temp}return this};Array.storeRandom=function(arr){arr.randomStore=[]};Array.prototype.random=function(range){let value=Math.random(0,this.length-1);if(arguments.length&&!this.randomStore)Array.storeRandom(this);if(!this.randomStore)return this[value];if(range>this.length-1)range=this.length;if(range>1){while(!!~this.randomStore.indexOf(value))if((value+=1)>this.length-1)value=0;this.randomStore.push(value);if(this.randomStore.length>=range)this.randomStore.shift()}return this[value]};Array.prototype.remove=function(element){if(!this.indexOf)return;const index=this.indexOf(element);if(!!~index)return this.splice(index,1)};Array.prototype.last=function(){return this[this.length-1]};window.Promise=window.Promise||{};Promise.create=function(){const promise=new Promise((resolve,reject)=>{this.temp_resolve=resolve;this.temp_reject=reject});promise.resolve=this.temp_resolve;promise.reject=this.temp_reject;delete this.temp_resolve;delete this.temp_reject;return promise};String.prototype.includes=function(str){if(!Array.isArray(str))return!!~this.indexOf(str);for(let i=str.length-1;i>=0;i--){if(!!~this.indexOf(str[i]))return true}return false};String.prototype.strpos=function(str){console.warn("strpos deprecated: use .includes()");return this.includes(str)};String.prototype.clip=function(num,end){return this.length>num?this.slice(0,num)+end:this};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.replaceAll=function(find,replace){return this.split(find).join(replace)};if(!window.fetch||window.nativeHydra&&!window._AURA_)window.fetch=function(url,options){options=options||{};const promise=Promise.create();const request=new XMLHttpRequest;request.open(options.method||"get",url);for(let i in options.headers){request.setRequestHeader(i,options.headers[i])}request.onload=()=>{promise.resolve(response())};request.onerror=promise.reject;request.send(options.body);function response(){let keys=[],all=[],headers={},header;request.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,(m,key,value)=>{keys.push(key=key.toLowerCase());all.push([key,value]);header=headers[key];headers[key]=header?`${header},${value}`:value});return{ok:(request.status/200|0)==1,status:request.status,statusText:request.statusText,url:request.responseURL,clone:response,text:()=>Promise.resolve(request.responseText),json:()=>Promise.resolve(request.responseText).then(JSON.parse),xml:()=>Promise.resolve(request.responseXML),blob:()=>Promise.resolve(new Blob([request.response])),headers:{keys:()=>keys,entries:()=>all,get:n=>headers[n.toLowerCase()],has:n=>n.toLowerCase()in headers}}}return promise};window.get=function(url,options={credentials:"same-origin"}){let promise=Promise.create();options.method="GET";fetch(url,options).then(handleResponse).catch(promise.reject);function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then(text=>{if(text.charAt(0).includes(["[","{"])){try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}}else{promise.resolve(text)}})}return promise};window.post=function(url,body,options={}){let promise=Promise.create();options.method="POST";options.body=JSON.stringify(body);fetch(url,options).then(handleResponse).catch(promise.reject);function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then(text=>{if(text.charAt(0).includes(["[","{"])){try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}}else{promise.resolve(text)}})}return promise};window.Class=function(_class,_type,_static){const _this=this||window;const _name=_class.name||_class.toString().match(/function ?([^\(]+)/)[1];if(typeof _type==="function"){_static=_type;_type=null}_type=(_type||"").toLowerCase();if(!_type){_this[_name]=_class;_static&&_static()}else{if(_type=="static"){_this[_name]=new _class}else if(_type=="singleton"){_this[_name]=_class;(function(){let _instance;_this[_name].instance=function(a,b,c){if(!_instance)_instance=new _class(a,b,c);return _instance}}());_static&&_static()}}if(this&&this!==window)this[_name]._namespace=this.__namespace};window.Inherit=function(child,parent){const args=[].slice.call(arguments,2);parent.apply(child,args);const save={};for(let method in child){save[method]=child[method]}defer(()=>{for(let method in child){if(save[method]&&child[method]!==save[method]){child["_"+method]=save[method]}}})};window.Namespace=function(obj){if(typeof obj==="string"){window[obj]={Class,__namespace:obj}}else{obj.Class=Class;obj.__namespace=obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]}};window.Global={};window.THREAD=false;Class(function Hydra(){const _readyPromise=Promise.create();this.HASH=window.location.hash.slice(1);this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||location.hostname.split(".")[0]=="10"||location.hostname.split(".")[0]=="192");(function(){initLoad()}());function initLoad(){if(!document||!window)return setTimeout(initLoad,1);if(window._NODE_)return setTimeout(loaded,1);if(window._AURA_){if(!window.Main)return setTimeout(initLoad,1);else return setTimeout(loaded,1)}window.addEventListener("load",loaded,false)}function loaded(){window.removeEventListener("load",loaded,false);_readyPromise.resolve();if(window.Main){if(window._AURA_){setTimeout(()=>Hydra.Main=new window.Main,50);return}_readyPromise.then(()=>Hydra.Main=new window.Main)}}this.__triggerReady=function(){loaded()};this.ready=function(callback){if(!callback)return _readyPromise;_readyPromise.then(callback)}},"Static");Class(function Utils(){this.query=function(key){const str=decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(key).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"));if(!str.length||str=="0"||str=="false")return location.search.includes(key);return str};this.getConstructorName=function(obj){if(!obj)return obj;return obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]};this.nullObject=function(object){if(object.destroy||object.div){for(var key in object){if(typeof object[key]!=="undefined")object[key]=null}}return null};this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))};this.headsTails=function(n0,n1){return Math.random(0,1)?n1:n0};this.mergeObject=function(){var obj={};for(var i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o){obj[key]=o[key]}}return obj};this.timestamp=function(){var num=Date.now()+Math.random(0,99999,0);return num.toString()};this.randomColor=function(){var color="#"+Math.floor(Math.random()*16777215).toString(16);if(color.length<7)color=this.randomColor();return color};this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};this.padInt=function(num,digits,isLimit){if(isLimit)num=Math.min(num,Math.pow(10,digits)-1);let str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str}},"Static");Class(function Render(){const _this=this;const _render=[];let _last=performance.now();let _skipLimit=200;var rAF=requestAnimationFrame;(function(){if(THREAD)return;rAF(render)}());function render(tsl){let delta=tsl-_last;delta=Math.min(_skipLimit,delta);_last=tsl;_this.TIME=tsl;_this.DELTA=delta;for(let i=_render.length-1;i>=0;i--){var callback=_render[i];if(!callback){_render.remove(callback);continue}if(callback.fps){if(tsl-callback.last<1e3/callback.fps)continue;callback(++callback.frame);callback.last=tsl;continue}callback(tsl,delta)}if(!THREAD&&!_this.isPaused)rAF(render)}this.start=function(callback,fps){if(fps){callback.fps=fps;callback.last=-Infinity;callback.frame=-1}if(!~_render.indexOf(callback))_render.unshift(callback)};this.stop=function(callback){_render.remove(callback)};this.tick=function(){if(!THREAD)return;this.TIME=performance.now();render(this.TIME)};this.Worker=function(_callback,_budget=4){Inherit(this,Component);let _scope=this;let _elapsed=0;this.startRender(loop);function loop(){while(_elapsed<_budget){if(_scope.dead)return;const start=performance.now();_callback&&_callback();_elapsed+=performance.now()-start}_elapsed=0}this.stop=function(){this.dead=true;this.stopRender(loop)};this.pause=function(){this.stopRender(loop)};this.resume=function(){this.startRender(loop)}};this.pause=function(){_this.isPaused=true};this.resume=function(){if(!_this.isPaused)return;_this.isPaused=false;rAF(render)};this.useRAF=function(raf){rAF=raf}},"Static");Class(function Timer(){const _this=this;const _callbacks=[];const _discard=[];(function(){Render.start(loop)}());function loop(t,delta){for(let i=_discard.length-1;i>=0;i--){let obj=_discard[i];obj.callback=null;_callbacks.remove(obj)}if(_discard.length)_discard.length=0;for(let i=_callbacks.length-1;i>=0;i--){let obj=_callbacks[i];if(!obj){_callbacks.remove(obj);continue}if((obj.current+=delta)>=obj.time){obj.callback&&obj.callback.apply(this,obj.args);_discard.push(obj)}}}function find(ref){for(let i=_callbacks.length-1;i>-1;i--)if(_callbacks[i].ref==ref)return _callbacks[i]}this.__clearTimeout=function(ref){const obj=find(ref);if(!obj)return false;obj.callback=null;_callbacks.remove(obj);return true};this.create=function(callback,time){if(window._NODE_)return setTimeout(callback,time);const obj={time:Math.max(1,time||1),current:0,ref:Utils.timestamp(),callback:callback,args:[].slice.call(arguments,2)};_callbacks.unshift(obj);return obj.ref};window.defer=this.defer=function(callback){if(!callback){let promise=Promise.create();_this.create(promise.resolve,1);return promise}_this.create(callback,1)}},"static");Class(function Events(){this.events={};const _e={};const _linked=[];let _emitter;this.events.sub=function(obj,evt,callback){if(typeof obj!=="object"){callback=evt;evt=obj;obj=null}if(!obj){Events.emitter._addEvent(evt,!!callback.resolve?callback.resolve:callback,this);return callback}let emitter=obj.events.emitter();emitter._addEvent(evt,!!callback.resolve?callback.resolve:callback,this);emitter._saveLink(this);_linked.push(emitter);return callback};this.events.unsub=function(obj,evt,callback){if(typeof obj!=="object"){callback=evt;evt=obj;obj=null}if(!obj)return Events.emitter._removeEvent(evt,!!callback.resolve?callback.resolve:callback);obj.events.emitter()._removeEvent(evt,!!callback.resolve?callback.resolve:callback)};this.events.fire=function(evt,obj,isLocalOnly){obj=obj||_e;obj.target=this;Events.emitter._check(evt);if(_emitter&&_emitter._fireEvent(evt,obj))return;if(isLocalOnly)return;Events.emitter._fireEvent(evt,obj)};this.events.bubble=function(obj,evt){let _this=this;_this.sub(obj,evt,e=>_this.fire(evt,e))};this.events.destroy=function(){Events.emitter._destroyEvents(this);if(_linked)_linked.forEach(emitter=>emitter._destroyEvents(this));if(_emitter&&_emitter.links)_emitter.links.forEach(obj=>obj.events&&obj.events._unlink(_emitter));return null};this.events.emitter=function(){if(!_emitter)_emitter=Events.emitter.createLocalEmitter();return _emitter};this.events._unlink=function(emitter){_linked.remove(emitter)}},()=>{Events.emitter=new Emitter;Events.VISIBILITY="hydra_visibility";Events.HASH_UPDATE="hydra_hash_update";Events.COMPLETE="hydra_complete";Events.PROGRESS="hydra_progress";Events.UPDATE="hydra_update";Events.LOADED="hydra_loaded";Events.END="hydra_end";Events.FAIL="hydra_fail";Events.SELECT="hydra_select";Events.ERROR="hydra_error";Events.READY="hydra_ready";Events.RESIZE="hydra_resize";Events.CLICK="hydra_click";Events.HOVER="hydra_hover";Events.MESSAGE="hydra_message";Events.ORIENTATION="orientation";Events.BACKGROUND="background";Events.BACK="hydra_back";Events.PREVIOUS="hydra_previous";Events.NEXT="hydra_next";Events.RELOAD="hydra_reload";Events.FULLSCREEN="hydra_fullscreen";const _e={};function Emitter(){const prototype=Emitter.prototype;this.events=[];if(typeof prototype._check!=="undefined")return;prototype._check=function(evt){if(typeof evt=="undefined")throw"Undefined event"};prototype._addEvent=function(evt,callback,object){this._check(evt);this.events.push({evt,object,callback})};prototype._removeEvent=function(eventString,callback){this._check(eventString);let _this=this;let marked=false;for(let i=this.events.length-1;i>=0;i--){if(this.events[i].evt==eventString&&this.events[i].callback==callback){this.events[i].markedForDeletion=true;marked=true}}if(marked)defer(()=>_this._sweepEvents())};prototype._sweepEvents=function(){for(let i=0;i<this.events.length;i++){if(this.events[i].markedForDeletion)this.events.remove(this.events[i])}};prototype._fireEvent=function(eventString,obj){if(this._check)this._check(eventString);obj=obj||_e;let called=false;for(let i=0;i<this.events.length;i++){let evt=this.events[i];if(evt.evt==eventString&&!evt.markedForDeletion){evt.callback(obj);called=true}}return called};prototype._destroyEvents=function(object){for(var i=this.events.length-1;i>=0;i--){if(this.events[i].object==object)this.events.splice(i,1)[0]=null}};prototype._saveLink=function(obj){if(!this.links)this.links=[];if(!~this.links.indexOf(obj))this.links.push(obj)};prototype.createLocalEmitter=function(){return new Emitter}}Hydra.ready(()=>{(function(){let _lastTime=performance.now();let _last;Timer.create(addVisibilityHandler,250);function addVisibilityHandler(){let hidden,eventName;[["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["hidden","visibilitychange"]].forEach(d=>{if(typeof document[d[0]]!=="undefined"){hidden=d[0];eventName=d[1]}});if(!eventName){const root=Device.browser=="ie"?document:window;root.onfocus=onfocus;root.onblur=onblur;return}document.addEventListener(eventName,()=>{const time=performance.now();if(time-_lastTime>10){if(document[hidden]===false)onfocus();else onblur()}_lastTime=time})}function onfocus(){if(_last!="focus")Events.emitter._fireEvent(Events.VISIBILITY,{type:"focus"});_last="focus"}function onblur(){if(_last!="blur")Events.emitter._fireEvent(Events.VISIBILITY,{type:"blur"});_last="blur"}}());window.Stage=window.Stage||{};updateStage();window.onresize=function(){updateStage();Events.emitter._fireEvent(Events.RESIZE)};window.onorientationchange=window.onresize;defer(window.onresize);function updateStage(){Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth;Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight}})});Class(function Dispatch(){const _instances={};this.registerInstance=function(object){let ref=Utils.getConstructorName(object);_instances[ref]=object;object.removeDispatch=function(){delete _instances[ref]}};this.lookup=function(_class){let name=_class.toString().match(/function ([^\(]+)/)[1];return _instances[name]||console.error(`No instance ${name} found`)}},"static");Class(function Device(){var _this=this;this.agent=navigator.userAgent.toLowerCase();this.detect=function(match){return this.agent.includes(match)};this.touchCapable=!!("ontouchstart"in window);this.pixelRatio=window.devicePixelRatio;this.system={};this.system.retina=window.devicePixelRatio>1;this.system.webworker=typeof window.Worker!=="undefined";this.system.offline=typeof window.applicationCache!=="undefined";if(!window._NODE_)this.system.geolocation=typeof navigator.geolocation!=="undefined";if(!window._NODE_)this.system.pushstate=typeof window.history.pushState!=="undefined";this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);this.system.language=window.navigator.userLanguage||window.navigator.language;this.system.webaudio=typeof window.AudioContext!=="undefined";this.system.vr=function(){if(!navigator.getVRDisplays)return false;navigator.getVRDisplays().then(displays=>{_this.system.vr=displays.length>0})}();try{this.system.localStorage=typeof window.localStorage!=="undefined"}catch(e){this.system.localStorage=false}this.system.fullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;this.system.os=function(){if(_this.detect(["ipad","iphone"]))return"ios";if(_this.detect(["android","kindle"]))return"android";if(_this.detect(["blackberry"]))return"blackberry";if(_this.detect(["mac os"]))return"mac";if(_this.detect(["windows","iemobile"]))return"windows";if(_this.detect(["linux"]))return"linux";return"unknown"}();this.system.version=function(){try{if(_this.system.os=="ios"){var num=_this.agent.split("os ")[1].split("_");var main=num[0];var sub=num[1].split(" ")[0];return Number(main+"."+sub)}if(_this.system.os=="android"){var version=_this.agent.split("android ")[1].split(";")[0];if(version.length>3)version=version.slice(0,-2);if(version.charAt(version.length-1)==".")version=version.slice(0,-1);return Number(version)}if(_this.system.os=="blackberry"){if(_this.agent.includes("rv:11"))return 11;return Number(_this.agent.split("windows phone ")[1].split(";")[0])}}catch(e){}return-1}();this.system.browser=function(){if(_this.system.os=="ios"){if(_this.detect(["twitter","fbios"]))return"social";if(_this.detect(["crios"]))return"chrome";if(_this.detect(["safari"]))return"safari";return"unknown"}if(_this.system.os=="android"){if(_this.detect(["twitter","fb","facebook"]))return"social";if(_this.detect(["chrome"]))return"chrome";if(_this.detect(["firefox"]))return"firefox";return"browser"}if(_this.detect(["msie"]))return"ie";if(_this.detect(["trident"])&&_this.detect(["rv:"]))return"ie";if(_this.detect(["windows"])&&_this.detect(["edge"]))return"ie";if(_this.detect(["chrome"]))return"chrome";if(_this.detect(["safari"]))return"safari";if(_this.detect(["firefox"]))return"firefox";return"unknown"}();this.system.browserVersion=function(){try{if(_this.system.browser=="chrome")return Number(_this.agent.split("chrome/")[1].split(".")[0]);if(_this.system.browser=="firefox")return Number(_this.agent.split("firefox/")[1].split(".")[0]);if(_this.system.browser=="safari")return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if(_this.system.browser=="ie"){if(_this.detect(["msie"]))return Number(_this.agent.split("msie ")[1].split(".")[0]);if(_this.detect(["rv:"]))return Number(_this.agent.split("rv:")[1].split(".")[0]);return Number(_this.agent.split("edge/")[1].split(".")[0])}}catch(e){return-1}}();this.mobile=!window._NODE_&&(!!("ontouchstart"in window||"onpointerdown"in window)&&this.detect(["ios","iphone","ipad","windows phone","android","blackberry"]))?{}:false;if(this.mobile&&this.detect(["windows"])&&!this.detect(["touch"]))this.mobile=false;if(this.mobile){this.mobile.tablet=Math.max(window.screen?screen.width:window.innerWidth,window.screen?screen.height:window.innerHeight)>1e3;this.mobile.phone=!this.mobile.tablet;this.mobile.pwa=function(){if(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches)return true;if(window.navigator.standalone)return true;return false}();Hydra.ready(()=>{_this.mobile.native=function(){if(Mobile.NativeCore&&Mobile.NativeCore.active)return true;if(window._AURA_)return true;return false}()})}this.media={};this.media.audio=function(){if(!!document.createElement("audio").canPlayType){return _this.detect(["firefox","opera"])?"ogg":"mp3"}else{return false}}();this.media.video=function(){var vid=document.createElement("video");if(!!vid.canPlayType){if(Device.mobile)return"mp4";if(_this.system.browser=="chrome")return"webm";if(_this.system.browser=="firefox"||_this.system.browser=="opera"){if(vid.canPlayType('video/webm; codecs="vorbis,vp8"'))return"webm";return"ogv"}return"mp4"}else{return false}}();this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection);this.graphics={};this.graphics.webgl=function(){Object.defineProperty(_this.graphics,"webgl",{get:()=>{if(window._AURA_){_this.graphics._webglContext={detect:_=>{return false}};return _this.graphics._webglContext}if(_this.graphics._webglContext)return _this.graphics._webglContext;try{const names=["webgl","experimental-webgl","webkit-3d","moz-webgl"];const canvas=document.createElement("canvas");let gl;for(let i=0;i<names.length;i++){gl=canvas.getContext(names[i]);if(gl)break}let info=gl.getExtension("WEBGL_debug_renderer_info");let output={};if(info){let gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}output.renderer=gl.getParameter(gl.RENDERER).toLowerCase();output.version=gl.getParameter(gl.VERSION).toLowerCase();output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase();output.extensions=gl.getSupportedExtensions();output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().includes(matches))return true;if(output.version&&output.version.toLowerCase().includes(matches))return true;for(let i=0;i<output.extensions.length;i++){if(output.extensions[i].toLowerCase().includes(matches))return true}return false};_this.graphics._webglContext=output;return output}catch(e){return false}},set:v=>{}})}();this.graphics.canvas=function(){var canvas=document.createElement("canvas");return canvas.getContext?true:false}();const checkForStyle=function(){let _tagDiv;return function(prop){_tagDiv=_tagDiv||document.createElement("div");const vendors=["Khtml","ms","O","Moz","Webkit"];if(prop in _tagDiv.style)return true;prop=prop.replace(/^[a-z]/,val=>{return val.toUpperCase()});for(let i=vendors.length-1;i>=0;i--)if(vendors[i]+prop in _tagDiv.style)return true;return false}}();this.styles={};this.styles.filter=checkForStyle("filter");this.styles.blendMode=checkForStyle("mix-blend-mode");this.tween={};this.tween.transition=checkForStyle("transition");this.tween.css2d=checkForStyle("transform");this.tween.css3d=checkForStyle("perspective")},"Static");Class(function Component(){Inherit(this,Events);const _this=this;const _setters={};const _flags={};const _timers=[];const _loops=[];this.classes={};function defineSetter(_this,prop){_setters[prop]={};Object.defineProperty(_this,prop,{set:function(v){if(_setters[prop]&&_setters[prop].s)_setters[prop].s.call(_this,v);v=null},get:function(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}this.set=function(prop,callback){if(!_setters[prop])defineSetter(this,prop);_setters[prop].s=callback};this.get=function(prop,callback){if(!_setters[prop])defineSetter(this,prop);_setters[prop].g=callback};this.initClass=function(clss){if(!clss)throw`unable to locate class`;const args=[].slice.call(arguments,1);const child=Object.create(clss.prototype);child.parent=this;clss.apply(child,args);if(child.destroy){const id=Utils.timestamp();this.classes[id]=child;this.classes[id].__id=id}if(child.element){const last=arguments[arguments.length-1];if(Array.isArray(last)&&last.length==1&&last[0]instanceof HydraObject)last[0].add(child.element);else if(this.element&&last!==null)this.element.add(child.element)}if(child.group){const last=arguments[arguments.length-1];if(this.group&&last!==null)this.group.add(child.group)}return child};this.delayedCall=function(callback,time){const args=[].slice.call(arguments,2);const timer=Timer.create(()=>{if(!_this||!_this.destroy)return;callback&&callback.apply(this,args)},time);_timers.push(timer);if(_timers.length>50)_timers.shift();return timer};this.clearTimers=function(){for(let i=_timers.length-1;i>=0;i--)clearTimeout(_timers[i]);_timers.length=0};this.startRender=function(callback,fps){_loops.push(callback);Render.start(callback,fps)};this.stopRender=function(callback){_loops.remove(callback);Render.stop(callback)};this.clearRenders=function(){for(let i=_loops.length-1;i>=0;i--)_this.stopRender(_loops[i])};this.wait=function(object,key,callback){const promise=Promise.create();if(typeof object==="number"&&!key){_this.delayedCall(promise.resolve,object);return promise}if(typeof object=="function"&&typeof callback!=="function"){let _object=object;object=key;key=callback;callback=_object}callback=callback||promise.resolve;_this.startRender(test);function test(){if(!object)return _this.stopRender(test);if(!!object[key]){callback();_this.stopRender(test)}}return promise};this.flag=function(name,value,time){if(typeof value!=="undefined"){_flags[name]=value;if(time){this.delayedCall(()=>{_flags[name]=!_flags[name]},time)}}else{return _flags[name]}};this.destroy=function(){if(this.removeDispatch)this.removeDispatch();if(this.onDestroy)this.onDestroy();for(let id in this.classes){var clss=this.classes[id];if(clss&&clss.destroy)clss.destroy()}this.classes=null;this.clearRenders&&this.clearRenders();this.clearTimers&&this.clearTimers();if(this.events)this.events=this.events.destroy();if(this.parent&&this.parent.__destroyChild)this.parent.__destroyChild(this.__id);return Utils.nullObject(this)};this.__destroyChild=function(name){delete this.classes[name]}});Class(function Model(){Inherit(this,Component);Namespace(this);const _this=this;const _storage={};let _data=0;let _triggered=0;this.push=function(name,val){_storage[name]=val};this.pull=function(name){return _storage[name]};this.waitForData=this.promiseData=function(num=1){_data+=num};this.fulfillData=this.resolveData=function(){_triggered++;if(_triggered==_data){_this.dataReady=true}};this.ready=function(callback){let promise=Promise.create();if(callback)promise.then(callback);_this.wait(_this,"dataReady").then(promise.resolve);return promise};this.initWithData=function(data){_this.STATIC_DATA=data;for(var key in _this){var model=_this[key];var init=false;for(var i in data){if(i.toLowerCase().replace(/-/g,"")==key.toLowerCase()){init=true;if(model.init)model.init(data[i])}}if(!init&&model.init)model.init()}_this.init&&_this.init(data)};this.loadData=function(url,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;var _this=this;get(url+"?"+Utils.timestamp()).then(d=>{defer(()=>{_this.initWithData(d);callback(d)})});return promise}});Class(function Modules(){const _modules={};(function(){defer(exec)}());function exec(){for(let m in _modules){for(let key in _modules[m]){let module=_modules[m][key];if(module._ready)continue;module._ready=true;if(module.exec)module.exec()}}}function requireModule(root,path){let module=_modules[root];if(!module)throw`Module ${root} not found`;module=module[path];if(!module._ready){module._ready=true;if(module.exec)module.exec()}return module}this.Module=function(module){let m=new module;let name=module.toString().slice(0,100).match(/function ([^\(]+)/);if(name){m._ready=true;name=name[1];_modules[name]={index:m}}else{if(!_modules[m.module])_modules[m.module]={};_modules[m.module][m.path]=m}};this.require=function(path){let root;if(!path.includes("/")){root=path;path="index"}else{root=path.split("/")[0];path=path.replace(root+"/","")}return requireModule(root,path).exports};window.Module=this.Module;if(!window._NODE_||window.EJECTA){window.requireNative=window.require;window.require=this.require}},"Static");Class(function LinkedList(){var prototype=LinkedList.prototype;this.length=0;this.first=null;this.last=null;this.current=null;this.prev=null;if(typeof prototype.push!=="undefined")return;prototype.push=function(obj){if(!this.first){this.first=obj;this.last=obj;obj.__prev=obj;obj.__next=obj}else{obj.__next=this.first;obj.__prev=this.last;this.last.__next=obj;this.last=obj}this.length++};prototype.remove=function(obj){if(!obj||!obj.__next)return;if(this.length<=1){this.empty()}else{if(obj==this.first){this.first=obj.__next;this.last.__next=this.first;this.first.__prev=this.last}else if(obj==this.last){this.last=obj.__prev;this.last.__next=this.first;this.first.__prev=this.last}else{obj.__prev.__next=obj.__next;obj.__next.__prev=obj.__prev}this.length--}obj.__prev=null;obj.__next=null};prototype.empty=function(){this.first=null;this.last=null;this.current=null;this.prev=null;this.length=0};prototype.start=function(){this.current=this.first;this.prev=this.current;return this.current};prototype.next=function(){if(!this.current)return;this.current=this.current.__next;if(this.length==1||this.prev.__next==this.first)return;this.prev=this.current;return this.current};prototype.destroy=function(){Utils.nullObject(this);return null}});Class(function ObjectPool(_type,_number=10){var _pool=[];this.array=_pool;(function(){if(_type)for(var i=0;i<_number;i++)_pool.push(new _type)}());this.get=function(){return _pool.shift()||(_type?new _type:null)};this.empty=function(){_pool.length=0};this.put=function(obj){if(obj)_pool.push(obj)};this.insert=function(array){if(typeof array.push==="undefined")array=[array];for(var i=0;i<array.length;i++)_pool.push(array[i])};this.length=function(){return _pool.length};this.destroy=function(){for(let i=_pool.length-1;i>=0;i--)if(_pool[i].destroy)_pool[i].destroy();return _pool=null}});Hydra.ready(function(){window.__window=$(window);window.__document=$(document);window.__body=$(document.getElementsByTagName("body")[0]);window.Stage=!!window.Stage&&!!window.Stage.style?$(window.Stage):__body.create("#Stage");Stage.size("100%");Stage.__useFragment=true;Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth;Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight});Class(function CSS(){var _this=this;var _obj,_style,_needsUpdate;Hydra.ready(function(){_style="";_obj=document.createElement("style");_obj.type="text/css";document.getElementsByTagName("head")[0].appendChild(_obj)});function objToCSS(key){var match=key.match(/[A-Z]/);var camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex);var end=key.slice(camelIndex);key=start+"-"+end.toLowerCase()}return key}function cssToObj(key){var match=key.match(/\-/);var camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex);var end=key.slice(camelIndex).slice(1);var letter=end.charAt(0);end=end.slice(1);end=letter.toUpperCase()+end;key=start+end}return key}function setHTML(){_obj.innerHTML=_style;_needsUpdate=false}this._read=function(){return _style};this._write=function(css){_style=css;if(!_needsUpdate){_needsUpdate=true;defer(setHTML)}};this.style=function(selector,obj){var s=selector+" {";for(var key in obj){var prop=objToCSS(key);var val=obj[key];if(typeof val!=="string"&&key!="opacity")val+="px";s+=prop+":"+val+"!important;"}s+="}";_this._write(_style+s)};this.get=function(selector,prop){var values=new Object;var string=_obj.innerHTML.split(selector+" {");for(var i=0;i<string.length;i++){var str=string[i];if(!str.length)continue;var split=str.split("!important;");for(var j in split){if(split[j].includes(":")){var fsplit=split[j].split(":");if(fsplit[1].slice(-2)=="px"){fsplit[1]=Number(fsplit[1].slice(0,-2))}values[cssToObj(fsplit[0])]=fsplit[1]}}}if(!prop)return values;else return values[prop]};this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""});__body.addChild($clone);var width=$clone.div.offsetWidth;var height=$clone.div.offsetHeight;$clone.remove();return{width:width,height:height}};this.prefix=function(style){return _this.styles.vendor==""?style.charAt(0).toLowerCase()+style.slice(1):_this.styles.vendor+style};this._toCSS=objToCSS},"Static");Class(function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList;this.__useFragment=_useFragment;this._initSelector(_selector,_type,_exists)},()=>{var prototype=HydraObject.prototype;prototype._initSelector=function(_selector,_type,_exists){if(_selector&&typeof _selector!=="string"){this.div=_selector}else{var first=_selector?_selector.charAt(0):null;var name=_selector?_selector.slice(1):null;if(first!="."&&first!="#"){name=_selector;first="."}if(!_exists){this._type=_type||"div";if(this._type=="svg"){this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type);this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")}else{this.div=document.createElement(this._type);if(first){if(first=="#")this.div.id=name;else this.div.className=name}}}else{if(first!="#")throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}}this.div.hydraObject=this};prototype.add=function(child){var div=this.div;var _this=this;var createFrag=function(){if(_this.__useFragment){if(!_this._fragment){_this._fragment=document.createDocumentFragment();defer(function(){if(!_this._fragment||!_this.div)return _this._fragment=null;_this.div.appendChild(_this._fragment);_this._fragment=null})}div=_this._fragment}};if(child.element&&child.element instanceof HydraObject){createFrag();div.appendChild(child.element.div);this._children.push(child.element);child.element._parent=this;child.element.div.parentNode=this.div}else if(child.div){createFrag();div.appendChild(child.div);this._children.push(child);child._parent=this;child.div.parentNode=this.div}else if(child.nodeName){createFrag();div.appendChild(child);child.parentNode=this.div}return this};prototype.clone=function(){return $(this.div.cloneNode(true))};prototype.create=function(name,type){var $obj=$(name,type);this.add($obj);return $obj};prototype.empty=function(){var child=this._children.start();while(child){if(child&&child.remove)child.remove();child=this._children.next()}this.div.innerHTML="";return this};prototype.parent=function(){return this._parent};prototype.children=function(){return this.div.children?this.div.children:this.div.childNodes};prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){};if(!keep)this._children.remove(object)};prototype.remove=prototype.destroy=function(){this.removed=true;var parent=this._parent;if(!!(parent&&!parent.removed&&parent.removeChild))parent.removeChild(this,true);var child=this._children.start();while(child){if(child&&child.remove)child.remove();child=this._children.next()}this._children.destroy();this.div.hydraObject=null;Utils.nullObject(this)};window.$=function(selector,type,exists){return new HydraObject(selector,type,exists)};$.fn=HydraObject.prototype});(function(){$.fn.text=function(text){if(typeof text!=="undefined"){if(this.__cacheText!=text)this.div.textContent=text;this.__cacheText=text;return this}else{return this.div.textContent}};$.fn.html=function(text,force){if(text&&!text.includes("<")&&!force)return this.text(text);if(typeof text!=="undefined"){this.div.innerHTML=text;return this}else{return this.div.innerHTML}};$.fn.hide=function(){this.div.style.display="none";return this};$.fn.show=function(){this.div.style.display="";return this};$.fn.visible=function(){this.div.style.visibility="visible";return this};$.fn.invisible=function(){this.div.style.visibility="hidden";return this};$.fn.setZ=function(z){this.div.style.zIndex=z;return this};$.fn.clearAlpha=function(){this.div.style.opacity="";return this};$.fn.size=function(w,h,noScale){if(typeof w==="string"){if(typeof h==="undefined")h="100%";else if(typeof h!=="string")h=h+"px";this.div.style.width=w;this.div.style.height=h}else{this.div.style.width=w+"px";this.div.style.height=h+"px";if(!noScale)this.div.style.backgroundSize=w+"px "+h+"px"}this.width=w;this.height=h;return this};$.fn.mouseEnabled=function(bool){this.div.style.pointerEvents=bool?"auto":"none";return this};$.fn.fontStyle=function(family,size,color,style){var font={};if(family)font.fontFamily=family;if(size)font.fontSize=size;if(color)font.color=color;if(style)font.fontStyle=style;this.css(font);return this};$.fn.textStroke=function(size,color){if(Device.system.browser==="ie"&&Device.system.browserVersion<=11){if(!color&&size.indexOf(" "))color=size.split(" ")[1];if(color)this.css({color:color})}else{if(!color&&typeof size==="string")this.div.style["textStroke"]=this.div.style["WebkitTextStroke"]=size;if(size&&color)this.div.style["textStroke"]=this.div.style["WebkitTextStroke"]=size+"px "+color}return this};$.fn.bg=function(src,x,y,repeat){if(!src)return this;if(src.includes("."))src=Assets.getPath(src);if(!src.includes("."))this.div.style.backgroundColor=src;else this.div.style.backgroundImage="url("+src+")";if(typeof x!=="undefined"){x=typeof x=="number"?x+"px":x;y=typeof y=="number"?y+"px":y;this.div.style.backgroundPosition=x+" "+y}if(repeat){this.div.style.backgroundSize="";this.div.style.backgroundRepeat=repeat}if(x=="cover"||x=="contain"){this.div.style.backgroundSize=x;this.div.style.backgroundPosition=typeof y!="undefined"?y+" "+repeat:"center"}return this};$.fn.center=function(x,y,noPos){var css={};if(typeof x==="undefined"){css.left="50%";css.top="50%";css.marginLeft=-this.width/2;css.marginTop=-this.height/2}else{if(x){css.left="50%";css.marginLeft=-this.width/2}if(y){css.top="50%";css.marginTop=-this.height/2}}if(noPos){delete css.left;delete css.top}this.css(css);return this};$.fn.mask=function(arg){this.div.style[CSS.prefix("Mask")]=(arg.includes(".")?"url("+arg+")":arg)+" no-repeat";this.div.style[CSS.prefix("MaskSize")]="contain";return this};$.fn.blendMode=function(mode,bg){if(bg){this.div.style["background-blend-mode"]=mode}else{this.div.style["mix-blend-mode"]=mode}return this};$.fn.css=function(obj,value){if(typeof value=="boolean"){value=null}if(typeof obj!=="object"){if(!value){var style=this.div.style[obj];if(typeof style!=="number"){if(!style)return false;if(style.includes("px"))style=Number(style.slice(0,-2));if(obj=="opacity")style=!isNaN(Number(this.div.style.opacity))?Number(this.div.style.opacity):1}if(!style)style=0;return style}else{this.div.style[obj]=value;return this}}TweenManager._clearCSSTween(this);for(var type in obj){var val=obj[type];if(!(typeof val==="string"||typeof val==="number"))continue;if(typeof val!=="string"&&type!="opacity"&&type!="zIndex")val+="px";this.div.style[type]=val}return this};$.fn.transform=function(props){if(this.multiTween&&this.cssTweens&&this._cssTweens.length>1&&this.__transformTime&&Render.TIME-this.__transformTime<15)return;this.__transformTime=Render.TIME;TweenManager._clearCSSTween(this);if(Device.tween.css2d){if(!props){props=this}else{for(var key in props){if(typeof props[key]==="number")this[key]=props[key]}}var transformString=TweenManager._parseTransform(props);if(this.__transformCache!=transformString){this.div.style[CSS.styles.vendorTransform]=transformString;this.__transformCache=transformString}}return this};$.fn.willChange=function(props){if(typeof props==="boolean"){if(props===true)this._willChangeLock=true;else this._willChangeLock=false}else{if(this._willChangeLock)return}var string=typeof props==="string";if((!this._willChange||string)&&typeof props!=="null"){this._willChange=true;this.div.style["will-change"]=string?props:CSS.transformProperty+", opacity"}else{this._willChange=false;this.div.style["will-change"]=""}};$.fn.backfaceVisibility=function(visible){if(visible)this.div.style[CSS.prefix("BackfaceVisibility")]="visible";else this.div.style[CSS.prefix("BackfaceVisibility")]="hidden"};$.fn.enable3D=function(perspective,x,y){if(!Device.tween.css3d)return this;this.div.style[CSS.prefix("TransformStyle")]="preserve-3d";if(perspective)this.div.style[CSS.prefix("Perspective")]=perspective+"px";if(typeof x!=="undefined"){x=typeof x==="number"?x+"px":x;y=typeof y==="number"?y+"px":y;this.div.style[CSS.prefix("PerspectiveOrigin")]=x+" "+y}return this};$.fn.disable3D=function(){this.div.style[CSS.prefix("TransformStyle")]="";this.div.style[CSS.prefix("Perspective")]="";return this};$.fn.transformPoint=function(x,y,z){var origin="";if(typeof x!=="undefined")origin+=typeof x==="number"?x+"px ":x+" ";if(typeof y!=="undefined")origin+=typeof y==="number"?y+"px ":y+" ";if(typeof z!=="undefined")origin+=typeof z==="number"?z+"px":z;this.div.style[CSS.prefix("TransformOrigin")]=origin;return this};$.fn.tween=function(props,time,ease,delay,callback,manual){if(typeof delay==="boolean"){manual=delay;delay=0;callback=null}else if(typeof delay==="function"){callback=delay;delay=0}if(typeof callback==="boolean"){manual=callback;callback=null}if(!delay)delay=0;var usePromise=null;if(callback&&callback instanceof Promise){usePromise=callback;callback=callback.resolve}var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween};$.fn.clearTransform=function(){if(typeof this.x==="number")this.x=0;if(typeof this.y==="number")this.y=0;if(typeof this.z==="number")this.z=0;if(typeof this.scale==="number")this.scale=1;if(typeof this.scaleX==="number")this.scaleX=1;if(typeof this.scaleY==="number")this.scaleY=1;if(typeof this.rotation==="number")this.rotation=0;if(typeof this.rotationX==="number")this.rotationX=0;if(typeof this.rotationY==="number")this.rotationY=0;if(typeof this.rotationZ==="number")this.rotationZ=0;if(typeof this.skewX==="number")this.skewX=0;if(typeof this.skewY==="number")this.skewY=0;this.div.style[CSS.styles.vendorTransform]="";return this};$.fn.clearTween=function(){if(this._cssTween)this._cssTween.stop();if(this._mathTween)this._mathTween.stop();return this};$.fn.stopTween=function(){console.warn(".stopTween deprecated. use .clearTween instead");return this.clearTween()};$.fn.keypress=function(callback){this.div.onkeypress=function(e){e=e||window.event;e.code=e.keyCode?e.keyCode:e.charCode;if(callback)callback(e)}};$.fn.keydown=function(callback){this.div.onkeydown=function(e){e=e||window.event;e.code=e.keyCode;if(callback)callback(e)}};$.fn.keyup=function(callback){this.div.onkeyup=function(e){e=e||window.event;e.code=e.keyCode;if(callback)callback(e)}};$.fn.attr=function(attr,value){if(attr&&value){if(value=="")this.div.removeAttribute(attr);else this.div.setAttribute(attr,value)}else if(attr){return this.div.getAttribute(attr)}return this};$.fn.val=function(value){if(typeof value==="undefined"){return this.div.value}else{this.div.value=value}return this};$.fn.change=function(callback){var _this=this;if(this._type=="select"){this.div.onchange=function(){callback({object:_this,value:_this.div.value||""})}}};$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id);var svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'">'+'<use xlink:href="#'+config.id+'" x="0" y="0" />'+"</svg>";this.html(svgHTML,true)};$.fn.overflowScroll=function(dir){if(!Device.mobile)return;var x=!!dir.x;var y=!!dir.y;var overflow={"-webkit-overflow-scrolling":"touch"};if(!x&&!y||x&&y)overflow.overflow="scroll";if(!x&&y){overflow.overflowY="scroll";overflow.overflowX="hidden"}if(x&&!y){overflow.overflowX="scroll";overflow.overflowY="hidden"}this.css(overflow);Mobile._addOverflowScroll(this)};$.fn.removeOverflowScroll=function(){if(!Device.mobile)return;this.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""});Mobile._removeOverflowScroll(this)}}());(function(){var windowsPointer=!!window.MSGesture;var translateEvent=function(evt){if(windowsPointer){switch(evt){case"touchstart":return"pointerdown";break;case"touchmove":return"MSGestureChange";break;case"touchend":return"pointerup";break}}return evt};var convertTouchEvent=function(e){var touchEvent={};touchEvent.x=0;touchEvent.y=0;if(e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches){if(e.touches.length){touchEvent.x=e.touches[0].pageX;touchEvent.y=e.touches[0].pageY}else{touchEvent.x=e.changedTouches[0].pageX;touchEvent.y=e.changedTouches[0].pageY}}else{touchEvent.x=e.pageX;touchEvent.y=e.pageY}if(Mobile.ScreenLock&&Mobile.ScreenLock.isActive&&Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(window.orientation==90||window.orientation===0){var x=touchEvent.y;touchEvent.y=touchEvent.x;touchEvent.x=Stage.width-x}if(window.orientation==-90||window.orientation===180){var y=touchEvent.x;touchEvent.x=touchEvent.y;touchEvent.y=Stage.height-y}}return touchEvent};$.fn.click=function(callback){var _this=this;function click(e){if(!_this.div)return false;if(Mouse._preventClicks)return false;e.object=_this.div.className=="hit"?_this.parent():_this;e.action="click";if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e);if(Mouse.autoPreventClicks)Mouse.preventClicks()}this.div.addEventListener(translateEvent("click"),click,true);this.div.style.cursor="pointer";return this};$.fn.hover=function(callback){var _this=this;var _over=false;var _time;function hover(e){if(!_this.div)return false;var time=performance.now();var original=e.toElement||e.relatedTarget;if(_time&&time-_time<5){_time=time;return false}_time=time;e.object=_this.div.className=="hit"?_this.parent():_this;switch(e.type){case"mouseout":e.action="out";break;case"mouseleave":e.action="out";break;default:e.action="over";break}if(_over){if(Mouse._preventClicks)return false;if(e.action=="over")return false;if(e.action=="out"){if(isAChild(_this.div,original))return false}_over=false}else{if(e.action=="out")return false;_over=true}if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e)}function isAChild(div,object){var len=div.children.length-1;for(var i=len;i>-1;i--){if(object==div.children[i])return true}for(i=len;i>-1;i--){if(isAChild(div.children[i],object))return true}}this.div.addEventListener(translateEvent("mouseover"),hover,true);this.div.addEventListener(translateEvent("mouseout"),hover,true);return this};$.fn.press=function(callback){var _this=this;function press(e){if(!_this.div)return false;e.object=_this.div.className=="hit"?_this.parent():_this;switch(e.type){case"mousedown":e.action="down";break;default:e.action="up";break}if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e)}this.div.addEventListener(translateEvent("mousedown"),press,true);this.div.addEventListener(translateEvent("mouseup"),press,true);return this};$.fn.bind=function(evt,callback){this._events=this._events||{};if(windowsPointer&&this==__window){return Stage.bind(evt,callback)}if(evt=="touchstart"){if(!Device.mobile){if(Device.touchCapable)this.bind("mousedown",callback);else evt="mousedown"}}else if(evt=="touchmove"){if(!Device.mobile){if(Device.touchCapable)this.bind("mousemove",callback);else evt="mousemove"}if(windowsPointer&&!this.div.msGesture){this.div.msGesture=new MSGesture;this.div.msGesture.target=this.div}}else if(evt=="touchend"){if(!Device.mobile){if(Device.touchCapable)this.bind("mouseup",callback);else evt="mouseup"}}this._events["bind_"+evt]=this._events["bind_"+evt]||[];var _events=this._events["bind_"+evt];var e={};var target=this.div;e.callback=callback;e.target=this.div;_events.push(e);function touchEvent(e){if(windowsPointer&&target.msGesture&&evt=="touchstart"){target.msGesture.addPointer(e.pointerId)}var touch=convertTouchEvent(e);if(windowsPointer){var windowsEvt=e;e={};e.x=Number(windowsEvt.pageX||windowsEvt.clientX);e.y=Number(windowsEvt.pageY||windowsEvt.clientY);e.target=windowsEvt.target;e.currentTarget=windowsEvt.currentTarget;e.path=[];var node=e.target;while(node){e.path.push(node);node=node.parentElement||null}e.windowsPointer=true}else{e.x=touch.x;e.y=touch.y}for(var i=0;i<_events.length;i++){var ev=_events[i];if(ev.target==e.currentTarget){ev.callback(e)}}}if(!this._events["fn_"+evt]){this._events["fn_"+evt]=touchEvent;this.div.addEventListener(translateEvent(evt),touchEvent,true)}return this};$.fn.unbind=function(evt,callback){this._events=this._events||{};if(windowsPointer&&this==__window){return Stage.unbind(evt,callback)}if(evt=="touchstart"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mousedown",callback);else evt="mousedown"}}else if(evt=="touchmove"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mousemove",callback);else evt="mousemove"}}else if(evt=="touchend"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mouseup",callback);else evt="mouseup"}}var _events=this._events["bind_"+evt];if(!_events)return this;for(var i=0;i<_events.length;i++){var ev=_events[i];if(ev.callback==callback)_events.splice(i,1)}if(this._events["fn_"+evt]&&!_events.length){this.div.removeEventListener(translateEvent(evt),this._events["fn_"+evt],Device.mobile?{passive:true}:true);this._events["fn_"+evt]=null}return this};$.fn.interact=function(overCallback,clickCallback){if(!this.hit){this.hit=$(".hit");this.hit.css({width:"100%",height:"100%",zIndex:99999,top:0,left:0,position:"absolute"});this.add(this.hit)}if(!Device.mobile)this.hit.hover(overCallback).click(clickCallback);else this.hit.touchClick(overCallback,clickCallback)};$.fn.touchSwipe=function(callback,distance){if(!window.addEventListener)return this;var _this=this;var _distance=distance||75;var _startX,_startY;var _moving=false;var _move={};if(Device.mobile){this.div.addEventListener(translateEvent("touchstart"),touchStart,{passive:true});this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:true});this.div.addEventListener(translateEvent("touchcancel"),touchEnd,{passive:true})}function touchStart(e){var touch=convertTouchEvent(e);if(!_this.div)return false;if(e.touches.length==1){_startX=touch.x;_startY=touch.y;_moving=true;_this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:true})}}function touchMove(e){if(!_this.div)return false;if(_moving){var touch=convertTouchEvent(e);var dx=_startX-touch.x;var dy=_startY-touch.y;_move.direction=null;_move.moving=null;_move.x=null;_move.y=null;_move.evt=e;if(Math.abs(dx)>=_distance){touchEnd();if(dx>0){_move.direction="left"}else{_move.direction="right"}}else if(Math.abs(dy)>=_distance){touchEnd();if(dy>0){_move.direction="up"}else{_move.direction="down"}}else{_move.moving=true;_move.x=dx;_move.y=dy}if(callback)callback(_move,e)}}function touchEnd(e){if(!_this.div)return false;_startX=_startY=_moving=false;_this.div.removeEventListener(translateEvent("touchmove"),touchMove)}return this};$.fn.touchClick=function(hover,click){if(!window.addEventListener)return this;var _this=this;var _time,_move;var _start={};var _touch={};if(Device.mobile){this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:true});this.div.addEventListener(translateEvent("touchstart"),touchStart,{passive:true});this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:true})}function findDistance(p1,p2){var dx=p2.x-p1.x;var dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}function touchMove(e){if(!_this.div)return false;_touch=convertTouchEvent(e);if(findDistance(_start,_touch)>5){_move=true}else{_move=false}}function setTouch(e){var touch=convertTouchEvent(e);e.touchX=touch.x;e.touchY=touch.y;_start.x=e.touchX;_start.y=e.touchY}function touchStart(e){if(!_this.div)return false;_time=performance.now();e.action="over";e.object=_this.div.className=="hit"?_this.parent():_this;setTouch(e);if(hover&&!_move)hover(e)}function touchEnd(e){if(!_this.div)return false;var time=performance.now();var clicked=false;e.object=_this.div.className=="hit"?_this.parent():_this;setTouch(e);if(_time&&time-_time<750){if(Mouse._preventClicks)return false;if(click&&!_move){clicked=true;e.action="click";if(click&&!_move)click(e);if(Mouse.autoPreventClicks)Mouse.preventClicks()}}if(hover){e.action="out";if(!Mouse._preventFire)hover(e)}_move=false}return this}}());Class(function Element(){Inherit(this,Component);var name=Utils.getConstructorName(this);this.element=$("."+name);this.element.__useFragment=true;this.destroy=function(){if(this.element&&this.element.remove)this.element=this.element.remove();this._destroy&&this._destroy()}});(function(){Hydra.ready(()=>{TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"];TweenManager.CubicEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}];TweenManager.useCSSTrans=function(props,ease,object){if(props.math)return false;if(typeof ease==="string"&&ease.includes(["Elastic","Bounce"]))return false;if(object.multiTween||TweenManager._inspectEase(ease).path)return false;if(!Device.tween.transition)return false;return true};TweenManager._detectTween=function(object,props,time,ease,delay,callback){if(!TweenManager.useCSSTrans(props,ease,object)){return new FrameTween(object,props,time,ease,delay,callback)}else{return new CSSTransition(object,props,time,ease,delay,callback)}};TweenManager._parseTransform=function(props){var transforms="";var translate="";if(props.perspective>0)transforms+="perspective("+props.perspective+"px)";if(typeof props.x!=="undefined"||typeof props.y!=="undefined"||typeof props.z!=="undefined"){var x=props.x||0;var y=props.y||0;var z=props.z||0;translate+=x+"px, ";translate+=y+"px";if(Device.tween.css3d){translate+=", "+z+"px";transforms+="translate3d("+translate+")"}else{transforms+="translate("+translate+")"}}if(typeof props.scale!=="undefined"){transforms+="scale("+props.scale+")"}else{if(typeof props.scaleX!=="undefined")transforms+="scaleX("+props.scaleX+")";if(typeof props.scaleY!=="undefined")transforms+="scaleY("+props.scaleY+")"}if(typeof props.rotation!=="undefined")transforms+="rotate("+props.rotation+"deg)";if(typeof props.rotationX!=="undefined")transforms+="rotateX("+props.rotationX+"deg)";if(typeof props.rotationY!=="undefined")transforms+="rotateY("+props.rotationY+"deg)";if(typeof props.rotationZ!=="undefined")transforms+="rotateZ("+props.rotationZ+"deg)";if(typeof props.skewX!=="undefined")transforms+="skewX("+props.skewX+"deg)";if(typeof props.skewY!=="undefined")transforms+="skewY("+props.skewY+"deg)";return transforms};TweenManager._clearCSSTween=function(obj){if(obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween){obj.div.style[CSS.styles.vendorTransition]="";obj.div._transition=false;obj._cssTween=null}};TweenManager._isTransform=function(key){var index=TweenManager.Transforms.indexOf(key);return index>-1};TweenManager._getAllTransforms=function(object){var obj={};for(var i=TweenManager.Transforms.length-1;i>-1;i--){var tf=TweenManager.Transforms[i];var val=object[tf];if(val!==0&&typeof val==="number"){obj[tf]=val}}return obj};const prefix=function(){let pre="";let dom="";if(window._NODE_||window._GLES_){pre="webkit";dom="WebKit"}else{var styles=window.getComputedStyle(document.documentElement,"");pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||styles.OLink===""&&["","o"])[1];dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1]}return{unprefixed:Device.system.browser=="ie"&&!Device.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:(Device.system.browser=="ie"?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}();CSS.styles={};CSS.styles.vendor=prefix.unprefixed?"":prefix.js;CSS.styles.vendorTransition=CSS.styles.vendor.length?CSS.styles.vendor+"Transition":"transition";CSS.styles.vendorTransform=CSS.styles.vendor.length?CSS.styles.vendor+"Transform":"transform";CSS.vendor=prefix.css;CSS.transformProperty=function(){switch(prefix.lowercase){case"moz":return"-moz-transform";break;case"webkit":return"-webkit-transform";break;case"o":return"-o-transform";break;case"ms":return"-ms-transform";break;default:return"transform";break}}();CSS.tween={};CSS.tween.complete=function(){if(prefix.unprefixed)return"transitionend";return prefix.lowercase+"TransitionEnd"}()})}());Class(function CSSTransition(_object,_props,_time,_ease,_delay,_callback){const _this=this;let _transformProps,_transitionProps;this.playing=true;(function(){if(typeof _time!=="number")throw"CSSTween Requires object, props, time, ease";initProperties();initCSSTween()}());function killed(){return!_this||_this.kill||!_object||!_object.div}function initProperties(){var transform=TweenManager._getAllTransforms(_object);var properties=[];for(var key in _props){if(TweenManager._isTransform(key)){transform.use=true;transform[key]=_props[key];delete _props[key]}else{if(typeof _props[key]==="number"||key.includes("-"))properties.push(key)}}if(transform.use){properties.push(CSS.transformProperty);delete transform.use}_transformProps=transform;_transitionProps=properties}function initCSSTween(values){if(killed())return;if(_object._cssTween)_object._cssTween.kill=true;_object._cssTween=_this;_object.div._transition=true;var strings=buildStrings(_time,_ease,_delay);_object.willChange(strings.props);var time=values?values.time:_time;var delay=values?values.delay:_delay;var props=values?values.props:_props;var transformProps=values?values.transform:_transformProps;Timer.create(function(){if(killed())return;_object.div.style[CSS.styles.vendorTransition]=strings.transition;_this.playing=true;if(Device.system.browser=="safari"){Timer.create(function(){if(killed())return;_object.css(props);_object.transform(transformProps)},16)}else{_object.css(props);_object.transform(transformProps)}Timer.create(function(){if(killed())return;clearCSSTween();if(_callback)_callback();if(_this.completePromise)_this.completePromise.resolve()},time+delay)},50)}function buildStrings(time,ease,delay){var props="";var str="";var len=_transitionProps.length;for(var i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp;str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}function clearCSSTween(){if(killed())return;_this.playing=false;_object._cssTween=null;_object.willChange(null);_object=_props=null;Utils.nullObject(this)}function tweenComplete(){if(!_callback&&_this.playing)clearCSSTween()}this.stop=function(){if(!this.playing)return;this.kill=true;this.playing=false;_object.div.style[CSS.styles.vendorTransition]="";_object.div._transition=false;_object.willChange(null);_object._cssTween=null;Utils.nullObject(this)};this.onComplete=function(callback){_callback=callback;return this};this.promise=function(){_this.completePromise=Promise.create();return _this.completePromise}});Class(function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _this=this;var _endValues,_transformEnd,_transformStart,_startValues;var _isTransform,_isCSS,_transformProps;var _cssTween,_transformTween,_update;this.playing=true;(function(){if(typeof _ease==="object")_ease="easeOutCubic";if(_object&&_props){if(typeof _time!=="number")throw"FrameTween Requires object, props, time, ease";initValues();startTween()}}());function killed(){return _this.kill||!_object||!_object.div}function initValues(){if(_props.math)delete _props.math;if(Device.tween.transition&&_object.div._transition){_object.div.style[CSS.styles.vendorTransition]="";_object.div._transition=false}_endValues={};_transformEnd={};_transformStart={};_startValues={};if(!_object.multiTween){if(typeof _props.x==="undefined")_props.x=_object.x;if(typeof _props.y==="undefined")_props.y=_object.y;if(typeof _props.z==="undefined")_props.z=_object.z}for(var key in _props){if(key.includes(["damping","spring"])){_endValues[key]=_props[key];_transformEnd[key]=_props[key];continue}if(TweenManager._isTransform(key)){_isTransform=true;_transformStart[key]=_object[key]||(key=="scale"?1:0);_transformEnd[key]=_props[key]}else{_isCSS=true;var v=_props[key];if(typeof v==="string"){_object.div.style[key]=v}else if(typeof v==="number"){_startValues[key]=Number(_object.css(key));_endValues[key]=v}}}}function startTween(){if(_object._cssTween&&!_manual&&!_object.multiTween)_object._cssTween.kill=true;if(_object.multiTween){if(!_object._cssTweens)_object._cssTweens=[];_object._cssTweens.push(_this)}_object._cssTween=_this;_this.playing=true;_props=copy(_startValues);_transformProps=copy(_transformStart);if(_isCSS)_cssTween=tween(_props,_endValues,_time,_ease,_delay,_manual).onUpdate(update).onComplete(tweenComplete);if(_isTransform)_transformTween=tween(_transformProps,_transformEnd,_time,_ease,_delay,_manual).onComplete(!_isCSS?tweenComplete:null).onUpdate(!_isCSS?update:null)}function copy(obj){let newObj={};for(let key in obj){if(typeof obj[key]==="number")newObj[key]=obj[key]}return newObj}function clear(){if(_object._cssTweens){_object._cssTweens.remove(_this)}_this.playing=false;_object._cssTween=null;_object=_props=null}function update(){if(killed())return;if(_isCSS)_object.css(_props);if(_isTransform){if(_object.multiTween){for(var key in _transformProps){if(typeof _transformProps[key]==="number")_object[key]=_transformProps[key]}_object.transform()}else{_object.transform(_transformProps)}}if(_update)_update()}function tweenComplete(){if(_this.playing){clear();if(_callback)_callback()}}this.stop=function(){if(!this.playing)return;if(_cssTween&&_cssTween.stop)_cssTween.stop();if(_transformTween&&_transformTween.stop)_transformTween.stop();clear()};this.interpolate=function(elapsed){if(_cssTween)_cssTween.interpolate(elapsed);if(_transformTween)_transformTween.interpolate(elapsed);update()};this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}};this.setEase=function(ease){if(_cssTween)_cssTween.setEase(ease);if(_transformTween)_transformTween.setEase(ease)};this.onUpdate=function(){return this};this.onComplete=function(callback){_callback=callback;return this}});Class(function Interaction(_object){Inherit(this,Events);const _this=this;function Vec2(){this.x=0;this.y=0;this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}this.x=0;this.y=0;this.hold=new Vec2;this.last=new Vec2;this.delta=new Vec2;this.move=new Vec2;this.velocity=new Vec2;let _distance,_timeDown,_timeMove;(function(){if(!_object instanceof HydraObject)throw`Interaction.Input requires a HydraObject`;addHandlers()}());function addHandlers(){if(_object==Stage||_object==__window)Interaction.bind("touchstart",down);else _object.bind("touchstart",down);Interaction.bind("touchmove",move);Interaction.bind("touchend",up)}function down(e){_this.isTouching=true;if(e.touches&&typeof e.touches[0].force==="number")e.force=e.touches[0].force;_this.x=e.x;_this.y=e.y;_this.hold.x=_this.last.x=e.x;_this.hold.y=_this.last.y=e.y;_this.delta.x=_this.move.x=_this.velocity.x=0;_this.delta.y=_this.move.y=_this.velocity.y=0;_distance=0;_this.events.fire(Interaction.START,e,true);_timeDown=_timeMove=Render.TIME}function move(e){if(_this.isTouching){_this.move.x=e.x-_this.hold.x;_this.move.y=e.y-_this.hold.y}if(e.touches&&typeof e.touches[0].force==="number")e.force=e.touches[0].force;_this.x=e.x;_this.y=e.y;_this.delta.x=e.x-_this.last.x;_this.delta.y=e.y-_this.last.y;_this.last.x=e.x;_this.last.y=e.y;_distance+=_this.delta.length();let delta=Math.max(.001,Render.TIME-(_timeMove||Render.TIME));_timeMove=Render.TIME;_this.velocity.x=Math.abs(_this.delta.x)/delta;_this.velocity.y=Math.abs(_this.delta.y)/delta;_this.events.fire(Interaction.MOVE,e,true);if(_this.isTouching)_this.events.fire(Interaction.DRAG,e,true)}function up(e){if(!_this.isTouching)return;_this.isTouching=false;_this.move.x=0;_this.move.y=0;let delta=Math.max(.001,Render.TIME-(_timeMove||Render.TIME));if(delta>100){_this.delta.x=0;_this.delta.y=0}_this.events.fire(Interaction.END,e,true);if(_distance<20&&Render.TIME-_timeDown<2e3){_this.events.fire(Interaction.CLICK,e,true)}}this.destroy=function(){Interaction.unbind("touchstart",down);Interaction.unbind("touchmove",move);Interaction.unbind("touchend",up);_object&&_object.unbind&&_object.unbind("touchstart",down);return this._destroy&&this._destroy()}},()=>{Namespace(Interaction);Interaction.CLICK="interaction_click";Interaction.START="interaction_start";Interaction.MOVE="interaction_move";Interaction.DRAG="interaction_drag";Interaction.END="interaction_end";const _events={touchstart:[],touchmove:[],touchend:[]};Hydra.ready(()=>{__window.bind("touchstart",touchStart);__window.bind("touchmove",touchMove);__window.bind("touchend",touchEnd);__window.bind("touchcancel",touchEnd);__window.bind("contextmenu",touchEnd)});function touchMove(e){_events.touchmove.forEach(c=>c(e))}function touchStart(e){_events.touchstart.forEach(c=>c(e))}function touchEnd(e){_events.touchend.forEach(c=>c(e))}Interaction.bind=function(evt,callback){_events[evt].push(callback)};Interaction.unbind=function(evt,callback){_events[evt].remove(callback)}});Class(function Mouse(){Inherit(this,Events);const _this=this;this.x=0;this.y=0;this.normal={x:0,y:0};this.tilt={x:0,y:0};this.inverseNormal={x:0,y:0};this.resetOnRelease=false;const _offset={x:0,y:0};(function(){Hydra.ready(init)}());function init(){_this.input=new Interaction(__window);_this.events.sub(_this.input,Interaction.START,update);_this.events.sub(_this.input,Interaction.MOVE,update);_this.events.sub(_this.input,Interaction.END,end);_this.hold=_this.input.hold;_this.last=_this.input.last;_this.delta=_this.input.delta;_this.move=_this.input.move;_this.velocity=_this.input.velocity;defer(()=>{_this.events.sub(Events.RESIZE,resize);resize()})}function update(e){_this.x=e.x;_this.y=e.y;if(!Stage.width||!Stage.height)return;_this.normal.x=e.x/Stage.width-_offset.x;_this.normal.y=e.y/Stage.height-_offset.y;_this.tilt.x=_this.normal.x*2-1;_this.tilt.y=1-_this.normal.y*2;_this.inverseNormal.x=_this.normal.x;_this.inverseNormal.y=1-_this.normal.y}function end(e){if(Device.mobile&&_this.resetOnRelease)update(_this.resetOnRelease)}function resize(){if(Stage.css("top"))_offset.y=Stage.css("top")/Stage.height;if(Stage.css("left"))_offset.x=Stage.css("left")/Stage.width}},"Static");Class(function Assets(){const _this=this;const _fetchCors={mode:"cors"};this.__loaded=[];this.CDN="";this.CORS=null;this.IMAGES={};this.SDF={};this.JSON={push:function(prop,value){this[prop]=value;Object.defineProperty(this,prop,{get:()=>{return JSON.parse(JSON.stringify(value))}})}};Object.defineProperty(this.JSON,"push",{enumerable:false,writable:true});this.SVG={};function parseResolution(path){if(!window.ASSETS||!ASSETS.RES)return path;var res=ASSETS.RES[path];var ratio=Math.min(Device.pixelRatio,3);if(!res)return path;if(!res["x"+ratio])return path;var split=path.split("/");var file=split[split.length-1];split=file.split(".");return path.replace(file,split[0]+"-"+ratio+"x."+split[1])}function AssetList(arr){arr.__proto__=AssetList.prototype;return arr}AssetList.prototype=new Array;AssetList.prototype.filter=function(items){for(let i=this.length-1;i>=0;i--)if(!this[i].includes(items))this.splice(i,1);return this};AssetList.prototype.exclude=function(items){for(let i=this.length-1;i>=0;i--)if(this[i].includes(items))this.splice(i,1);return this};AssetList.prototype.prepend=function(prefix){for(let i=this.length-1;i>=0;i--)this[i]=prefix+this[i];return this};AssetList.prototype.append=function(suffix){for(let i=this.length-1;i>=0;i--)this[i]=this[i]+suffix;return this};this.list=function(){if(!window.ASSETS)console.warn(`ASSETS list not available`);return new AssetList(window.ASSETS.slice(0)||[])};this.getPath=function(path){if(!!~path.indexOf("//"))return path;path=parseResolution(path);if(this.CDN&&!~path.indexOf(this.CDN))path=this.CDN+path;return path};this.loadImage=function(path,isStore){var img=new Image;img.crossOrigin=this.CORS;img.src=_this.getPath(path);img.loadPromise=function(){let promise=Promise.create();img.onload=promise.resolve;return promise};if(isStore)this.IMAGES[path]=img;return img};this.decodeImage=function(path){let promise=Promise.create();if(!!window.createImageBitmap&&Device.system.browser.includes(["chrome"])){let img=_this.loadImage(path);img.onload=function(){createImageBitmap(img,{imageOrientation:"flipY"}).then(imgBmp=>{promise.resolve(imgBmp)})}}else{let img=_this.loadImage(path);img.onload=()=>promise.resolve(img)}return promise}},"static");Class(function AssetLoader(_assets,_callback){Inherit(this,Events);const _this=this;let _total=_assets.length;let _loaded=0;(function(){if(!Array.isArray(_assets))throw`AssetLoader requires array of assets to load`;_assets=_assets.slice(0).reverse();init()}());function init(){if(!_assets.length)return complete();for(let i=0;i<AssetLoader.SPLIT;i++){if(_assets.length)loadAsset()}}function loadAsset(){let path=_assets.splice(_assets.length-1,1)[0];const name=path.split("assets/").last().split(".")[0];const ext=path.split(".").last().split("?")[0].toLowerCase();let timeout=Timer.create(timedOut,AssetLoader.TIMEOUT,path);if(!!~Assets.__loaded.indexOf(path))return loaded();if(ext.includes(["jpg","jpeg","png","gif"])){let image=Assets.loadImage(path);if(image.complete)return loaded();image.onload=loaded;image.onerror=loaded;return}if(window.AURA&&window.AURA.import){if(ext=="js"){AURA.import(path);loaded();return}}get(Assets.getPath(path),Assets.HEADERS).then(data=>{Assets.__loaded.push(path);if(ext=="json")Assets.JSON.push(name,data);if(ext=="svg")Assets.SVG[name]=data;if(ext=="fnt")Assets.SDF[name.split("/")[1]]=data;if(ext=="js")window.eval(data);if(ext.includes(["fs","vs","glsl"])&&window.Shaders)Shaders.parse(data,path);loaded()}).catch(e=>{console.warn(e);loaded()});function loaded(){if(timeout)clearTimeout(timeout);increment();if(_assets.length)loadAsset()}}function increment(){_this.events.fire(Events.PROGRESS,{percent:++_loaded/_total});if(_loaded==_total)defer(complete)}function complete(){defer(()=>{_callback&&_callback();_this.events.fire(Events.COMPLETE)})}function timedOut(path){console.warn("Asset timed out",path)}this.add=function(num){_total+=num||1};this.trigger=function(num){for(let i=0;i<(num||1);i++)increment()}},()=>{AssetLoader.SPLIT=2;AssetLoader.TIMEOUT=5e3;AssetLoader.loadAllAssets=function(callback){let promise=Promise.create();if(!callback)callback=promise.resolve;promise.loader=new AssetLoader(Assets.list(),()=>{if(callback)callback();if(promise.loader&&promise.loader.destroy)promise.loader=promise.loader.destroy()});return promise};AssetLoader.loadAssets=function(list,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;promise.loader=new AssetLoader(list,()=>{if(callback)callback();if(promise.loader&&promise.loader.destroy)promise.loader=promise.loader.destroy()});return promise};AssetLoader.waitForLib=function(name,callback){let promise=Promise.create();if(!callback)callback=promise.resolve;Render.start(check);function check(){if(window[name]){Render.stop(check);callback&&callback()}}return promise}});Class(function Mobile(){Inherit(this,Component);Namespace(this);const _this=this;Hydra.ready(()=>{if(!Device.mobile)return;addHandlers();if(Device.system.browser=="safari"&&!Device.mobile.native)__body.css({height:"101%"}).div.scrollTop=0});function addHandlers(){_this.events.sub(Events.RESIZE,resize);if(!Device.mobile.native)window.addEventListener("touchstart",preventNativeScroll,{passive:false})}function preventNativeScroll(e){if(_this.isAllowNativeScroll)return;let target=e.target;if(target.nodeName=="INPUT"||target.nodeName=="TEXTAREA"||target.nodeName=="SELECT"||target.nodeName=="A")return;let prevent=true;while(target.parentNode&&prevent){if(target._scrollParent)prevent=false;target=target.parentNode}if(prevent)e.preventDefault()}function resize(){updateOrientation();checkResizeRefresh();if(!_this.isAllowNativeScroll)document.body.scrollTop=0}function updateOrientation(){_this.orientation=Stage.width>Stage.height?"landscape":"portrait";if(!_this.orientationSet)return;if(!window.Fullscreen.isOpen&&!Device.mobile.pwa)return;if(window.screen&&window.screen.orientation.lock)window.screen.orientation.lock(_this.orientationSet)}const checkResizeRefresh=function(){let _lastWidth;return function(){if(_this.isPreventResizeReload)return;if(_lastWidth==Stage.width)return;_lastWidth=Stage.width;if(Device.system.os!=="ios"&&!(Device.system.os=="android"&&Device.system.version>=7))return;if(Device.mobile.tablet&&!(Math.max(Stage.width,Stage.height)>800))window.location.reload()}}();this.vibrate=function(duration){navigator.vibrate&&navigator.vibrate(duration)};this.fullscreen=function(){if(!Device.mobile||Device.mobile.native||Device.mobile.pwa||Dev.emulator)return;if(!window.Fullscreen)throw`Mobile.fullscreen requires Fullscreen module`;if(Device.system.os!=="android")return;__window.bind("touchend",()=>{Fullscreen.open()});if(_this.ScreenLock&&_this.ScreenLock.isActive)window.onresize()};this.setOrientation=function(orientation,isForce){if(_this.System&&_this.NativeCore.active)return _this.System.orientation=_this.System[orientation.toUpperCase()];_this.orientationSet=orientation;updateOrientation();if(!isForce)return;if(!_this.ScreenLock)throw`Mobile.setOrientation isForce argument requires ScreenLock module`;if(orientation==="any")_this.ScreenLock.unlock();else _this.ScreenLock.lock()};this.allowNativeScroll=function(){_this.isAllowNativeScroll=true};this.preventResizeReload=function(){_this.isPreventResizeReload=true};this._addOverflowScroll=function($obj){$obj.div._scrollParent=true;if(Device.mobile.native)return;$obj.div._preventEvent=function(e){e.stopPropagation()};$obj.bind("touchmove",$obj.div._preventEvent)};this._removeOverflowScroll=function($obj){$obj.unbind("touchmove",$obj.div._preventEvent)};this.get("phone",()=>{throw"Mobile.phone is removed. Use Device.mobile.phone"});this.get("tablet",()=>{throw"Mobile.tablet is removed. Use Device.mobile.tablet"});this.get("os",()=>{throw"Mobile.os is removed. Use Device.system.os"})},"Static");Class(function Dev(){var _this=this;var _post,_alert,_inter,_timerName;var _id=Utils.timestamp();this.emulator=Device.mobile&&navigator.platform&&navigator.platform.toLowerCase().includes(["mac","windows"]);function catchErrors(){window.onerror=function(message,file,line){var string=message+" ::: "+file+" : "+line;if(_alert)alert(string);if(_post)post(_post+"/api/data/debug",getDebugInfo(string));if(_this.onError)_this.onError(message,file,line)}}function getDebugInfo(string){var obj={};obj.time=(new Date).toString();obj.deviceId=_id;obj.err=string;obj.ua=Device.agent;obj.width=Stage.width;obj.height=Stage.height;obj.screenWidth=screen.width;obj.screenHeight=screen.height;return obj}this.alertErrors=function(url){_alert=true;if(typeof url==="string")url=[url];for(var i=0;i<url.length;i++){if(location.href.includes(url[i])||location.hash.includes(url[i]))return catchErrors()}};this.postErrors=function(url,post){_post=post;if(typeof url==="string")url=[url];for(var i=0;i<url.length;i++){if(location.href.includes(url[i]))return catchErrors()}};this.expose=function(name,val,force){if(Hydra.LOCAL||force)window[name]=val};this.logServer=function(msg){if(_post)post(_post+"/api/data/debug",getDebugInfo(msg))};this.unsupported=function(needsAlert){if(needsAlert)alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")};this.checkForLeaks=function(flag,array){var matchArray=function(prop){if(!array)return false;for(var i=0;i<array.length;i++){if(prop.includes(array[i]))return true}return false};clearInterval(_inter);if(flag){_inter=setInterval(function(){for(var prop in window){if(prop.includes("webkit"))continue;var obj=window[prop];if(typeof obj!=="function"&&prop.length>2){if(prop.includes("_ga")||prop.includes("_typeface_js")||matchArray(prop))continue;var char1=prop.charAt(0);var char2=prop.charAt(1);if(char1=="_"||char1=="$"){if(char2!==char2.toUpperCase()){console.log(window[prop]);throw"Hydra Warning:: "+prop+" leaking into global scope"}}}}},1e3)}};this.startTimer=function(name){_timerName=name||"Timer";if(console.time&&!window._NODE_)console.time(_timerName);else _timer=performance.now()};this.stopTimer=function(){if(console.time&&!window._NODE_)console.timeEnd(_timerName);else console.log("Render "+_timerName+": "+(performance.now()-_timer))};this.writeFile=function(file,data){if(!Hydra.LOCAL)return;let url=location.protocol+"//"+location.hostname+":8017"+location.pathname+file;post(url,data).then(e=>{if(e!="OK")console.warn(`Unable to write to ${file}`)})};if(Hydra.LOCAL)_this.checkForLeaks(true)},"Static");Class(function Service(){Inherit(this,Component);var _this=this;var _sw;this.active=false;this.ready=false;this.cached=false;this.offline=false;this.disabled=false;(function(){Hydra.ready(()=>{})}());function initWorker(){_this.active=true;navigator.serviceWorker.register("sw.js").then(handleRegistration).then(handleReady).then(handleError)}function checkCache(){var cache=Storage.get("service_cache");if(cache!=window._CACHE_)_this.post("clearCache")}function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;assets.forEach((asset,i)=>{if(asset.includes(".js"))asset=assets[i].replace(".js",".js?"+window._CACHE_)});return assets}function handleRegistration(e){}function handleReady(e){_this.ready=true;_this.events.fire(Events.READY,e,true);_sw=navigator.serviceWorker.controller;checkCache()}function handleError(e){if(e){_this.events.fire(Events.ERROR,e,true);_this.active=false}}function handleMessage(e){var data=e.data;if(data.evt)_this.events.fire(data.evt,data)}this.cache=function(assets=[]){assets=Array.from(assets);let upload=function(){_this.post("upload",{assets:assets,cdn:Assets.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline});Storage.set("service_cache",window._CACHE_);_this.cached=true};if(_this.active)_this.wait(_this,"ready",upload)};this.post=function(fn,data={}){if(!_this.active)return;let send=function(){let mc=new MessageChannel;mc.port1.onmessage=handleMessage;data.fn=fn;_sw&&_sw.postMessage(data,[mc.port2])};_this.wait(_this,"ready",send)}},"static");Class(function Storage(){var _this=this;var _storage;(function(){testStorage()}());function testStorage(){try{if(window.localStorage){try{window.localStorage["test"]=1;window.localStorage.removeItem("test");_storage=true}catch(e){_storage=false}}else{_storage=false}}catch(e){_storage=false}}function cookie(key,value,expires){var options;if(arguments.length>1&&(value===null||typeof value!=="object")){options={};options.path="/";options.expires=expires||1;if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}options=value||{};var result,decode=options.raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}this.setCookie=function(key,value,expires){cookie(key,value,expires)};this.getCookie=function(key){return cookie(key)};this.set=function(key,value){if(value!=null&&typeof value==="object")value=JSON.stringify(value);if(_storage){if(value===null)window.localStorage.removeItem(key);else window.localStorage[key]=value}else{cookie(key,value,365)}};this.get=function(key){var val;if(_storage)val=window.localStorage[key];else val=cookie(key);if(val){var char0;if(val.charAt)char0=val.charAt(0);if(char0=="{"||char0=="[")val=JSON.parse(val);if(val=="true"||val=="false")val=val=="true"?true:false}return val}},"Static");Class(function Thread(_class){Inherit(this,Component);var _this=this;var _worker,_callbacks,_path,_mvc;var _msg={};(function(){init();importClasses();addListeners()}());function init(){let file=window._ES5_?"assets/js/hydra/hydra-thread-es5.js":"assets/js/hydra/hydra-thread.js";_callbacks={};_worker=new Worker(Thread.PATH+file)}function importClasses(){importClass(Utils);importClass(Component);importClass(Events);importClass(_class,true)}function importClass(_class,scoped){if(!_class)return;var code,namespace;if(!scoped){if(typeof _class!=="function"){code=_class.constructor.toString();if(code.includes("[native"))return;namespace=_class.constructor._namespace?_class.constructor._namespace+".":"";code=namespace+"Class("+code+', "static");'}else{namespace=_class._namespace?_class._namespace+".":"";code=namespace+"Class("+_class.toString()+");"}}else{code=_class.toString().replace("{","!!!");code=code.split("!!!")[1];var splitChar=window._MINIFIED_?"=":" ";while(code.includes("this")){var split=code.slice(code.indexOf("this."));var name=split.split("this.")[1].split(splitChar)[0];code=code.replace("this","self");createMethod(name)}code=code.slice(0,-1)}_worker.postMessage({code:code})}function createMethod(name){_this[name]=function(message={},callback){let promise;if(!callback){promise=Promise.create();callback=promise.resolve}_this.send(name,message,callback);return promise}}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console){console.log(e.data.message)}else if(e.data.id){var callback=_callbacks[e.data.id];if(callback)callback(e.data.message);delete _callbacks[e.data.id]}else if(e.data.emit){var callback=_callbacks[e.data.evt];if(callback)callback(e.data.msg)}else{var callback=_callbacks["transfer"];if(callback)callback(e.data)}}this.on=function(evt,callback){_callbacks[evt]=callback};this.off=function(evt){delete _callbacks[evt]};this.loadFunction=function(){let load=code=>{code=code.toString();code=code.replace("(","!!!");var split=code.split("!!!");var name=split[0].split(" ")[1];code="self."+name+" = function("+split[1];_worker.postMessage({code:code});createMethod(name)};for(var i=0;i<arguments.length;i++)load(arguments[i])};this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:true})};this.importClass=function(){for(var i=0;i<arguments.length;i++){var code=arguments[i];importClass(code)}};this.send=function(name,message,callback){if(typeof name==="string"){var fn=name;message=message||{};message.fn=name}else{callback=message;message=name}var id=Utils.timestamp();if(callback)_callbacks[id]=callback;if(message.transfer){message.msg.id=id;message.msg.fn=message.fn;message.msg.transfer=true;_worker.postMessage(message.msg,message.buffer)}else{_msg.message=message;_msg.id=id;_worker.postMessage(_msg)}};this.destroy=function(){if(_worker.terminate)_worker.terminate();if(this._destroy)return this._destroy()}},()=>{Thread.PATH="";Thread.absolutePath=function(path){if(window.AURA)return path;let base;try{if(document.getElementsByTagName("base").length>0){var a=document.createElement("a");a.href=document.getElementsByTagName("base")[0].href;base=a.pathname}}catch(e){}let pathname=base||location.pathname;if(pathname.includes("/index.html"))pathname=pathname.replace("/index.html","");let port=Number(location.port)>1e3?`:${location.port}`:"";return path.includes("http")?path:location.protocol+"//"+(location.hostname+port+pathname+"/"+path).replace("//","/")}});Class(function TweenManager(){Namespace(this);var _this=this;var _tweens=[];this.CubicEases=[];(function(){Render.start(updateTweens)}());function updateTweens(time){for(let i=_tweens.length-1;i>=0;i--){let tween=_tweens[i];if(tween.update)tween.update(time);else _this._removeMathTween(tween)}}function stringToValues(str){var values=str.split("(")[1].slice(0,-1).split(",");for(var i=0;i<values.length;i++)values[i]=parseFloat(values[i]);return values}function findEase(name){var eases=_this.CubicEases;for(var i=eases.length-1;i>-1;i--){if(eases[i].name==name){return eases[i]}}return false}this._addMathTween=function(tween){_tweens.push(tween)};this._removeMathTween=function(tween){_tweens.remove(tween)};this._getEase=function(name,values){var ease=findEase(name);if(!ease)return false;if(values){return ease.path?ease.path.solve:ease.values}else{return ease.curve}};this._inspectEase=function(name){return findEase(name)};this.tween=function(object,props,time,ease,delay,complete,isManual){if(typeof delay!=="number"){update=complete;complete=delay;delay=0}const tween=new MathTween(object,props,time,ease,delay,complete,isManual);let usePromise=null;if(complete&&complete instanceof Promise){usePromise=complete;complete=complete.resolve}return usePromise||tween};this.clearTween=function(object){if(object._mathTween&&object._mathTween.stop)object._mathTween.stop();if(object._mathTweens){var tweens=object._mathTweens;for(var i=0;i<tweens.length;i++){var tw=tweens[i];if(tw&&tw.stop)tw.stop()}object._mathTweens=null}};this.addCustomEase=function(ease){var add=true;if(typeof ease!=="object"||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CubicEases.length-1;i>-1;i--){if(ease.name==_this.CubicEases[i].name){add=false}}if(add){if(ease.curve.charAt(0).toLowerCase()=="m"){if(!window.EasingPath)throw"Using custom eases requires easingpath module";ease.path=new EasingPath(ease.curve)}else{ease.values=stringToValues(ease.curve)}_this.CubicEases.push(ease)}return ease};Math.interpolate=function(start,end,alpha,ease){const fn=_this.Interpolation.convertEase(ease);return Math.mix(start,end,typeof fn=="function"?fn(alpha):_this.Interpolation.solve(fn,alpha))};window.tween=this.tween;window.clearTween=this.clearTween},"Static");TweenManager.Class(function Interpolation(){function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getTForX(aX,mX1,mX2){var aGuessT=aX;for(var i=0;i<4;i++){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope==0)return aGuessT;var currentX=calculateBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope}return aGuessT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;break;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;break;case"easeInQuart":return TweenManager.Interpolation.Quart.In;break;case"easeInQuint":return TweenManager.Interpolation.Quint.In;break;case"easeInSine":return TweenManager.Interpolation.Sine.In;break;case"easeInExpo":return TweenManager.Interpolation.Expo.In;break;case"easeInCirc":return TweenManager.Interpolation.Circ.In;break;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;break;case"easeInBack":return TweenManager.Interpolation.Back.In;break;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;break;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;break;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;break;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;break;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;break;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;break;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;break;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;break;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;break;case"easeOutBack":return TweenManager.Interpolation.Back.Out;break;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;break;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;break;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;break;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;break;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;break;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;break;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;break;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;break;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;break;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;break;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;break;case"linear":return TweenManager.Interpolation.Linear.None;break}}();if(!fn){var curve=TweenManager._getEase(ease,true);if(curve)fn=curve;else fn=TweenManager.Interpolation.Cubic.Out}return fn};this.solve=function(values,elapsed){if(values[0]==values[1]&&values[2]==values[3])return elapsed;return calculateBezier(getTForX(elapsed,values[0],values[2]),values[1],values[3])};this.Linear={None:function(k){return k}};this.Quad={In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1)return.5*k*k;return-.5*(--k*(k-2)-1)}};this.Cubic={In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){if((k*=2)<1)return.5*k*k*k;return.5*((k-=2)*k*k+2)}};this.Quart={In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){if((k*=2)<1)return.5*k*k*k*k;return-.5*((k-=2)*k*k*k-2)}};this.Quint={In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){if((k*=2)<1)return.5*k*k*k*k*k;return.5*((k-=2)*k*k*k*k+2)}};this.Sine={In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}};this.Expo={In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0)return 0;if(k===1)return 1;if((k*=2)<1)return.5*Math.pow(1024,k-1);return.5*(-Math.pow(2,-10*(k-1))+2)}};this.Circ={In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){if((k*=2)<1)return-.5*(Math.sqrt(1-k*k)-1);return.5*(Math.sqrt(1-(k-=2)*k)+1)}};this.Elastic={In:function(k,a=1,p=.4){var s;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k,a=1,p=.4){var s;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1},InOut:function(k,a=1,p=.4){var s;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);if((k*=2)<1)return-.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1}};this.Back={In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1)return.5*(k*k*((s+1)*k-s));return.5*((k-=2)*k*((s+1)*k+s)+2)}};this.Bounce={In:function(k){return 1-this.Bounce.Out(1-k)},Out:function(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function(k){if(k<.5)return this.Bounce.In(k*2)*.5;return this.Bounce.Out(k*2-1)*.5+.5}}},"Static");Class(function MathTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _this=this;var _startTime,_startValues,_endValues;var _easeFunction,_paused,_newEase;var _spring,_damping,_update;var _elapsed=0;(function(){if(_object&&_props){if(typeof _time!=="number")throw"MathTween Requires object, props, time, ease";start()}}());function start(){if(!_object.multiTween&&_object._mathTween&&!_manual)TweenManager.clearTween(_object);if(!_manual)TweenManager._addMathTween(_this);let propString=getPropString();_object._mathTween=_this;if(_object.multiTween){if(!_object._mathTweens)_object._mathTweens=[];_object._mathTweens.forEach(t=>{if(t.props==propString)t.tween.stop()});_this._tweenWrapper={props:propString,tween:_this};_object._mathTweens.push(_this._tweenWrapper)}if(typeof _ease=="string"){_ease=TweenManager.Interpolation.convertEase(_ease);_easeFunction=typeof _ease==="function"}_startTime=performance.now();_startTime+=_delay;_endValues=_props;_startValues={};if(_props.spring)_spring=_props.spring;if(_props.damping)_damping=_props.damping;_this.startValues=_startValues;for(var prop in _endValues){if(typeof _object[prop]==="number")_startValues[prop]=_object[prop]}}function getPropString(){let string="";for(let key in _props){if(typeof _props[key]==="number")string+=key+" "}return string}function clear(){if(!_object&&!_props)return false;_object._mathTween=null;TweenManager._removeMathTween(_this);Utils.nullObject(_this);if(_object._mathTweens){_object._mathTweens.remove(_this._tweenWrapper)}}this.update=function(time){if(_paused||time<_startTime)return;_elapsed=(time-_startTime)/_time;_elapsed=_elapsed>1?1:_elapsed;let delta=this.interpolate(_elapsed);if(_update)_update(delta);if(_elapsed==1){if(_callback)_callback();if(_this.completePromise)_this.completePromise.resolve();clear()}};this.pause=function(){_paused=true};this.resume=function(){_paused=false;_startTime=performance.now()-_elapsed*_time};this.stop=function(){_this.stopped=true;clear();return null};this.setEase=function(ease){if(_newEase!=ease){_newEase=ease;_ease=TweenManager.Interpolation.convertEase(ease);_easeFunction=typeof _ease==="function"}};this.getValues=function(){return{start:_startValues,end:_endValues}};this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed,_spring,_damping):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues){if(typeof _startValues[prop]==="number"&&typeof _endValues[prop]==="number"){var start=_startValues[prop];var end=_endValues[prop];_object[prop]=start+(end-start)*delta}}return delta};this.onUpdate=function(callback){_update=callback;return this};this.onComplete=function(callback){_callback=callback;return this};this.promise=function(){_this.completePromise=Promise.create();return _this.completePromise}});Class(function TweenTimeline(){Inherit(this,Component);const _this=this;let _tween;let _total=0;const _tweens=[];this.elapsed=0;function calculate(){_tweens.sort(function(a,b){const ta=a.time+a.delay;const tb=b.time+b.delay;return tb-ta});const first=_tweens[0];_total=first.time+first.delay}function loop(){let time=_this.elapsed*_total;for(let i=_tweens.length-1;i>-1;i--){let t=_tweens[i];let relativeTime=time-t.delay;let elapsed=Math.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(TweenTimeline.UPDATE,_this,true)}this.get("timeRemaining",()=>{return _total-_this.elapsed*_total});this.add=function(object,props,time,ease,delay){let tween;if(object instanceof HydraObject)tween=new FrameTween(object,props,time,ease,delay,null,true);else tween=new MathTween(object,props,time,ease,delay,null,true);_tweens.push(tween);tween.time=time;tween.delay=delay||0;calculate();return tween};this.tween=function(to,time,ease,delay,callback){_this.clearTween();_tween=tween(_this,{elapsed:to},time,ease,delay).onUpdate(loop).onComplete(callback)};this.clearTween=function(){if(_tween&&_tween.stop)_tween.stop()};this.startRender=function(){Render.start(loop)};this.stopRender=function(){Render.stop(loop)};this.update=function(){loop()};this.destroy=function(){_this.clearTween();Render.stop(loop);for(var i=0;i<_tweens.length;i++)_tweens[i].stop()}},()=>{TweenTimeline.UPDATE="tweentimeline_update"});Class(function TourData(){Inherit(this,Model);const _this=this;!function(){Hydra.ready().then(function(){_this.loadData(Config.CMS).then(function(){_this.EVENTS=_this.STATIC_DATA.events;_this.dataReady=true})})}();this.formatEvents=function(){let events=_this.EVENTS.slice();let formatted=[],state,month;events.sort((a,b)=>{return new Date(a.showtime)-new Date(b.showtime)});events.forEach(event=>{let date=event.showtime.split("-");let m=`${date[1]}.${date[0]}`;if(m!==month){month=m;formatted.push({month})}if(event.state!==state){state=event.state;formatted.push({state})}formatted.push({event})});return formatted}},"singleton");window.ASSETS=["assets/images/character/a/ambient.jpg","assets/images/character/a/depth.jpg","assets/images/character/a/diffuse.jpg","assets/images/character/a/mask.jpg","assets/images/character/a/normals.jpg","assets/images/character/a/reflection.jpg","assets/images/character/b/ambient.jpg","assets/images/character/b/depth.jpg","assets/images/character/b/diffuse.jpg","assets/images/character/b/mask.jpg","assets/images/character/b/normals.jpg","assets/images/character/b/reflection.jpg","assets/images/character/drag.jpg","assets/images/character/scroll.jpg","assets/images/code-columns.jpg","assets/images/dot copy.png","assets/images/dot.png","assets/images/dot2.png","assets/images/dust.jpg","assets/images/ep/back.jpg","assets/images/ep/front.jpg","assets/images/ep/icons/beat.png","assets/images/ep/icons/deez.png","assets/images/ep/icons/itu.png","assets/images/ep/icons/sound.png","assets/images/ep/icons/spot.png","assets/images/intro/1.jpg","assets/images/intro/10.jpg","assets/images/intro/11.jpg","assets/images/intro/12.jpg","assets/images/intro/2.jpg","assets/images/intro/3.jpg","assets/images/intro/4.jpg","assets/images/intro/5.jpg","assets/images/intro/6.jpg","assets/images/intro/7.jpg","assets/images/intro/8.jpg","assets/images/intro/9.jpg","assets/images/intro/logo.jpg","assets/images/logo.svg","assets/images/orb/gem.jpg","assets/images/orb/play.png","assets/images/orb/studio.jpg","assets/images/orb/world-normals.jpg","assets/images/tech.jpg","assets/images/textures/0.jpg","assets/images/textures/1.jpg","assets/images/textures/10.jpg","assets/images/textures/11.jpg","assets/images/textures/12.jpg","assets/images/textures/13.jpg","assets/images/textures/14.jpg","assets/images/textures/15.jpg","assets/images/textures/2.jpg","assets/images/textures/3.jpg","assets/images/textures/4.jpg","assets/images/textures/5.jpg","assets/images/textures/6.jpg","assets/images/textures/7.jpg","assets/images/textures/8.jpg","assets/images/textures/9.jpg","assets/images/tour/conciousness.png","assets/images/tour/neofantasy.png","assets/images/tour/self.png","assets/images/tour/utopia-system.png","assets/images/tour/virtual.png","assets/images/unlocked.jpg","assets/js/lib/howler.min.js","assets/js/lib/three.min.js","assets/geometry/anim.json","assets/geometry/geom.json","assets/geometry/landing/orb.json","assets/shaders/compiled.vs"];ASSETS.SW=["assets/css/style.css","assets/js/app.js"];Class(function Config(){this.CDN="";this.CMS="https://storage.googleapis.com/virtual-self/publish/data.json";this.MAILCHIMP="https://us-central1-porter-robinson-vs.cloudfunctions.net/signup";this.AUDIO_LOCATION=this.CDN+"assets/audio/";this.CHARACTERS=[{type:"a",artist:"TECHNIC_ANGEL",hue:.56,tracks:[{id:"a-eonbreak",duration:"3:40",bpm:90,name:"EON BREAK",embed:"e7QeR0VxnlA"},{id:"a-particlearts",duration:"3:54",bpm:87,name:"Particle Arts",embed:"b06pKMxF6h8"},{id:"a-key",duration:"3:32",bpm:118,name:"Key",embed:"",coming:true},{id:null,name:"",embed:"",locked:true},{id:null,name:"",embed:"",locked:true}]},{type:"b",artist:"PATHSELECTOR",hue:.11,tracks:[{id:"b-ghostvoices",duration:"4:26",bpm:120,name:"Ghost Voices",embed:"HPc8QMycGno"},{id:"b-aingel",duration:"5:01",bpm:140,name:"A.I.ngel",embed:"",coming:true},{id:null,name:"",locked:true,embed:"t4GtVp395W8"},{id:null,name:"",embed:"",locked:true},{id:null,name:"",embed:"",locked:true}]}];this.ANGEL_PREVIEW={id:"angelangelangel"};this.IDS=[{id:"Egrqak6U",out:"tttttttttttttttt"},{id:"e2KsHfFu",out:"ssssssss"},{id:"VrSW8EUN",out:"eternal"},{id:"66LsEvXN",out:"digital-awakening"},{id:"S95qKxf6",out:"self-light-is-virtual"},{id:"dw6MEFn4",out:"phasephasephase"},{id:"QQrwb26b",out:"5739343422888838384324"},{id:"FhNdAw8h",out:"beginning"},{id:"UTuFG3M8",out:"once-unlimited"},{id:"nMRvLz4T",out:"sakfgaiojdyhwdwdkjwkdhjwjldwl"},{id:"hS4rqtGF",out:"awakenawakenawaken"},{id:"Ef4KbeSZ",out:"angelic-echo"},{id:"NXXqZ5Ld",out:"infinite"},{id:"FsHKV8Bp",out:"utopia"},{id:"Gm6kjG4K",out:"digital-void"},{id:"EsPh6hnA",out:"boundless"},{id:"TCNGWn8X",out:"infinite-sky-infinite-sky"},{id:"Rv96CCAE",out:"infiniteinfiniteinfinite"}];this.ID_TEXT=[{a:"  ",b:""},{a:" ",b:""},{a:"",b:""},{a:"",b:""},{a:" i needtkeepging ",b:""},{a:"        .      |    .",b:""},{a:"  {} ",b:""},{a:"   ~ ~",b:""},{a:"         .     '  ... ?",b:""},{a:"'       ...",b:"What do you say to her?"},{a:"  .",b:"(You keep going.)"},{a:" '        ...",b:"..."},{a:" (She is ignoring you now.)",b:'Why do I have to write "ANGEL" repeatedly?...  Where?'},{a:"    ?",b:"(you cannot answer.) "},{a:"     ...",b:"... ?"},{a:" '       .",b:""}]},"Static");Class(function HuntTextConfig(){},"Static");Module(function TourConfig(){this.exports=[]});Class(function VirtualSelfEvents(){this.ENTER="enter_virtual_self";this.PLAY_PAUSE="play_pause";this.CHANGE="change";this.EMBED_TOGGLE="embed_toggle";this.HOVER_INFO="hover_info";this.REQUEST_CHANGE_CHARACTER="request_change_character";this.REQUEST_CHANGE_SONG="request_change_song";this.REQUEST_SELECT_SONG="request_select_song";this.TOUR_HOVER="tour_hover"},"static");Mobile.Class(function Accelerometer(){var _this=this;this.x=0;this.y=0;this.z=0;this.alpha=0;this.beta=0;this.gamma=0;this.heading=0;this.rotationRate={};this.rotationRate.alpha=0;this.rotationRate.beta=0;this.rotationRate.gamma=0;this.toRadians=Device.system.os=="ios"?Math.PI/180:1;function updateAccel(e){switch(window.orientation){case 0:_this.x=-e.accelerationIncludingGravity.x;_this.y=e.accelerationIncludingGravity.y;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=e.rotationRate.beta*_this.toRadians;_this.rotationRate.beta=-e.rotationRate.alpha*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case 180:_this.x=e.accelerationIncludingGravity.x;_this.y=-e.accelerationIncludingGravity.y;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=-e.rotationRate.beta*_this.toRadians;_this.rotationRate.beta=e.rotationRate.alpha*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case 90:_this.x=e.accelerationIncludingGravity.y;_this.y=e.accelerationIncludingGravity.x;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=e.rotationRate.alpha*_this.toRadians;_this.rotationRate.beta=e.rotationRate.beta*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case-90:_this.x=-e.accelerationIncludingGravity.y;_this.y=-e.accelerationIncludingGravity.x;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=-e.rotationRate.alpha*_this.toRadians;_this.rotationRate.beta=-e.rotationRate.beta*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break}if(Device.system.os=="android"){_this.x*=-1;_this.y*=-1;_this.z*=-1}}function updateOrientation(e){for(var key in e){if(key.toLowerCase().includes("heading"))_this.heading=e[key]}switch(window.orientation){case 0:_this.alpha=e.beta*_this.toRadians;_this.beta=-e.alpha*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case 180:_this.alpha=-e.beta*_this.toRadians;_this.beta=e.alpha*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case 90:_this.alpha=e.alpha*_this.toRadians;_this.beta=e.beta*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case-90:_this.alpha=-e.alpha*_this.toRadians;_this.beta=-e.beta*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break}_this.tilt=e.beta*_this.toRadians;_this.yaw=e.alpha*_this.toRadians;_this.roll=-e.gamma*_this.toRadians;if(Device.system.os=="android")_this.heading=compassHeading(e.alpha,e.beta,e.gamma)}function compassHeading(alpha,beta,gamma){var degtorad=Math.PI/180;var _x=beta?beta*degtorad:0;var _y=gamma?gamma*degtorad:0;var _z=alpha?alpha*degtorad:0;var cX=Math.cos(_x);var cY=Math.cos(_y);var cZ=Math.cos(_z);var sX=Math.sin(_x);var sY=Math.sin(_y);var sZ=Math.sin(_z);var Vx=-cZ*sY-sZ*sX*cY;var Vy=-sZ*sY+cZ*sX*cY;var compassHeading=Math.atan(Vx/Vy);if(Vy<0){compassHeading+=Math.PI}else if(Vx<0){compassHeading+=2*Math.PI}return compassHeading*(180/Math.PI)}this.capture=function(){if(!this.active){this.active=true;window.ondevicemotion=updateAccel;window.addEventListener("deviceorientation",updateOrientation)}};this.stop=function(){this.active=false;window.ondevicemotion=null;_this.x=_this.y=_this.z=0;window.removeEventListener("deviceorientation",updateOrientation)}},"Static");Class(function Canvas(_width,_height,_retina){Inherit(this,Component);var _this=this;var _interactive,_over,_down,_local,_imgData;this.children=[];this.offset={x:0,y:0};this.retina=_retina;(function(){if(_retina instanceof HydraObject){initAsBackground(_retina)}else{initAsElement()}_this.width=_width;_this.height=_height;_this.context._matrix=new Matrix2;resize(_width,_height,_retina)}());function initAsBackground(){var id="c"+Utils.timestamp();_this.context=document.getCSSCanvasContext("2d",id,_width,_height);_this.background="-"+CSS.styles.vendor.toLowerCase()+"-canvas("+id+")";_retina.css({backgroundImage:_this.background});_retina=null}function initAsElement(){_this.div=document.createElement("canvas");_this.context=_this.div.getContext("2d");_this.element=$(_this.div)}function resize(w,h,retina){var ratio=retina&&Device.system.retina?2:1;if(_this.div){_this.div.width=w*ratio;_this.div.height=h*ratio}_this.width=w;_this.height=h;_this.scale=ratio;if(_this.element)_this.element.size(_this.width,_this.height);if(Device.system.retina&&retina){_this.context.scale(ratio,ratio);_this.div.style.width=w+"px";_this.div.style.height=h+"px"}}function findHit(e){e.x-=_this.offset.x;e.y-=_this.offset.y;e.width=1;e.height=1;for(var i=_this.children.length-1;i>-1;i--){var hit=_this.children[i].hit(e);if(hit)return hit}return false}function touchStart(e){var hit=findHit(e);if(!hit)return _this.interacting=false;_this.interacting=true;_down=hit;if(Device.mobile){hit.events.fire(Events.HOVER,{action:"over"},true);hit.__time=Date.now()}}function touchMove(e){var hit=findHit(e);if(hit)_this.interacting=true;else _this.interacting=false;if(!Device.mobile){if(hit&&_over){if(hit!=_over){_over.events.fire(Events.HOVER,{action:"out"},true);hit.events.fire(Events.HOVER,{action:"over"},true);_over=hit}}else if(hit&&!_over){_over=hit;hit.events.fire(Events.HOVER,{action:"over"},true)}else if(!hit&&_over){if(_over)_over.events.fire(Events.HOVER,{action:"out"},true);_over=null}}}function touchEnd(e){var hit=findHit(e);if(hit)_this.interacting=true;else _this.interacting=false;if(!_down&&!hit)return;if(!Device.mobile){if(hit&&hit==_down)hit.events.fire(Events.CLICK,{action:"click"},true)}else{if(_down)_down.events.fire(Events.HOVER,{action:"out"},true);if(hit==_down){if(Date.now()-_down.__time<750)hit.events.fire(Events.CLICK,{action:"click"},true)}}_down=null}this.set("interactive",function(val){if(!_interactive&&val){Stage.bind("touchstart",touchStart);Stage.bind("touchmove",touchMove);Stage.bind("touchend",touchEnd)}else if(_interactive&&!val){Stage.unbind("touchstart",touchStart);Stage.unbind("touchmove",touchMove);Stage.unbind("touchend",touchEnd)}_interactive=val});this.get("interactive",function(){return _interactive});this.toDataURL=function(type,quality){return _this.div.toDataURL(type,quality)};this.sort=function(){_objects.sort(function(a,b){return a.z-b.z})};this.render=function(noClear){if(!(typeof noClear==="boolean"&&noClear))_this.clear();var len=_this.children.length;for(var i=0;i<len;i++){_this.children[i].render()}this._rendered=Render.TIME};this.clear=function(){_this.context.clearRect(0,0,_this.div.width,_this.div.height)};this.add=function(display){display.setCanvas(this);display._parent=this;this.children.push(display);display._z=this.children.length};this.remove=function(display){if(!display)return;display._canvas=null;display._parent=null;var i=this.children.indexOf(display);if(i>-1)this.children.splice(i,1)};this.destroy=function(){if(_interactive){Stage.unbind("touchstart",touchStart);Stage.unbind("touchmove",touchMove);Stage.unbind("touchend",touchEnd)}this.stopRender();for(var i=0;i<this.children.length;i++){if(this.children[i].destroy)this.children[i].destroy()}return this._destroy&&this._destroy()};this.startRender=function(){Render.start(_this.render)};this.stopRender=function(){Render.stop(_this.render)};this.getImageData=function(x,y,w,h){this.imageData=this.context.getImageData(x||0,y||0,w||this.width,h||this.height);return this.imageData};this.getPixel=function(x,y,dirty){if(!this.imageData||dirty)_this.getImageData(0,0,_this.width,_this.height);if(!_imgData)_imgData={};var index=(x+y*_this.width)*4;var pixels=this.imageData.data;_imgData.r=pixels[index];_imgData.g=pixels[index+1];_imgData.b=pixels[index+2];_imgData.a=pixels[index+3];return _imgData};this.texture=function(src){var img=new Image;img.src=src;return img};this.localizeMouse=function(){_local=_local||{};_local.x=Mouse.x-_this.offset.x;_local.y=Mouse.y-_this.offset.y;return _local};this.size=resize});Class(function CanvasGraphics(_w,_h){Inherit(this,CanvasObject);var _this=this;var _props={};var _draw=[];var _pool,_mask;this.width=_w||0;this.height=_h||0;(function(){initArrayPool()}());function setProperties(context){for(var key in _props){var val=_props[key];if(val instanceof Color){context[key]=val.getHexString()}else{context[key]=val}}}function initArrayPool(){_pool=new ObjectPool(Array,25)}function draw(){var array=_pool.get()||[];for(var i=0;i<arguments.length;i++){array[i]=arguments[i]}_draw.push(array)}this.set("strokeStyle",function(val){_props.strokeStyle=val});this.get("strokeStyle",function(){return _props.strokeStyle});this.set("fillStyle",function(val){_props.fillStyle=val});this.get("fillStyle",function(){return _props.fillStyle});this.set("lineWidth",function(val){_props.lineWidth=val});this.get("lineWidth",function(){return _props.lineWidth});this.set("lineWidth",function(val){_props.lineWidth=val});this.get("lineWidth",function(){return _props.lineWidth});this.set("lineCap",function(val){_props.lineCap=val});this.get("lineCap",function(){return _props.lineCap});this.set("lineDashOffset",function(val){_props.lineDashOffset=val});this.get("lineDashOffset",function(){return _props.lineDashOffset});this.set("lineJoin",function(val){_props.lineJoin=val});this.get("lineJoin",function(){return _props.lineJoin});this.set("lineJoin",function(val){_props.lineJoin=val});this.get("lineJoin",function(){return _props.lineJoin});this.set("lineJoin",function(val){_props.lineJoin=val});this.get("lineJoin",function(){return _props.lineJoin});this.set("miterLimit",function(val){_props.miterLimit=val});this.get("miterLimit",function(){return _props.miterLimit});this.set("font",function(val){_props.font=val});this.get("font",function(val){return _props.font});this.set("textAlign",function(val){_props.textAlign=val});this.get("textAlign",function(val){return _props.textAlign});this.set("textBaseline",function(val){_props.textBaseline=val});this.get("textBaseline",function(val){return _props.textBaseline});this.draw=function(override){if(this.isMask()&&!override)return false;var context=this._canvas.context;this.startDraw(-this.anchor.tx,-this.anchor.ty);setProperties(context);for(var i=0;i<_draw.length;i++){var cmd=_draw[i];if(!cmd)continue;var fn=cmd.shift();context[fn].apply(context,cmd);cmd.unshift(fn)}this.endDraw();if(_mask){context.save();context.clip();_mask.render(true);context.restore()}};this.clear=function(){for(var i=0;i<_draw.length;i++){_draw[i].length=0;_pool.put(_draw[i])}_draw.length=0};this.arc=function(x,y,endAngle,radius,startAngle,anti){if(x&&!y){endAngle=x;x=0;y=0}x=x||0;y=y||0;endAngle=endAngle||0;endAngle-=90;anti=anti||false;startAngle=startAngle||0;startAngle-=90;radius=radius?radius:this.radius||this.width/2;draw("beginPath");draw("arc",x,y,radius,Math.radians(startAngle),Math.radians(endAngle),anti)};this.quadraticCurveTo=function(cpx,cpy,x,y){draw("quadraticCurveTo",cpx,cpy,x,y)};this.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){draw("bezierCurveTo",cp1x,cp1y,cp2x,cp2y,x,y)};this.fillRect=function(x,y,w,h){draw("fillRect",x,y,w,h)};this.clearRect=function(x,y,w,h){draw("clearRect",x,y,w,h)};this.strokeRect=function(x,y,w,h){draw("strokeRect",x,y,w,h)};this.moveTo=function(x,y){draw("moveTo",x,y)};this.lineTo=function(x,y){draw("lineTo",x,y)};this.stroke=function(){draw("stroke")};this.fill=function(){if(!_mask)draw("fill")};this.beginPath=function(){draw("beginPath")};this.closePath=function(){draw("closePath")};this.fillText=function(text,x,y){draw("fillText",text,x,y)};this.strokeText=function(text,x,y){draw("strokeText",text,x,y)};this.setLineDash=function(value){draw("setLineDash",value)};this.mask=function(object){if(!object)return _mask=null;if(!this._parent)throw"CanvasTexture :: Must add to parent before masking.";var siblings=this._parent.children;var canMask=false;for(var i=0;i<siblings.length;i++){if(object==siblings[i])canMask=true}if(canMask){_mask=object;object.masked=this;for(i=0;i<_draw.length;i++){if(_draw[i][0]=="fill"||_draw[i][0]=="stroke"){_draw[i].length=0;_pool.put(_draw[i]);_draw.splice(i,1)}}}else{throw"CanvasGraphics :: Can only mask a sibling"}}});Class(function CanvasObject(){Inherit(this,Component);var _this=this;this.alpha=1;this.x=0;this.y=0;this.width=0;this.height=0;this.rotation=0;this.scale=1;this.visible=true;this.anchor={x:.5,y:.5};this.values=new CanvasValues;this.styles=new CanvasValues(true);this.children=[];this.blendMode="normal";this.updateValues=function(){this.anchor.tx=this.anchor.x<=1&&!this.anchor.full?this.anchor.x*this.width:this.anchor.x;this.anchor.ty=this.anchor.y<=1&&!this.anchor.full?this.anchor.y*this.height:this.anchor.y;this.values.setTRSA(this.x,this.y,Math.radians(this.rotation),this.scaleX||this.scale,this.scaleY||this.scale,this.alpha);if(this._parent.values)this.values.calculate(this._parent.values);if(this._parent.styles)this.styles.calculateStyle(this._parent.styles)};this.render=function(override){if(!this.visible)return false;this.updateValues();if(this.draw)this.draw(override);var len=this.children.length;for(var i=0;i<len;i++){this.children[i].render(override)}};this.startDraw=function(ox,oy,override){var context=this._canvas.context;var v=this.values.data;var x=v[0]+(ox||0);var y=v[1]+(oy||0);if(this.styles.styled)context.save();context._matrix.setTRS(x,y,v[2],v[3],v[4]);if(!override)context.globalCompositeOperation=this.blendMode||"normal";var m=context._matrix.data;context.transform(m[0],m[3],m[1],m[4],m[2],m[5]);context.globalAlpha=v[5];if(this.styles.styled){var values=this.styles.values;for(var key in values){var val=values[key];if(val instanceof Color){context[key]=val.getHexString()}else{context[key]=val}}}};this.endDraw=function(){var context=this._canvas.context;context._matrix.inverse();var m=context._matrix.data;if(this.styles.styled)context.restore();else context.transform(m[0],m[3],m[1],m[4],m[2],m[5])};this.add=function(display){display._canvas=this._canvas;display._parent=this;this.children.push(display);display._z=this.children.length};this.setCanvas=function(canvas){this._canvas=canvas;for(var i=this.children.length-1;i>-1;i--){var child=this.children[i];child.setCanvas(canvas)}};this.remove=function(display){display._canvas=null;display._parent=null;var i=this.children.indexOf(display);if(i>-1)this.children.splice(i,1)};this.isMask=function(){var obj=this;while(obj){if(obj.masked)return true;obj=obj._parent}return false};this.unmask=function(){this.masked.mask(null);this.masked=null};this.setZ=function(z){if(!this._parent)throw"CanvasObject :: Must add to parent before setZ";this._z=z;this._parent.children.sort(function(a,b){return a._z-b._z})};this.hit=function(e){if(!this.ignoreHit){var hit=Utils.hitTestObject(e,this.values.hit(this));if(hit)return this}for(var i=this.children.length-1;i>-1;i--){var child=this.children[i];hit=child.hit(e);if(hit)return child}return false};this.destroy=function(){for(var i=0;i<this.children.length;i++){if(this.children[i].destroy)this.children[i].destroy()}return Utils.nullObject(this)}});Class(function CanvasTexture(_texture,_w,_h,_force){Inherit(this,CanvasObject);var _this=this;var _mask;this.width=_w||0;this.height=_h||0;(function(){initTexture()}());function initTexture(){if(typeof _texture==="string"){Assets.decodeImage(_texture).then(image=>{_this.texture=_texture=image;setDimensions()})}else{setDimensions();_this.texture=_texture}}function setDimensions(){if(_this.onload)_this.onload();if(!_this.width&&!_this.height){_this.width=_texture.width/(_this._canvas&&_this._canvas.retina?2:1);_this.height=_texture.height/(_this._canvas&&_this._canvas.retina?2:1)}}this.set("texture",function(img){_texture=img});this.draw=function(override){var context=this._canvas.context;if(this.isMask()&&!override)return false;if(_texture){this.startDraw(this.anchor.tx,this.anchor.ty,override);context.drawImage(_texture,-this.anchor.tx,-this.anchor.ty,this.width,this.height);this.endDraw()}if(_mask){context.globalCompositeOperation="source-in";_mask.render(true);context.globalCompositeOperation="source-over"}};this.mask=function(object){if(!object)return _mask=null;if(!this._parent)throw"CanvasTexture :: Must add to parent before masking.";var siblings=this._parent.children;var canMask=false;for(var i=0;i<siblings.length;i++){if(object==siblings[i])canMask=true}if(canMask){_mask=object;object.masked=this}else{throw"CanvasGraphics :: Can only mask a sibling"}}});Class(function CanvasValues(_style){Inherit(this,Component);var _this=this;var _styles={};var _hit={x:0,y:0,width:0,height:0};if(!_style){this.data=new Float32Array(6)}else{this.styled=false}this.set("shadowOffsetX",function(val){_this.styled=true;_styles.shadowOffsetX=val});this.get("shadowOffsetX",function(){return _styles.shadowOffsetX});this.set("shadowOffsetY",function(val){_this.styled=true;_styles.shadowOffsetY=val});this.get("shadowOffsetY",function(){return _styles.shadowOffsetY});this.set("shadowBlur",function(val){_this.styled=true;_styles.shadowBlur=val});this.get("shadowBlur",function(){return _styles.shadowBlur});this.set("shadowColor",function(val){_this.styled=true;_styles.shadowColor=val});this.get("shadowColor",function(){_this.styled=true;return _styles.shadowColor});this.get("values",function(){return _styles});this.setTRSA=function(x,y,r,sx,sy,a){var m=this.data;m[0]=x;m[1]=y;m[2]=r;m[3]=sx;m[4]=sy;m[5]=a};this.calculate=function(values){var v=values.data;var m=this.data;m[0]=m[0]+v[0];m[1]=m[1]+v[1];m[2]=m[2]+v[2];m[3]=m[3]*v[3];m[4]=m[4]*v[4];m[5]=m[5]*v[5]};this.calculateStyle=function(parent){if(!parent.styled)return false;this.styled=true;var values=parent.values;for(var key in values){if(!_styles[key])_styles[key]=values[key]}};this.hit=function(object){_hit.x=this.data[0];_hit.y=this.data[1];_hit.width=object.width;_hit.height=object.height;return _hit}});Class(function CSSAnimation(){Inherit(this,Component);var _this=this;var _name="a"+Utils.timestamp();var _frames,_timer,_started;var _duration=1e3;var _ease="linear";var _delay=0;var _loop=false;var _count=1;var _steps=null;var _applyTo=[];(function(){}());function complete(){_this.playing=false;if(_this.events)_this.events.fire(Events.COMPLETE,null,true)}function updateCSS(){var css=CSS._read();var id="/*"+_name+"*/";var keyframe="@"+CSS.vendor+"keyframes "+_name+" {\n";var string=id+keyframe;if(css.includes(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}var steps=_frames.length-1;var perc=Math.round(100/steps);var total=0;for(var i=0;i<_frames.length;i++){var frame=_frames[i];if(i==_frames.length-1)total=100;string+=(frame.percent||total)+"% {\n";var hasTransform=false;var transforms={};var styles={};for(var key in frame){if(TweenManager._isTransform(key)){transforms[key]=frame[key];hasTransform=true}else{styles[key]=frame[key]}}if(hasTransform){string+=CSS.vendor+"transform: "+TweenManager._parseTransform(transforms)+";"}for(key in styles){var val=styles[key];if(typeof val!=="string"&&key!="opacity"&&key!="zIndex")val+="px";string+=CSS._toCSS(key)+": "+val+";"}string+="\n}\n";total+=perc}string+="}"+id;css+=string;CSS._write(css)}function destroy(){var css=CSS._read();var id="/*"+_name+"*/";if(css.includes(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}CSS._write(css)}function applyTo(callback){for(var i=_applyTo.length-1;i>-1;i--)callback(_applyTo[i])}this.set("frames",function(frames){_frames=frames;updateCSS()});this.set("steps",function(steps){_steps=steps;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]="steps("+steps+")"})}});this.set("duration",function(duration){_duration=Math.round(duration);if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDuration")]=_this.duration+"ms"})}});this.get("duration",function(){return _duration});this.set("ease",function(ease){_ease=ease;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]=TweenManager._getEase(_ease)})}});this.get("ease",function(){return _ease});this.set("loop",function(loop){_loop=loop;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}});this.get("loop",function(){return _loop});this.set("count",function(count){_count=count;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}});this.get("count",function(){return _count});this.set("delay",function(delay){_delay=delay;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDelay")]=_delay+"ms"})}});this.get("delay",function(){return _delay});this.play=function(){applyTo(function($obj){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager._getEase(_ease))+" "+(_loop?"infinite":_count);$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})});_this.playing=true;clearTimeout(_timer);if(!_this.loop){_started=Date.now();_timer=_this.delayedCall(complete,_count*_duration)}};this.pause=function(){_this.playing=false;clearTimeout(_timer);applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationPlayState")]="paused"})};this.stop=function(){_this.playing=false;clearTimeout(_timer);applyTo(function($obj){if($obj&&$obj.div&&$obj.div.style)$obj.div.style[CSS.prefix("AnimationName")]=""})};this.applyTo=function($obj){_applyTo.push($obj);if(_this.playing){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager._getEase(_ease))+" "+(_loop?"infinite":_count);$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})}};this.remove=function($obj){$obj.div.style[CSS.prefix("AnimationName")]="";var i=_applyTo.indexOf($obj);if(i>-1)_applyTo.splice(i,1)};this.destroy=function(){if(!this._destroy)return;this.stop();_frames=null;destroy();return this._destroy()}});Class(function CSSFilter($object,_vert,_frag){Inherit(this,Component);var _this=this;var _filter="";var _filters=["grayscale","sepia","saturate","hue","invert","opacity","brightness","contrast","blur"];var _killTween,_tween;function checkFilter(key){for(var i=_filters.length-1;i>-1;i--){if(_filters[i]==key)return true}return false}function buildFilters(){var str="";var len=_filters.length-1;for(var key in _this){if(!checkFilter(key))continue;var filter=key;var value=_this[key];if(typeof value==="number"){filter=filter=="hue"?"hue-rotate":filter;value=filter=="hue-rotate"?value+"deg":value;value=filter=="blur"?value+"px":value;str+=filter+"("+value+") "}}_filter=str}function clearTween(){if(_tween||!$object||!$object.div)return false;$object.div.style[CSS.prefix("Transition")]=""}this.apply=function(){buildFilters();$object.div.style[CSS.prefix("Filter")]=_filter};this.tween=function(props,time,ease,delay,callback){if(typeof delay==="function"){callback=delay;delay=0}delay=delay||0;_killTween=false;var filter="-"+CSS.styles.vendor.toLowerCase()+"-filter";$object.willChange(filter);Render.setupTween(function(){if(_killTween)return;$object.div.style[CSS.prefix("Transition")]=filter+" "+time+"ms "+TweenManager.getEase(ease)+" "+delay+"ms";for(var key in props){_this[key]=props[key]}_tween=_this.delayedCall(function(){$object.willChange(null);if(callback)callback()},time+delay);_this.apply()})};this.stopTween=function(){clearTimeout(_tween);_killTween=true;clearTween()};this.clear=function(){for(var key in _this){if(checkFilter(key))delete _this[key]}if(_tween)this.stopTween();this.apply()};this.destroy=function(){this.clear();$object=null;_tween=null;return this._destroy()}});Class(function SplitTextfield(){var _style={padding:0,margin:0,position:"relative",float:"",cssFloat:"",styleFloat:"",display:"inline-block",width:"auto",height:"auto"};function splitLetter($obj){var _array=[];var text=$obj.div.innerHTML;var split=text.split("");$obj.div.innerHTML="";for(var i=0;i<split.length;i++){if(split[i]==" ")split[i]="&nbsp;";var letter=$("t","span");letter.html(split[i],true).css(_style);_array.push(letter);$obj.add(letter)}return _array}function splitWord($obj){var _array=[];var text=$obj.div.innerHTML;text=text.replace("&nbsp;"," ");var split=text.split(" ");$obj.empty();for(var i=0;i<split.length;i++){var word=$("t","span");var empty=$("t","span");word.html(split[i]).css(_style);empty.html("&nbsp",true).css(_style);_array.push(word);_array.push(empty);$obj.add(word);$obj.add(empty)}return _array}this.split=function($obj,by){if(by=="word")return splitWord($obj);else return splitLetter($obj)}},"Static");Class(function Fullscreen(){Inherit(this,Events);const _this=this;this.isOpen=false;(function(){addHandlers()}());function addHandlers(){["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onmsfullscreenchange","onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onmsfullscreenerror"].forEach(evt=>{if(typeof document[evt]!=="undefined")document[evt]=update})}function update(){const isOpen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(isOpen===_this.isOpen)return;_this.isOpen=isOpen;_this.events.fire(Events.FULLSCREEN,{fullscreen:_this.isOpen})}this.open=function(element){if(!Device.system.fullscreen)return console.warn("Fullscreen API not supported");element=element||document.body;["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].every(method=>{if(typeof element[method]=="undefined")return true;element[method]()})};this.close=function(){if(!Device.system.fullscreen)return console.warn("Fullscreen API not supported");["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].every(method=>{if(typeof document[method]=="undefined")return true;document[method]()})}},"static");Class(function GPU(){Inherit(this,Component);var _this=this;var _split={};Hydra.ready(()=>{_this.detect=function(match){if(!Device.graphics.webgl)return;return Device.graphics.webgl.detect(match)};_this.detectAll=function(){if(!Device.graphics.webgl)return;var match=true;for(var i=0;i<arguments.length;i++){if(!Device.graphics.webgl.detect(arguments[i]))match=false}return match};_this.matchGPU=function(str,min,max=99999){let num=splitGPU(str);return num>=min&&num<max};_this.gpu=Device.graphics.webgl?Device.graphics.webgl.gpu:"";function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0]);_split[string]=num;return num}catch(e){return-1}}Mobile.iOS=require("iOSDevices").find();_this.BLACKLIST=require("GPUBlacklist").match();_this.T0=function(){if(Device.mobile)return false;if(_this.BLACKLIST)return true;if(_this.detectAll("intel","hd")){return _this.matchGPU("hd graphics ",1e3,4e3)}return false}();_this.T1=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(!_this.detect(["nvidia","amd","radeon","geforce"]))return true;return false}();_this.T2=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(_this.detect(["nvidia","amd","radeon","geforce"]))return true;return false}();_this.T3=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(_this.detect(["titan","amd radeon pro","quadro"]))return true;if(_this.matchGPU("gtx ",104e1))return true;if(_this.matchGPU("radeon (tm) rx ",400))return true;if(_this.matchGPU("radeon pro ",420))return true;return false}();_this.T4=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(_this.detect(["titan","quadro"]))return true;if(_this.matchGPU("gtx ",104e1))return true;return false}();_this.MT0=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["legacy","ipad mini 1","5x","ipad 4"]))return true;if(Device.system.os=="android"&&_this.detect("sgx"))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",0,330);if(_this.detect("mali"))return _this.matchGPU("mali-t",0,628);return false}();_this.MT1=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["5s","ipad air 1"]))return true;if(Device.system.os=="android"&&!_this.MT0)return true;return false}();_this.MT2=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["6x","ipad air 2"]))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",399);return false}();_this.MT3=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["6s","ipad pro","7x"]))return true;if(_this.detect("nvidia tegra")&&Device.detect("pixel c")){return true}if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",530);if(navigator.platform.toLowerCase().includes("mac"))return true;return false}();_this.MT4=function(){if(!Device.mobile)return false;if(Device.system.os=="ios"&&_this.detect(["a10","a11","a12","a13","a14","a15","a16","a17","a18"]))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",540);if(navigator.platform.toLowerCase().includes("mac"))return true;return false}();_this.lt=function(num){if(_this.TIER>-1){return _this.TIER<=num}return false};_this.gt=function(num){if(_this.TIER>-1){return _this.TIER>=num}return false};_this.eq=function(num){if(_this.TIER>-1){return _this.TIER==num}return false};_this.mobileEq=function(num){if(_this.M_TIER>-1){return _this.M_TIER==num}return false};_this.mobileLT=function(num){if(_this.M_TIER>-1){return _this.M_TIER<=num}return false};_this.mobileGT=function(num){if(_this.M_TIER>-1){return _this.M_TIER>=num}return false};for(var key in _this){if(key.charAt(0)=="T"&&_this[key]===true)_this.TIER=Number(key.charAt(1));if(key.slice(0,2)=="MT"&&_this[key]===true)_this.M_TIER=Number(key.charAt(2))}_this.OVERSIZED=!Device.mobile&&_this.TIER<2&&Math.max(window.innerWidth,window.innerHeight)>144e1;_this.initialized=true});this.ready=function(){let promise=Promise.create();_this.wait(()=>promise.resolve(),_this,"initialized");return promise}},"static");Module(function GPUBlacklist(){this.exports={match:function(){if(!Device.graphics.webgl)return true;return Device.graphics.webgl.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","radeon r9 200","mali-4","mali-3","mali-2"])}}});Module(function iOSDevices(){this.exports={find:function(){if(Device.system.os=="ios"&&navigator.platform.toLowerCase().includes("macintel"))return"";if(!Device.graphics.webgl)return"legacy";var detect=Device.graphics.webgl.detect;if(detect(["a9","a10","a11","a12","a13","a14","a15","a16","a17","a18"])||navigator.platform.toLowerCase().includes("mac"))return Device.mobile.phone?"6s, 7x":"ipad pro";if(detect("a8"))return Device.mobile.phone?"6x":"ipad air 2, ipad mini 4";if(detect("a7"))return Device.mobile.phone?"5s":"ipad air 1, ipad mini 2, ipad mini 3";if(detect(["sgx554","sgx 554"]))return Device.mobile.phone?"":"ipad 4";if(detect(["sgx543","sgx 543"]))return Device.mobile.phone?"5x, 5c, 4s":"ipad mini 1, ipad 2";return"legacy"}}});Class(function KeyboardUtil(){Inherit(this,Component);var _this=this;_this.DOWN="keyboard_down";_this.PRESS="keyboard_press";_this.UP="keyboard_up";(function(){Hydra.ready(addListeners)}());function addListeners(){__window.keydown(keydown);__window.keyup(keyup);__window.keypress(keypress)}function keydown(e){_this.events.fire(_this.DOWN,e)}function keyup(e){_this.events.fire(_this.UP,e)}function keypress(e){_this.events.fire(_this.PRESS,e)}},"static");Class(function Color(_value,_a=1){Inherit(this,Component);var _this=this;var _hsl,_array;this.r=1;this.g=1;this.b=1;this.a=_a;(function(){set(_value)}());function set(value){if(value instanceof Color){copy(value)}else if(typeof value==="number"){setHex(value)}else if(Array.isArray(value)){setRGB(value)}else{setHex(Number("0x"+value.slice(1)))}}function copy(color){_this.r=color.r;_this.g=color.g;_this.b=color.b}function setHex(hex){hex=Math.floor(hex);_this.r=(hex>>16&255)/255;_this.g=(hex>>8&255)/255;_this.b=(hex&255)/255}function setRGB(values){_this.r=values[0];_this.g=values[1];_this.b=values[2]}function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*6*(2/3-t);return p}this.set=function(value){set(value);return this};this.setRGB=function(r,g,b){this.r=r;this.g=g;this.b=b;return this};this.setHSL=function(h,s,l){if(s===0){this.r=this.g=this.b=l}else{var p=l<=.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this};this.offsetHSL=function(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this};this.getStyle=function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"};this.getRGBA=function(){return"rgba("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+", "+this.a+")"};this.getHex=function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0};this.getHexString=function(){return"#"+("000000"+this.getHex().toString(16)).slice(-6)};this.getHSL=function(){_hsl=_hsl||{h:0,s:0,l:0};var hsl=_hsl;var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=lightness<=.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl};this.setAlpha=function(alpha){this.a=alpha};this.add=function(color){this.r+=color.r;this.g+=color.g;this.b+=color.b};this.mix=function(color,percent){this.r=this.r*(1-percent)+color.r*percent;this.g=this.g*(1-percent)+color.g*percent;this.b=this.b*(1-percent)+color.b*percent};this.addScalar=function(s){this.r+=s;this.g+=s;this.b+=s};this.multiply=function(color){this.r*=color.r;this.g*=color.g;this.b*=color.b};this.multiplyScalar=function(s){this.r*=s;this.g*=s;this.b*=s};this.clone=function(){return new Color([this.r,this.g,this.b])};this.toArray=function(){if(!_array)_array=[];_array[0]=this.r;_array[1]=this.g;_array[2]=this.b;return _array}});Class(function Matrix2(){var _this=this;var prototype=Matrix2.prototype;var a11,a12,a13,a21,a22,a23,a31,a32,a33;var b11,b12,b13,b21,b22,b23,b31,b32,b33;this.type="matrix2";this.data=new Float32Array(9);(function(){identity()}());function identity(d){d=d||_this.data;d[0]=1,d[1]=0,d[2]=0;d[3]=0,d[4]=1,d[5]=0;d[6]=0,d[7]=0,d[8]=1}function noE(n){n=Math.abs(n)<.000001?0:n;return n}if(typeof prototype.identity!=="undefined")return;prototype.identity=function(d){identity(d);return this};prototype.transformVector=function(v){var d=this.data;var x=v.x;var y=v.y;v.x=d[0]*x+d[1]*y+d[2];v.y=d[3]*x+d[4]*y+d[5];return v};prototype.setTranslation=function(tx,ty,m){var d=m||this.data;d[0]=1,d[1]=0,d[2]=tx;d[3]=0,d[4]=1,d[5]=ty;d[6]=0,d[7]=0,d[8]=1;return this};prototype.getTranslation=function(v){var d=this.data;v=v||new Vector2;v.x=d[2];v.y=d[5];return v};prototype.setScale=function(sx,sy,m){var d=m||this.data;d[0]=sx,d[1]=0,d[2]=0;d[3]=0,d[4]=sy,d[5]=0;d[6]=0,d[7]=0,d[8]=1;return this};prototype.setShear=function(sx,sy,m){var d=m||this.data;d[0]=1,d[1]=sx,d[2]=0;d[3]=sy,d[4]=1,d[5]=0;d[6]=0,d[7]=0,d[8]=1;return this};prototype.setRotation=function(a,m){var d=m||this.data;var r0=Math.cos(a);var r1=Math.sin(a);d[0]=r0,d[1]=-r1,d[2]=0;d[3]=r1,d[4]=r0,d[5]=0;d[6]=0,d[7]=0,d[8]=1;return this};prototype.setTRS=function(tx,ty,a,sx,sy){var d=this.data;var r0=Math.cos(a);var r1=Math.sin(a);d[0]=r0*sx,d[1]=-r1*sy,d[2]=tx;d[3]=r1*sx,d[4]=r0*sy,d[5]=ty;d[6]=0,d[7]=0,d[8]=1;return this};prototype.translate=function(tx,ty){this.identity(Matrix2.__TEMP__);this.setTranslation(tx,ty,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.rotate=function(a){this.identity(Matrix2.__TEMP__);this.setTranslation(a,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.scale=function(sx,sy){this.identity(Matrix2.__TEMP__);this.setScale(sx,sy,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.shear=function(sx,sy){this.identity(Matrix2.__TEMP__);this.setRotation(sx,sy,Matrix2.__TEMP__);return this.multiply(Matrix2.__TEMP__)};prototype.multiply=function(m){var a=this.data;var b=m.data||m;a11=a[0],a12=a[1],a13=a[2];a21=a[3],a22=a[4],a23=a[5];a31=a[6],a32=a[7],a33=a[8];b11=b[0],b12=b[1],b13=b[2];b21=b[3],b22=b[4],b23=b[5];b31=b[6],b32=b[7],b33=b[8];a[0]=a11*b11+a12*b21+a13*b31;a[1]=a11*b12+a12*b22+a13*b32;a[2]=a11*b13+a12*b23+a13*b33;a[3]=a21*b11+a22*b21+a23*b31;a[4]=a21*b12+a22*b22+a23*b32;a[5]=a21*b13+a22*b23+a23*b33;return this};prototype.inverse=function(m){m=m||this;var a=m.data;var b=this.data;a11=a[0],a12=a[1],a13=a[2];a21=a[3],a22=a[4],a23=a[5];a31=a[6],a32=a[7],a33=a[8];var det=m.determinant();if(Math.abs(det)<1e-7){}var invdet=1/det;b[0]=(a22*a33-a32*a23)*invdet;b[1]=(a13*a32-a12*a33)*invdet;b[2]=(a12*a23-a13*a22)*invdet;b[3]=(a23*a31-a21*a33)*invdet;b[4]=(a11*a33-a13*a31)*invdet;b[5]=(a21*a13-a11*a23)*invdet;b[6]=(a21*a32-a31*a22)*invdet;b[7]=(a31*a12-a11*a32)*invdet;b[8]=(a11*a22-a21*a12)*invdet;return m};prototype.determinant=function(){var a=this.data;a11=a[0],a12=a[1],a13=a[2];a21=a[3],a22=a[4],a23=a[5];a31=a[6],a32=a[7],a33=a[8];return a11*(a22*a33-a32*a23)-a12*(a21*a33-a23*a31)+a13*(a21*a32*a22*a31)};prototype.copyTo=function(m){var a=this.data;var b=m.data||m;b[0]=a[0],b[1]=a[1],b[2]=a[2];b[3]=a[3],b[4]=a[4],b[5]=a[5];b[6]=a[6],b[7]=a[7],b[8]=a[8];return m};prototype.copyFrom=function(m){var a=this.data;var b=m.data||m;b[0]=a[0],b[1]=a[1],b[2]=a[2];b[3]=a[3],b[4]=a[4],b[5]=a[5];b[6]=a[6],b[7]=a[7],b[8]=a[8];return this};prototype.getCSS=function(force2D){var d=this.data;if(Device.tween.css3d&&!force2D){return"matrix3d("+noE(d[0])+", "+noE(d[3])+", 0, 0, "+noE(d[1])+", "+noE(d[4])+", 0, 0, 0, 0, 1, 0, "+noE(d[2])+", "+noE(d[5])+", 0, 1)"}else{return"matrix("+noE(d[0])+", "+noE(d[3])+", "+noE(d[1])+", "+noE(d[4])+", "+noE(d[2])+", "+noE(d[5])+")"}}},function(){Matrix2.__TEMP__=(new Matrix2).data});Class(function Matrix4(){var _this=this;var prototype=Matrix4.prototype;this.type="matrix4";this.data=new Float32Array(16);(function(){identity()}());function identity(m){var d=m||_this.data;d[0]=1,d[4]=0,d[8]=0,d[12]=0;d[1]=0,d[5]=1,d[9]=0,d[13]=0;d[2]=0,d[6]=0,d[10]=1,d[14]=0;d[3]=0,d[7]=0,d[11]=0,d[15]=1}function noE(n){return Math.abs(n)<.000001?0:n}if(typeof prototype.identity!=="undefined")return;prototype.identity=function(){identity();return this};prototype.transformVector=function(v,pv){var d=this.data;var x=v.x,y=v.y,z=v.z,w=v.w;pv=pv||v;pv.x=d[0]*x+d[4]*y+d[8]*z+d[12]*w;pv.y=d[1]*x+d[5]*y+d[9]*z+d[13]*w;pv.z=d[2]*x+d[6]*y+d[10]*z+d[14]*w;return pv};prototype.multiply=function(m,d){var a=this.data;var b=m.data||m;var a00,a01,a02,a03,a04,a05,a06,a07,a08,a09,a10,a11,a12,a13,a14,a15;var b00,b01,b02,b03,b04,b05,b06,b07,b08,b09,b10,b11,b12,b13,b14,b15;a00=a[0],a01=a[1],a02=a[2],a03=a[3];a04=a[4],a05=a[5],a06=a[6],a07=a[7];a08=a[8],a09=a[9],a10=a[10],a11=a[11];a12=a[12],a13=a[13],a14=a[14],a15=a[15];b00=b[0],b01=b[1],b02=b[2],b03=b[3];b04=b[4],b05=b[5],b06=b[6],b07=b[7];b08=b[8],b09=b[9],b10=b[10],b11=b[11];b12=b[12],b13=b[13],b14=b[14],b15=b[15];a[0]=a00*b00+a04*b01+a08*b02+a12*b03;a[1]=a01*b00+a05*b01+a09*b02+a13*b03;a[2]=a02*b00+a06*b01+a10*b02+a14*b03;a[3]=a03*b00+a07*b01+a11*b02+a15*b03;a[4]=a00*b04+a04*b05+a08*b06+a12*b07;a[5]=a01*b04+a05*b05+a09*b06+a13*b07;a[6]=a02*b04+a06*b05+a10*b06+a14*b07;a[7]=a03*b04+a07*b05+a11*b06+a15*b07;a[8]=a00*b08+a04*b09+a08*b10+a12*b11;a[9]=a01*b08+a05*b09+a09*b10+a13*b11;a[10]=a02*b08+a06*b09+a10*b10+a14*b11;a[11]=a03*b08+a07*b09+a11*b10+a15*b11;a[12]=a00*b12+a04*b13+a08*b14+a12*b15;a[13]=a01*b12+a05*b13+a09*b14+a13*b15;a[14]=a02*b12+a06*b13+a10*b14+a14*b15;a[15]=a03*b12+a07*b13+a11*b14+a15*b15;return this};prototype.setTRS=function(tx,ty,tz,rx,ry,rz,sx,sy,sz,m){m=m||this;var d=m.data;identity(m);var six=Math.sin(rx);var cox=Math.cos(rx);var siy=Math.sin(ry);var coy=Math.cos(ry);var siz=Math.sin(rz);var coz=Math.cos(rz);d[0]=(coy*coz+siy*six*siz)*sx;d[1]=(-coy*siz+siy*six*coz)*sx;d[2]=siy*cox*sx;d[4]=siz*cox*sy;d[5]=coz*cox*sy;d[6]=-six*sy;d[8]=(-siy*coz+coy*six*siz)*sz;d[9]=(siz*siy+coy*six*coz)*sz;d[10]=coy*cox*sz;d[12]=tx;d[13]=ty;d[14]=tz;return m};prototype.setScale=function(sx,sy,sz,m){m=m||this;var d=m.data||m;identity(m);d[0]=sx,d[5]=sy,d[10]=sz;return m};prototype.setTranslation=function(tx,ty,tz,m){m=m||this;var d=m.data||m;identity(m);d[12]=tx,d[13]=ty,d[14]=tz;return m};prototype.setRotation=function(rx,ry,rz,m){m=m||this;var d=m.data||m;identity(m);var sx=Math.sin(rx);var cx=Math.cos(rx);var sy=Math.sin(ry);var cy=Math.cos(ry);var sz=Math.sin(rz);var cz=Math.cos(rz);d[0]=cy*cz+sy*sx*sz;d[1]=-cy*sz+sy*sx*cz;d[2]=sy*cx;d[4]=sz*cx;d[5]=cz*cx;d[6]=-sx;d[8]=-sy*cz+cy*sx*sz;d[9]=sz*sy+cy*sx*cz;d[10]=cy*cx;return m};prototype.setLookAt=function(eye,center,up,m){m=m||this;var d=m.data||m;var f=D3.m4v31;var s=D3.m4v32;var u=D3.m4v33;f.subVectors(center,eye).normalize();s.cross(f,up).normalize();u.cross(s,f);d[0]=s.x;d[1]=u.x;d[2]=-f.x;d[3]=0;d[4]=s.y;d[5]=u.y;d[6]=-f.y;d[7]=0;d[8]=s.z;d[9]=u.z;d[10]=-f.z;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;this.translate(-eye.x,-eye.y,-eye.z);return this};prototype.setPerspective=function(fovy,aspect,near,far,m){var e,rd,s,ct;if(near===far||aspect===0){throw"null frustum"}if(near<=0){throw"near <= 0"}if(far<=0){throw"far <= 0"}fovy=Math.PI*fovy/180/2;s=Math.sin(fovy);if(s===0){throw"null frustum"}rd=1/(far-near);ct=Math.cos(fovy)/s;e=m?m.data||m:this.data;e[0]=ct/aspect;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=ct;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=-(far+near)*rd;e[11]=-1;e[12]=0;e[13]=0;e[14]=-2*near*far*rd;e[15]=0};prototype.setRotationFromQuaternion=function(q){var d=this.data;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;d[0]=1-(yy+zz);d[4]=xy-wz;d[8]=xz+wy;d[1]=xy+wz;d[5]=1-(xx+zz);d[9]=yz-wx;d[2]=xz-wy;d[6]=yz+wx;d[10]=1-(xx+yy);d[3]=0;d[7]=0;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return this},prototype.perspective=function(fov,aspect,near,far){this.setPerspective(fov,aspect,near,far,Matrix4.__TEMP__);return this.multiply(Matrix4.__TEMP__)};prototype.lookAt=function(eye,center,up){this.setLookAt(eye,center,up,Matrix4.__TEMP__);return this.multiply(Matrix4.__TEMP__)};prototype.translate=function(tx,ty,tz){this.setTranslation(tx,ty,tz,Matrix4.__TEMP__);return this.multiply(Matrix4.__TEMP__)};prototype.rotate=function(rx,ry,rz){this.setRotation(rx,ry,rz,Matrix4.__TEMP__);return this.multiply(Matrix4.__TEMP__)};prototype.scale=function(sx,sy,sz){this.setScale(sx,sy,sz,Matrix4.__TEMP__);return this.multiply(Matrix4.__TEMP__)};prototype.copyTo=function(m){var a=this.data;var b=m.data||m;for(var i=0;i<16;i++)b[i]=a[i]};prototype.copyFrom=function(m){var a=this.data;var b=m.data||m;for(var i=0;i<16;i++)a[i]=b[i];return this};prototype.copyRotationTo=function(m){var a=this.data;var b=m.data||m;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return m};prototype.copyPosition=function(m){var to=this.data;var from=m.data||m;to[12]=from[12];to[13]=from[13];to[14]=from[14];return this};prototype.getCSS=function(){var d=this.data;return"matrix3d("+noE(d[0])+","+noE(d[1])+","+noE(d[2])+","+noE(d[3])+","+noE(d[4])+","+noE(d[5])+","+noE(d[6])+","+noE(d[7])+","+noE(d[8])+","+noE(d[9])+","+noE(d[10])+","+noE(d[11])+","+noE(d[12])+","+noE(d[13])+","+noE(d[14])+","+noE(d[15])+")"};prototype.extractPosition=function(v){v=v||new Vector3;var d=this.data;v.set(d[12],d[13],d[14]);return v};prototype.determinant=function(){var d=this.data;return d[0]*(d[5]*d[10]-d[9]*d[6])+d[4]*(d[9]*d[2]-d[1]*d[10])+d[8]*(d[1]*d[6]-d[5]*d[2])};prototype.inverse=function(m){var d=this.data;var a=m?m.data||m:this.data;var det=this.determinant();if(Math.abs(det)<.0001){console.warn("Attempt to inverse a singular Matrix4. ",this.data);console.trace();return m}var d0=d[0],d4=d[4],d8=d[8],d12=d[12],d1=d[1],d5=d[5],d9=d[9],d13=d[13],d2=d[2],d6=d[6],d10=d[10],d14=d[14];det=1/det;a[0]=(d5*d10-d9*d6)*det;a[1]=(d8*d6-d4*d10)*det;a[2]=(d4*d9-d8*d5)*det;a[4]=(d9*d2-d1*d10)*det;a[5]=(d0*d10-d8*d2)*det;a[6]=(d8*d1-d0*d9)*det;a[8]=(d1*d6-d5*d2)*det;a[9]=(d4*d2-d0*d6)*det;a[10]=(d0*d5-d4*d1)*det;a[12]=-(d12*a[0]+d13*a[4]+d14*a[8]);a[13]=-(d12*a[1]+d13*a[5]+d14*a[9]);a[14]=-(d12*a[2]+d13*a[6]+d14*a[10]);return m};prototype.transpose=function(m){var d=this.data;var a=m?m.data||m:this.data;var d0=d[0],d4=d[4],d8=d[8],d1=d[1],d5=d[5],d9=d[9],d2=d[2],d6=d[6],d10=d[10];a[0]=d0;a[1]=d4;a[2]=d8;a[4]=d1;a[5]=d5;a[6]=d9;a[8]=d2;a[9]=d6;a[10]=d10}},function(){Matrix4.__TEMP__=(new Matrix4).data});Class(function Noise(){var module=this;function Grad(x,y,z){this.x=x;this.y=y;this.z=z}Grad.prototype.dot2=function(x,y){return this.x*x+this.y*y};Grad.prototype.dot3=function(x,y,z){return this.x*x+this.y*y+this.z*z};var grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];var p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var perm=new Array(512);var gradP=new Array(512);module.seed=function(seed){if(seed>0&&seed<1){seed*=65536}seed=Math.floor(seed);if(seed<256){seed|=seed<<8}for(var i=0;i<256;i++){var v;if(i&1){v=p[i]^seed&255}else{v=p[i]^seed>>8&255}perm[i]=perm[i+256]=v;gradP[i]=gradP[i+256]=grad3[v%12]}};module.seed(0);var F2=.5*(Math.sqrt(3)-1);var G2=(3-Math.sqrt(3))/6;var F3=1/3;var G3=1/6;module.simplex2=function(xin,yin){var n0,n1,n2;var s=(xin+yin)*F2;var i=Math.floor(xin+s);var j=Math.floor(yin+s);var t=(i+j)*G2;var x0=xin-i+t;var y0=yin-j+t;var i1,j1;if(x0>y0){i1=1;j1=0}else{i1=0;j1=1}var x1=x0-i1+G2;var y1=y0-j1+G2;var x2=x0-1+2*G2;var y2=y0-1+2*G2;i&=255;j&=255;var gi0=gradP[i+perm[j]];var gi1=gradP[i+i1+perm[j+j1]];var gi2=gradP[i+1+perm[j+1]];var t0=.5-x0*x0-y0*y0;if(t0<0){n0=0}else{t0*=t0;n0=t0*t0*gi0.dot2(x0,y0)}var t1=.5-x1*x1-y1*y1;if(t1<0){n1=0}else{t1*=t1;n1=t1*t1*gi1.dot2(x1,y1)}var t2=.5-x2*x2-y2*y2;if(t2<0){n2=0}else{t2*=t2;n2=t2*t2*gi2.dot2(x2,y2)}return 70*(n0+n1+n2)};module.simplex3=function(xin,yin,zin){var n0,n1,n2,n3;var s=(xin+yin+zin)*F3;var i=Math.floor(xin+s);var j=Math.floor(yin+s);var k=Math.floor(zin+s);var t=(i+j+k)*G3;var x0=xin-i+t;var y0=yin-j+t;var z0=zin-k+t;var i1,j1,k1;var i2,j2,k2;if(x0>=y0){if(y0>=z0){i1=1;j1=0;k1=0;i2=1;j2=1;k2=0}else if(x0>=z0){i1=1;j1=0;k1=0;i2=1;j2=0;k2=1}else{i1=0;j1=0;k1=1;i2=1;j2=0;k2=1}}else{if(y0<z0){i1=0;j1=0;k1=1;i2=0;j2=1;k2=1}else if(x0<z0){i1=0;j1=1;k1=0;i2=0;j2=1;k2=1}else{i1=0;j1=1;k1=0;i2=1;j2=1;k2=0}}var x1=x0-i1+G3;var y1=y0-j1+G3;var z1=z0-k1+G3;var x2=x0-i2+2*G3;var y2=y0-j2+2*G3;var z2=z0-k2+2*G3;var x3=x0-1+3*G3;var y3=y0-1+3*G3;var z3=z0-1+3*G3;i&=255;j&=255;k&=255;var gi0=gradP[i+perm[j+perm[k]]];var gi1=gradP[i+i1+perm[j+j1+perm[k+k1]]];var gi2=gradP[i+i2+perm[j+j2+perm[k+k2]]];var gi3=gradP[i+1+perm[j+1+perm[k+1]]];var t0=.6-x0*x0-y0*y0-z0*z0;if(t0<0){n0=0}else{t0*=t0;n0=t0*t0*gi0.dot3(x0,y0,z0)}var t1=.6-x1*x1-y1*y1-z1*z1;if(t1<0){n1=0}else{t1*=t1;n1=t1*t1*gi1.dot3(x1,y1,z1)}var t2=.6-x2*x2-y2*y2-z2*z2;if(t2<0){n2=0}else{t2*=t2;n2=t2*t2*gi2.dot3(x2,y2,z2)}var t3=.6-x3*x3-y3*y3-z3*z3;if(t3<0){n3=0}else{t3*=t3;n3=t3*t3*gi3.dot3(x3,y3,z3)}return 32*(n0+n1+n2+n3)};function fade(t){return t*t*t*(t*(t*6-15)+10)}function lerp(a,b,t){return(1-t)*a+t*b}this.perlin=function(x){return module.perlin2(x,0)};this.perlin2=function(x,y){var X=Math.floor(x),Y=Math.floor(y);x=x-X;y=y-Y;X=X&255;Y=Y&255;var n00=gradP[X+perm[Y]].dot2(x,y);var n01=gradP[X+perm[Y+1]].dot2(x,y-1);var n10=gradP[X+1+perm[Y]].dot2(x-1,y);var n11=gradP[X+1+perm[Y+1]].dot2(x-1,y-1);var u=fade(x);return lerp(lerp(n00,n10,u),lerp(n01,n11,u),fade(y))};this.perlin3=function(x,y,z){var X=Math.floor(x),Y=Math.floor(y),Z=Math.floor(z);x=x-X;y=y-Y;z=z-Z;X=X&255;Y=Y&255;Z=Z&255;var n000=gradP[X+perm[Y+perm[Z]]].dot3(x,y,z);var n001=gradP[X+perm[Y+perm[Z+1]]].dot3(x,y,z-1);var n010=gradP[X+perm[Y+1+perm[Z]]].dot3(x,y-1,z);var n011=gradP[X+perm[Y+1+perm[Z+1]]].dot3(x,y-1,z-1);var n100=gradP[X+1+perm[Y+perm[Z]]].dot3(x-1,y,z);var n101=gradP[X+1+perm[Y+perm[Z+1]]].dot3(x-1,y,z-1);var n110=gradP[X+1+perm[Y+1+perm[Z]]].dot3(x-1,y-1,z);var n111=gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1,y-1,z-1);var u=fade(x);var v=fade(y);var w=fade(z);return lerp(lerp(lerp(n000,n100,u),lerp(n001,n101,u),w),lerp(lerp(n010,n110,u),lerp(n011,n111,u),w),v)}},"Static");Class(function Quaternion(_x,_y,_z,_w){var _this=this;var prototype=Quaternion.prototype;this.x=typeof _x==="number"?_x:0;this.y=typeof _y==="number"?_y:0;this.z=typeof _z==="number"?_z:0;this.w=typeof _w==="number"?_w:1;prototype.set=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||1;return this};prototype.clear=function(){this.x=0;this.y=0;this.z=0;this.w=1;return this};prototype.copyTo=function(p){p.x=this.x;p.y=this.y;p.z=this.z;p.w=this.w;return p};prototype.copyFrom=prototype.copy=function(p){this.x=p.x||0;this.y=p.y||0;this.z=p.z||0;this.w=p.w||1;return this};prototype.clone=function(){return new Quaternion(this.x,this.y,this.z,this.w)};prototype.setFromEuler=function(x,y,z,order){var c1=Math.cos(x/2);var c2=Math.cos(y/2);var c3=Math.cos(z/2);var s1=Math.sin(x/2);var s2=Math.sin(y/2);var s3=Math.sin(z/2);order=order||"XYZ";if(order==="XYZ"){this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3}else if(order==="YXZ"){this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3}else if(order==="ZXY"){this.x=s1*c2*c3-c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3}else if(order==="ZYX"){this.x=s1*c2*c3-c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3}else if(order==="YZX"){this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3}else if(order==="XZY"){this.x=s1*c2*c3-c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3}return this};prototype.setFromAxisAngle=function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);this.x=axis.x*s;this.y=axis.y*s;this.z=axis.z*s;this.w=Math.cos(halfAngle);return this};prototype.equals=function(quaternion){return quaternion.x===this.x&&quaternion.y===this.y&&quaternion.z===this.z&&quaternion.w===this.w};prototype.inverse=function(){this.conjugate().normalize();return this};prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w};prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};prototype.normalize=function(){var l=this.length();if(l===0){this.x=0;this.y=0;this.z=0;this.w=1}else{l=1/l;this.x=this.x*l;this.y=this.y*l;this.z=this.z*l;this.w=this.w*l}return this};prototype.multiply=function(q){return this.multiplyQuaternions(this,q)};prototype.multiplyQuaternions=function(a,b){var qax=a.x,qay=a.y,qaz=a.z,qaw=a.w;var qbx=b.x,qby=b.y,qbz=b.z,qbw=b.w;this.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;return this};prototype.slerp=function(qb,t){if(t===0)return this;if(t===1)return this.copy(qb);var x=this.x,y=this.y,z=this.z,w=this.w;var cosHalfTheta=w*qb.w+x*qb.x+y*qb.y+z*qb.z;if(cosHalfTheta<0){this.w=-qb.w;this.x=-qb.x;this.y=-qb.y;this.z=-qb.z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(cosHalfTheta>=1){this.w=w;this.x=x;this.y=y;this.z=z;return this}var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001){this.w=.5*(w+this.w);this.x=.5*(x+this.x);this.y=.5*(y+this.y);this.z=.5*(z+this.z);return this}var halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta);var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this.w=w*ratioA+this.w*ratioB;this.x=x*ratioA+this.x*ratioB;this.y=y*ratioA+this.y*ratioB;this.z=z*ratioA+this.z*ratioB;return this}});Class(function Vector2(_x,_y){var _this=this;var prototype=Vector2.prototype;this.x=typeof _x=="number"?_x:0;this.y=typeof _y=="number"?_y:0;this.type="vector2";if(typeof prototype.set!=="undefined")return;prototype.set=function(x,y){this.x=x;this.y=y;return this};prototype.clear=function(){this.x=0;this.y=0;return this};prototype.copyTo=function(v){v.x=this.x;v.y=this.y;return this};prototype.copyFrom=prototype.copy=function(v){this.x=v.x;this.y=v.y;return this};prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this};prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this};prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;return this};prototype.add=function(v){this.x+=v.x;this.y+=v.y;return this};prototype.sub=function(v){this.x-=v.x;this.y-=v.y;return this};prototype.multiply=prototype.multiplyScalar=function(v){this.x*=v;this.y*=v;return this};prototype.divide=function(v){this.x/=v;this.y/=v;return this};prototype.lengthSq=function(){return this.x*this.x+this.y*this.y||.00001};prototype.length=function(){return Math.sqrt(this.lengthSq())};prototype.setLength=function(length){this.normalize().multiply(length);return this};prototype.normalize=function(){var length=this.length();this.x/=length;this.y/=length;return this};prototype.perpendicular=function(a,b){var tx=this.x;var ty=this.y;this.x=-ty;this.y=tx;return this};prototype.lerp=function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this};prototype.interp=function(v,alpha,ease){var a=0;var f=TweenManager.Interpolation.convertEase(ease);var calc=Vector2.__TEMP__;calc.subVectors(this,v);var dist=Math.clamp(Math.range(calc.lengthSq(),0,5e3*5e3,1,0),0,1)*(alpha/10);if(typeof f==="function")a=f(dist);else a=TweenManager.Interpolation.solve(f,dist);this.x+=(v.x-this.x)*a;this.y+=(v.y-this.y)*a};prototype.setAngleRadius=function(a,r){this.x=Math.cos(a)*r;this.y=Math.sin(a)*r;return this};prototype.addAngleRadius=function(a,r){this.x+=Math.cos(a)*r;this.y+=Math.sin(a)*r;return this};prototype.clone=function(){return new Vector2(this.x,this.y)};prototype.dot=function(a,b){b=b||this;return a.x*b.x+a.y*b.y};prototype.distanceTo=function(v,noSq){var dx=this.x-v.x;var dy=this.y-v.y;if(!noSq)return Math.sqrt(dx*dx+dy*dy);return dx*dx+dy*dy};prototype.solveAngle=function(a,b){if(!b)b=this;return Math.atan2(a.y-b.y,a.x-b.x)};prototype.equals=function(v){return this.x==v.x&&this.y==v.y};prototype.console=function(){console.log(this.x,this.y)};prototype.toString=function(split){split=split||" ";return this.x+split+this.y};prototype.toArray=function(array=[]){array[0]=this.x;array[1]=this.y;return array};prototype.fromArray=function(array){this.x=array[0];this.y=array[1];return this}},function(){Vector2.__TEMP__=new Vector2;Vector2.__TEMP2__=new Vector2});Class(function Vector3(_x,_y,_z,_w){var _this=this;var prototype=Vector3.prototype;this.x=typeof _x==="number"?_x:0;this.y=typeof _y==="number"?_y:0;this.z=typeof _z==="number"?_z:0;this.w=typeof _w==="number"?_w:1;this.type="vector3";if(typeof prototype.set!=="undefined")return;prototype.set=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||1;return this};prototype.clear=function(){this.x=0;this.y=0;this.z=0;this.w=1;return this};prototype.copyTo=function(p){p.x=this.x;p.y=this.y;p.z=this.z;p.w=this.w;return p};prototype.copyFrom=prototype.copy=function(p){this.x=p.x||0;this.y=p.y||0;this.z=p.z||0;this.w=p.w||1;return this};prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z};prototype.length=function(){return Math.sqrt(this.lengthSq())};prototype.normalize=function(){var m=1/this.length();this.set(this.x*m,this.y*m,this.z*m);return this};prototype.setLength=function(length){this.normalize().multiply(length);return this};prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};prototype.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this};prototype.sub=function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this};prototype.multiply=prototype.multiplyScalar=function(v){this.x*=v;this.y*=v;this.z*=v;return this};prototype.divide=function(v){this.x/=v;this.y/=v;this.z/=v;return this};prototype.limit=function(max){if(this.length()>max){this.normalize();this.multiply(max)}};prototype.heading2D=function(){var angle=Math.atan2(-this.y,this.x);return-angle};prototype.lerp=function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this};prototype.deltaLerp=function(v,alpha,delta){delta=delta||1;for(var i=0;i<delta;i++){var f=alpha;this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha}return this};prototype.interp=function(v,alpha,ease,dist){if(!Vector3.__TEMP__)Vector3.__TEMP__=new Vector3;dist=dist||5e3;var a=0;var f=TweenManager.Interpolation.convertEase(ease);var calc=Vector3.__TEMP__;calc.subVectors(this,v);var dist=Math.clamp(Math.range(calc.lengthSq(),0,dist*dist,1,0),0,1)*(alpha/10);if(typeof f==="function")a=f(dist);else a=TweenManager.Interpolation.solve(f,dist);this.x+=(v.x-this.x)*a;this.y+=(v.y-this.y)*a;this.z+=(v.z-this.z)*a};prototype.setAngleRadius=function(a,r){this.x=Math.cos(a)*r;this.y=Math.sin(a)*r;return this};prototype.addAngleRadius=function(a,r){this.x+=Math.cos(a)*r;this.y+=Math.sin(a)*r;return this};prototype.dot=function(a,b){b=b||this;return a.x*b.x+a.y*b.y+a.z*b.z};prototype.clone=function(){return new Vector3(this.x,this.y,this.z)};prototype.cross=function(a,b){if(!b)b=this;var x=a.y*b.z-a.z*b.y;var y=a.z*b.x-a.x*b.z;var z=a.x*b.y-a.y*b.x;this.set(x,y,z,this.w);return this};prototype.distanceTo=function(v,noSq){var dx=this.x-v.x;var dy=this.y-v.y;var dz=this.z-v.z;if(!noSq)return Math.sqrt(dx*dx+dy*dy+dz*dz);return dx*dx+dy*dy+dz*dz};prototype.solveAngle=function(a,b){if(!b)b=this;return Math.acos(a.dot(b)/(a.length()*b.length()||.00001))};prototype.solveAngle2D=function(a,b){if(!b)b=this;Vector2.__TEMP__.copy(a);Vector2.__TEMP2__.copy(b);return Vector2.__TEMP__.solveAngle(Vector2.__TEMP2__)};prototype.equals=function(v){return this.x==v.x&&this.y==v.y&&this.z==v.z};prototype.console=function(){console.log(this.x,this.y,this.z)};prototype.toString=function(split){split=split||" ";return this.x+split+this.y+split+this.z};prototype.toArray=function(array=[]){array[0]=this.x;array[1]=this.y;array[2]=this.z;return array};prototype.fromArray=function(array){this.x=array[0];this.y=array[1];this.z=array[2];return this};prototype.applyQuaternion=function(q){var x=this.x,y=this.y,z=this.z;var qx=q.x,qy=q.y,qz=q.z,qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this}},function(){Vector3.__TEMP__=new Vector3});Class(function Video(_params){Inherit(this,Component);let _this=this;let $video;let _video;let _ready=Promise.create();let _loaded=Promise.create();let _loadingState;let _handlers;let _initialPlay=true;(function(){initParam();init();addHandlers()}());function initParam(){let defaults={muted:true,loop:false,autoplay:false,inline:true,controls:false,currentTime:0,playback:1,preload:false,width:640,height:360,events:[]};_params=Object.assign(defaults,_params)}function init(){_video=document.createElement("video");_video.src=getSource(_params.src);_video.setAttribute("crossorigin","anonymous");_video.autoplay=_params.autoplay;_video.loop=_params.loop;_video.controls=_params.controls;_video.height=_params.height;_video.width=_params.width;_video.defaultMuted=_params.muted;_video.defaultPlaybackRate=_params.playback;_video.preload=_params.preload;_video.muted=_params.autoplay||_params.muted;_video.setAttribute("webkit-playsinline",_params.inline);_video.setAttribute("playsinline",_params.inline);_video.setAttribute("autoplay",_params.autoplay);_video.setAttribute("muted",_params.muted);if(_params.loop)_video.setAttribute("loop",_params.loop);_this.div=_video;$video=$(_video);if(_params.autoplay)return startPlayback();if(_params.preload)return startPreload()}function addHandlers(){_params.events.push("loadeddata");_handlers={play,pause,ended,playing,progress,waiting,timeupdate,loadeddata};_params.events.forEach(event=>_video.addEventListener(event,_handlers[event],true))}function startPreload(){_loadingState=true;return _ready}function startPlayback(){_loadingState=false;_ready.then(()=>{if(_initialPlay){_initialPlay=false;_video.currentTime=_params.currentTime}_video.play()})}function getSource(src=""){if(!src.includes(["webm","mp4","ogv"]))src+="."+Device.media.video;return src}function removeListeners(){_params.events.forEach(event=>_video.removeEventListener(event,_handlers[event],true))}function progress(e){_this.events.fire(Video.PROGRESS,e)}function timeupdate(e){_this.events.fire(Video.UPDATE,e)}function play(e){if(_loadingState)return _loadingState=false;_this.events.fire(Video.PLAY,e)}function pause(e){_this.events.fire(Video.PAUSE,e)}function playing(e){_this.events.fire(Video.PLAYING,e)}function ended(e){_this.events.fire(Video.ENDED,e)}function waiting(e){_this.events.fire(Video.WAITING,e)}function loadeddata(){if(_video.readyState>=2){_ready.resolve()}if(_video.readyState>=4){_loaded.resolve()}}this.set("loop",bool=>_video.loop=bool);this.get("loop",()=>_video.loop);this.set("src",src=>{if(src===_video.src)return;_video.src=getSource(src)});this.get("src",()=>_video.currentSrc);this.set("volume",v=>{_video.muted=v===0;_video.volume=v});this.get("volume",()=>_video.volume);this.set("muted",bool=>_video.muted=bool);this.get("muted",()=>_video.muted);this.set("controls",bool=>_video.controls=bool);this.get("controls",()=>_video.controls);this.get("duration",()=>_video.duration);this.get("ended",()=>_video.ended);this.get("playback",()=>_video.playbackRate);this.get("time",()=>_video.currentTime);this.get("canRender",()=>_video.readyState>=2);this.get("canPlayThrough",()=>_video.readyState>=4);this.get("paused",()=>_video.paused);this.get("object",()=>$video);this.get("video",()=>_video);this.load=function(){return startPreload()};this.play=function(){return startPlayback()};this.pause=function(){_video.pause()};this.stop=function(){_video.pause();_video.seek=0};this.seek=function(t){if(_video.fastSeek)return _video.fastSeek(t);_video.currentTime=t};this.seekExact=function(t){_video.currentTime=t};this.ready=function(){return _ready};this.loaded=function(){return _loaded};this.destroy=function(){_this.stop();removeListeners();return this._destroy()}},()=>{Video.PLAY="hydra_video_play";Video.PAUSE="hydra_video_pause";Video.PROGRESS="hydra_video_progress";Video.UPDATE="hydra_video_update";Video.PLAYING="hydra_video_playing";Video.ENDED="hydra_video_ended";Video.WAITING="hydra_video_waiting"});Class(function Webcam(_width,_height,_audio){Inherit(this,Component);var _this=this;let _stream,_cameras={},_config={};let _back=false,_attempts=0;_this.facing="back";(function(){createVideo();initNavigator()}());function createVideo(){_this.div=document.createElement("video");_this.div.width=_width;_this.div.height=_height;_this.div.autoplay=true;_this.element=$(_this.div);if(!Device.mobile)_this.element.transform({scaleX:-1})}function initNavigator(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}function establishWebcam(){if(_attempts>=2)return error();lookupDevices().then(()=>{if(_stream&&_config.back)_stream.getTracks()[0].stop();navigator.getUserMedia({video:_config.back?_cameras.back:_cameras.front||true,audio:_audio},success,error)});_attempts+=1}function lookupDevices(){let promise=Promise.create();if(!Device.mobile)return Promise.resolve();navigator.mediaDevices.enumerateDevices().then(devices=>{devices.forEach(device=>{if(device.label.includes("front"))_cameras.front={deviceId:{exact:device.deviceId}};if(device.label.includes("back")){_cameras.back={deviceId:{exact:device.deviceId}};_back=true}});if(!_cameras.front)_cameras.front={facingMode:"user"};if(!_cameras.back){_cameras.back={facingMode:"environment"};_back=false}promise.resolve()});return promise}function success(stream){_this.denied=false;_stream=stream;if(_config.back&&!_back){establishWebcam()}else{_this.div.src=window.URL.createObjectURL(stream);_this.events.fire(Events.READY,null,true)}}function error(){_this.denied=true;_this.events.fire(Events.ERROR,null,true)}this.createStream=function(config){_attempts=0;_config=config;establishWebcam()};this.flip=function(){if(!_back)return;let direction;if(_this.facing==="front"){_this.facing="back";direction=_cameras.back}else{_this.facing="front";direction=_cameras.front}_stream.getTracks()[0].stop();navigator.getUserMedia({video:direction||true,audio:_audio},success,error)};this.get("width",function(){return _width});this.get("height",function(){return _height});this.size=function(w,h){_this.div.width=_width=w;_this.div.height=_height=h;_this.element.size(w,h)};this.getPixels=function(width=_width,height=_height){if(!_this.canvas)_this.canvas=_this.initClass(Canvas,width,height,null);_this.canvas.context.drawImage(_this.div,0,0,width,height);return _this.canvas.context.getImageData(0,0,width,height)};this.ready=function(){return _this.div.readyState>0};this.end=function(){_this.active=false;_this.div.pause();if(_stream)_stream.getTracks()[0].enabled=false};this.restart=function(){_this.div.play();if(_stream)_stream.getTracks()[0].enabled=true;_this.active=true}});Class(function Attractor(_target,_radius,_strength){Inherit(this,Component);var _this=this;var _delta;_strength=_strength||100;_radius=_radius||1e3;var _radiusSq=_radius*_radius;var _lenSq=0;this.target=_target;(function(){initVector()}());function initVector(){var Vector=typeof _target.z!=="undefined"?Vector3:Vector2;_delta=new Vector}this.get("strength",function(){return _strength});this.set("strength",function(force){_strength=force});this.get("radius",function(){return _radius});this.set("radius",function(radius){_radius=radius;_radiusSq=radius*radius});this.applyBehavior=function(p,dt){if(p.fixed)return;_delta.copy(_target).sub(p.pos);var distSq=_delta.lengthSq();if(distSq<_radiusSq&&distSq>.000001){_delta.normalize().multiplyScalar(1-distSq/_radiusSq);p.acc.add(_delta.multiplyScalar(_strength))}}});Class(function Collision(_useMass,_callback){Inherit(this,Component);var _this=this;var _delta,_vec;if(typeof _useMass!=="boolean")_useMass=true;this.pool=[];(function(){}());function createVector(p){var Vector=typeof p.z!=="undefined"?Vector3:Vector2;_delta=new Vector;_vec=new Vector}function fillPool(){var particles=_this.system.particles;var p=particles.start();while(p){_this.pool.push(p);p=particles.next()}}this.applyBehavior=function(p,dt,index){if(!_delta)createVector(p);var pool=this.pool;if(!pool.length)return defer(fillPool);var objects=pool.slice(index);var len=objects.length;for(var i=0;i<len;i++){var o=objects[i];if(o==p||o.fixed)continue;_delta.copy(o.pos).sub(p.pos);var distSq=_delta.lengthSq();var radii=p.radius+o.radius;if(distSq<=radii*radii){var dist=Math.sqrt(distSq);var overlap=radii-dist;overlap+=.5;var mt=p.mass+o.mass;var r1=_useMass?o.mass/mt:.5;var r2=_useMass?p.mass/mt:.5;_vec.copy(_delta);if(!p.fixed)p.pos.add(_vec.normalize().multiplyScalar(overlap*-r1));o.pos.add(_delta.normalize().multiplyScalar(overlap*r2));if(_callback)_callback(p,o,overlap)}}}});Class(function EdgeCollision(_min,_max,_noVelocity){Inherit(this,Component);var _this=this;(function(){}());this.applyBehavior=function(p,dt){if(p.pos.x-p.radius<_min.x){p.pos.x=_min.x+p.radius}else if(p.pos.x+p.radius>_max.x){p.pos.x=_max.x-p.radius}if(p.pos.y-p.radius<_min.y){p.pos.y=_min.y+p.radius}else if(p.pos.y+p.radius>_max.y){p.pos.y=_max.y-p.radius}}});Class(function Force(_force){Inherit(this,Component);var _this=this;this.force=_force;if(!_force)throw"Force requires parameter Vector";this.applyBehavior=function(p,dt){p.acc.add(_force)}});Class(function Gravity(_force){Inherit(this,Component);var _this=this;this.force=_force;if(!_force)throw"Gravity requires parameter Vector";this.applyBehavior=function(p,dt){p.vel.add(_force)}});Class(function Particle(_pos,_mass,_radius){var _this=this;var _vel,_acc,_old;var prototype=Particle.prototype;this.mass=_mass||1;this.massInv=1/this.mass;this.enabled=true;this.radius=_radius||1;this.radiusSq=this.radius*this.radius;this.behaviors=new LinkedList;this.fixed=false;(function(){initVectors()}());function initVectors(){var Vector=typeof _pos.z==="number"?Vector3:Vector2;_vel=new Vector;_acc=new Vector;_old={};_old.pos=new Vector;_old.acc=new Vector;_old.vel=new Vector;_old.pos.copy(_pos);_this.pos=_this.position=_pos;_this.vel=_this.velocity=_vel;_this.acc=_this.acceleration=_acc;_this.old=_old}this.moveTo=function(pos){_pos.copy(pos);_old.pos.copy(_pos);_acc.set(0,0,0);_vel.set(0,0,0)};if(typeof prototype.setMass!=="undefined")return;prototype.setMass=function(mass){this.mass=mass||1;this.massInv=1/this.mass};prototype.setRadius=function(radius){this.radius=radius;this.radiusSq=radius*radius};prototype.update=function(dt){if(!this.behaviors.length)return;var b=this.behaviors.start();while(b){b.applyBehavior(this,dt);b=this.behaviors.next()}};prototype.applyForce=function(force){this.acc.add(force)};prototype.addBehavior=function(behavior){if(!behavior||typeof behavior.applyBehavior==="undefined")throw"Behavior must have applyBehavior method";this.behaviors.push(behavior)};prototype.removeBehavior=function(behavior){if(!behavior||typeof behavior.applyBehavior==="undefined")throw"Behavior must have applyBehavior method";this.behaviors.remove(behavior)};prototype.addParticle=function(p){if(!this.children){this.children=[];this.childList=new LinkedList}this.children.push(p);this.childList.push(p)}});Class(function ParticlePhysics(_integrator){Inherit(this,Component);var _this=this;_integrator=_integrator||new EulerIntegrator;var _timestep=1/60;var _time=0;var _step=0;var _clock=null;var _buffer=0;var _toDelete=[];this.friction=1;this.maxSteps=1;this.emitters=new LinkedList;this.initializers=new LinkedList;this.behaviors=new LinkedList;this.particles=new LinkedList;this.springs=new LinkedList;function init(p){var i=_this.initializers.start();while(i){i(p);i=_this.initializers.next()}}function updateSprings(dt){var s=_this.springs.start();while(s){s.update(dt);s=_this.springs.next()}}function deleteParticles(){for(var i=_toDelete.length-1;i>-1;i--){var particle=_toDelete[i];_this.particles.remove(particle);particle.system=null}_toDelete.length=0}function updateParticles(dt,list=_this.particles){var index=0;var p=list.start();while(p){if(p.enabled){var b=_this.behaviors.start();while(b){b.applyBehavior(p,dt,index);b=_this.behaviors.next()}if(p.behaviors.length)p.update(dt,index);if(p.childList)updateParticles(dt,p.childList)}index++;p=list.next()}}function integrate(dt){updateParticles(dt);if(_this.springs.length)updateSprings(dt);if(!_this.skipIntegration)_integrator.integrate(_this.particles,dt,_this.friction)}this.addEmitter=function(emitter){if(!emitter.emit)throw"Emitter must be Emitter";this.emitters.push(emitter);emitter.parent=emitter.system=this};this.removeEmitter=function(emitter){if(!emitter.emit)throw"Emitter must be Emitter";this.emitters.remove(emitter);emitter.parent=emitter.system=null};this.addInitializer=function(init){if(typeof init!=="function")throw"Initializer must be a function";this.initializers.push(init)};this.removeInitializer=function(init){this.initializers.remove(init)};this.addBehavior=function(b){this.behaviors.push(b);b.system=this};this.removeBehavior=function(b){this.behaviors.remove(b)};this.addParticle=function(p){if(!_integrator.type){if(typeof p.pos.z==="number")_integrator.type="3D";else _integrator.type="2D"}p.system=this;this.particles.push(p);if(this.initializers.length)init(p)};this.removeParticle=function(p){p.system=null;_toDelete.push(p)};this.addSpring=function(s){s.system=this;this.springs.push(s)};this.removeSpring=function(s){s.system=null;this.springs.remove(s)};this.update=function(force){if(!_clock)_clock=THREAD?Date.now():Render.TIME;var time=THREAD?Date.now():Render.TIME;var delta=time-_clock;if(!force&&delta<=0)return;delta*=.001;_clock=time;_buffer+=delta;if(!force){var i=0;while(_buffer>=_timestep&&i++<_this.maxSteps){integrate(_timestep);_buffer-=_timestep;_time+=_timestep}}else{integrate(.016)}_step=Date.now()-time;if(_toDelete.length)deleteParticles()}});Class(function Spring(_p1,_p2,_damping,_friction){Inherit(this,Component);var _this=this;var Vector=typeof _p1.z!=="undefined"?Vector3:Vector2;var _dist=new Vector;var _acc=new Vector;var _vel=new Vector;function zero(num){if(Math.abs(num)<.001)return 0;return num}this.update=function(){_dist.subVectors(_p2,_p1);_acc.copy(_dist).multiplyScalar(_damping);_vel.add(_acc).multiplyScalar(_friction);_p1.add(_vel)};this.getDistance=function(){return zero(_dist.length())};this.getDistanceSq=function(){return zero(_dist.lengthSq())};this.set("position",function(p){_p1=p});this.get("position",function(){return _p1});this.set("target",function(p){_p2=p});this.get("target",function(){return _p2});this.set("damping",function(v){_damping=v});this.get("damping",function(){return _damping});this.set("friction",function(v){_friction=v});this.get("friction",function(){return friction})});Class(function SpringPhysics(_p1,_p2,_stiffness,_length){var _this=this;var Vector=typeof _p1.pos.z!=="undefined"?Vector3:Vector2;var _delta=new Vector;var _vec=new Vector;_length=_length||_vec.subVectors(_p1.pos,_p2.pos).length();this.update=function(dt){_delta.copy(_p2.pos).sub(_p1.pos);_vec.copy(_delta);var dist=_delta.length()+1e-7;var force=(dist-_length)/(dist*(_p1.massInv+_p2.massInv))*_stiffness;if(!_p1.fixed){_p1.vel.add(_vec.multiplyScalar(force*_p1.massInv))}if(!_p2.fixed){_p2.vel.add(_delta.multiplyScalar(-force*_p2.massInv))}}});Class(function ParticleFlow(_dimensions,_subdivisions=3){Inherit(this,Component);var _this=this;var _voxels={};var _list=new LinkedList;var _v3=new Vector3;this.noiseScale=10;this.force=new Vector3(0,0,0);this.forceBlend=0;this.strength=1;(function(){initVoxels()}());function initVoxels(){for(let x=0;x<_subdivisions;x++){let xpos=Math.range(x,0,_subdivisions-1,_dimensions.x.min,_dimensions.x.max);for(let y=0;y<_subdivisions;y++){let ypos=Math.range(y,0,_subdivisions-1,_dimensions.y.min,_dimensions.y.max);for(let z=0;z<_subdivisions;z++){let zpos=Math.range(z,0,_subdivisions-1,_dimensions.z.min,_dimensions.z.max);let voxel=new Vector3(xpos,ypos,zpos);voxel.d=new Vector3(1,1,1);_voxels[`${x}-${y}-${z}`]=voxel;voxel.ix=x;voxel.iy=y;voxel.iz=z;_list.push(voxel)}}}}function loop(){let t=Render.TIME;let v=_list.start();while(v){let x=.01+v.ix/_subdivisions+t;let y=.01+v.iy/_subdivisions+t;let z=.01+v.iz/_subdivisions+t;let noise=Noise.perlin3(x*_this.noiseScale,y*_this.noiseScale,z*_this.noiseScale);v.d.set(noise,-noise,noise).normalize().lerp(_this.force,_this.forceBlend);v=_list.next()}}this.update=function(){loop()};this.start=function(){_this.startRender(loop)};this.stop=function(){_this.stopRender(loop)};this.applyBehavior=function(p){let x=~~Math.range(p.pos.x,_dimensions.x.min,_dimensions.x.max,0,_subdivisions-1);let y=~~Math.range(p.pos.y,_dimensions.y.min,_dimensions.y.max,0,_subdivisions-1);let z=~~Math.range(p.pos.z,_dimensions.z.min,_dimensions.z.max,0,_subdivisions-1);let voxel=_voxels[`${x}-${y}-${z}`];if(!voxel)return;let friction=typeof p.friction!=="undefined"?p.friction:1;_v3.copy(voxel.d).multiplyScalar(.4*_this.strength*friction);p.applyForce(_v3);if(p.pos.x<_dimensions.x.min){p.pos.x=_dimensions.x.max*.95;p.vel.multiplyScalar(0);p.acc.multiplyScalar(0)}else if(p.pos.x>_dimensions.x.max){p.pos.x=_dimensions.x.min*.95;p.vel.multiplyScalar(0);p.acc.multiplyScalar(0)}if(p.pos.y<_dimensions.y.min){p.pos.y=_dimensions.y.max*.95;p.vel.multiplyScalar(0);p.acc.multiplyScalar(0)}else if(p.pos.y>_dimensions.y.max){p.pos.y=_dimensions.y.min*.95;p.vel.multiplyScalar(0);p.acc.multiplyScalar(0)}if(p.pos.z<_dimensions.z.min){p.pos.z=_dimensions.z.max*.95;p.vel.multiplyScalar(0);p.acc.multiplyScalar(0)}else if(p.pos.z>_dimensions.z.max){p.pos.z=_dimensions.z.min*.95;p.vel.multiplyScalar(0);p.acc.multiplyScalar(0)}}});Class(function EulerIntegrator(){Inherit(this,Component);var _this=this;var _vel,_accel;this.useDeltaTime=false;(function(){}());function createVectors(){var Vector=_this.type=="3D"?Vector3:Vector2;_vel=new Vector;_accel=new Vector}this.integrate=function(particles,dt,drag){if(!_vel)createVectors();var dtSq=dt*dt;var p=particles.start();while(p){if(!p.fixed&&p.enabled){p.old.pos.copy(p.pos);p.acc.multiplyScalar(p.massInv);_vel.copy(p.vel);_accel.copy(p.acc);if(this.useDeltaTime){p.pos.add(_vel.multiplyScalar(dt)).add(_accel.multiplyScalar(.5*dtSq));p.vel.add(p.acc.multiplyScalar(dt))}else{p.pos.add(_vel).add(_accel.multiplyScalar(.5));p.vel.add(p.acc)}if(drag)p.vel.multiplyScalar(drag);p.acc.set(0,0,0)}if(p.saveTo)p.saveTo.copy(p.pos);p=particles.next()}}});Class(function VerletIntegrator(){Inherit(this,Component);var _this=this;var _pos;(function(){}());function createVectors(){var Vector=_this.type=="3D"?Vector3:Vector2;_pos=new Vector}this.integrate=function(particles,dt,drag){if(!_pos)createVectors();var dtSq=dt*dt;var p=particles.start();while(p){if(!p.fixed){p.acc.multiplyScalar(p.massInv);p.vel.copy(p.pos).sub(p.old.pos);if(drag)p.vel.multiplyScalar(drag);p.acc.multiplyScalar(dtSq);p.vel.add(p.acc);_pos.copy(p.pos).add(p.vel);p.old.pos.copy(p.pos);p.pos.copy(_pos);p.acc.clear()}if(p.saveTo)p.saveTo.copy(p.pos);p=particles.next()}}});Class(function Emitter(_position,_startNumber){Inherit(this,Component);var _this=this;var _pool;var _total=0;var Vector=_position.type=="vector3"?Vector3:Vector2;this.initializers=[];this.position=_position;this.autoEmit=1;this.persist=true;(function(){initObjectPool();if(_startNumber!=0)addParticles(_startNumber||100)}());function initObjectPool(){_pool=_this.initClass(ObjectPool);_this.pool=_pool}function addParticles(total){_total+=total;var particles=[];for(var i=0;i<total;i++){particles.push(new Particle)}_pool.insert(particles)}this.addInitializer=function(callback){if(typeof callback!=="function")throw"Initializer must be a function";this.initializers.push(callback)};this.removeInitializer=function(callback){var index=this.initializers.indexOf(callback);if(index>-1)this.initializers.splice(index,1)};this.emit=function(num){if(!this.parent)throw"Emitter needs to be added to a System";num=num||this.autoEmit;for(var i=0;i<num;i++){var p=_pool.get();if(!p)return;p.moveTo(this.position);p.emitter=this;p.enabled=true;if(!p.system)this.parent.addParticle(p);for(var j=0;j<this.initializers.length;j++){this.initializers[j](p,i/num)}}};this.remove=function(particle){_pool.put(particle);if(!_this.persist)_this.parent.removeParticle(particle);particle.enabled=false};this.mix=function(){for(var i=0;i<6;i++)Utils.shuffleArray(_pool.array)};this.addToPool=function(particle){_pool.put(particle);if(!_this.persist&&particle.system)_this.parent.removeParticle(particle);particle.enabled=false}});Class(function RayTraceBackground(_config,_params){Inherit(this,Object3D);let _this=this;let _geometry,_shader,_mesh;var _numColors=findColors();if(Utils.query("colors"))_numColors=Utils.query("colors");(function(){initGeometry();initShader();initMesh();initGui()}());function findColors(){if(_config){let colors=0;for(let i=1;i<100;i++){if(typeof _config["uColor_"+i]!=="undefined"){colors=i}}return colors}return 4}function initGeometry(){_geometry=new THREE.PlaneBufferGeometry(2,2)}function initShader(){let shader=_params&&_params.shader?_params.shader:"RayTraceBackground";_shader=_this.initClass(Shader,shader,{uResolution:World.RESOLUTION,uTime:World.TIME,uFOV:{type:"f",value:1},uDiffuse:{type:"f",value:.02},uBaseColor:{type:"c",value:new THREE.Color},uRotSpeed:{type:"v2",value:new Vec2},uSolid:{type:"f",value:0},uColor:{type:"v3v",value:[]},uRotation:{type:"v2v",value:[]},uStrength:{type:"fv1",value:[]},uOpacity:{type:"fv1",value:[]},uFalloff:{type:"fv1",value:[]},uSpread:{type:"fv1",value:[]},depthWrite:false,depthTest:false});for(let i=0;i<_numColors;i++){addColorUniforms(i+1)}function addColorUniforms(i){_shader.uniforms.uColor.value.push(new THREE.Color);_shader.uniforms.uRotation.value.push(new Vec2);_shader.uniforms.uStrength.value.push(0);_shader.uniforms.uOpacity.value.push(0);_shader.uniforms.uFalloff.value.push(0);_shader.uniforms.uSpread.value.push(0)}_shader.vertexShader=_shader.vertexShader.replaceAll("__NUM_BG_COLORS__",_numColors);_shader.fragmentShader=_shader.fragmentShader.replaceAll("__NUM_BG_COLORS__",_numColors);let controls=_params&&_params.useControls==false?" * -IDENTITY":" * -normalMatrix";_shader.vertexShader=_shader.vertexShader.replaceAll("__MOUSE_CONTROLS__",controls);_shader.fragmentShader=_shader.fragmentShader.replaceAll("__MOUSE_CONTROLS__",controls);_this.shader=_shader}function initMesh(){_mesh=new THREE.Mesh(_geometry,_shader.material);_mesh.renderOrder=0;_mesh.frustumCulled=false;_this.add(_mesh)}function initGui(){if(!_config){_this.initClass(RayTraceBackgroundGUI,_shader.uniforms,_numColors);return}for(let prop in _config){RayTraceBackgroundGUI.updateUniform(_shader.uniforms,_config,prop)}}this.transition=function(config,duration,ease){let uniforms={uFOV:{type:"f",value:1},uDiffuse:{type:"f",value:.02},uBaseColor:{type:"c",value:new THREE.Color},uRotSpeed:{type:"v2",value:new Vec2},uColor:{type:"v3v",value:[]},uRotation:{type:"v2v",value:[]},uStrength:{type:"fv1",value:[]},uOpacity:{type:"fv1",value:[]},uFalloff:{type:"fv1",value:[]},uSpread:{type:"fv1",value:[]}};for(let i=0;i<_numColors;i++){addColorUniforms(i+1)}function addColorUniforms(i){uniforms.uColor.value.push(new THREE.Color);uniforms.uRotation.value.push(new Vec2);uniforms.uStrength.value.push(0);uniforms.uOpacity.value.push(0);uniforms.uFalloff.value.push(0);uniforms.uSpread.value.push(0)}for(let prop in config){RayTraceBackgroundGUI.updateUniform(uniforms,config,prop)}let anim={x:0};let last=0;return tween(anim,{x:1},duration||1e3,ease||"easeOutCubic").onUpdate(v=>{let diff=v-last;last=v;let lerp=Math.min(1,diff/(1-v));for(let prop in uniforms){if(uniforms[prop].value.forEach){uniforms[prop].value.forEach((v,i)=>{if(_shader.uniforms[prop].value[i].lerp){_shader.uniforms[prop].value[i].lerp(v,lerp)}else{_shader.uniforms[prop].value[i]+=(v-_shader.uniforms[prop].value[i])*lerp}})}else{let v=uniforms[prop].value;if(_shader.uniforms[prop].value.lerp){_shader.uniforms[prop].value.lerp(v,lerp)}else{_shader.uniforms[prop].value+=(v-_shader.uniforms[prop].value)*lerp}}}})};this.toSolid=function(duration){_shader.tween("uSolid",1,duration,"easeInOutCubic")};this.fromSolid=function(duration){_shader.tween("uSolid",0,duration,"easeInOutCubic")}});Class(function RayTraceBackgroundGUI(_uniforms,_numColors){Inherit(this,Component);const _this=this;let _config;this.name=Utils.query("name")||"";(function(){if(Global.PLAYGROUND){new AssetLoader(["assets/js/app/modules/raytracebackground/_dat.gui.min.js"]);AssetLoader.waitForLib("dat",()=>{initConfig();initGui()})}}());function initConfig(){let saved=Assets.JSON[`data/raytracebg_${_this.name}`];if(saved)return _config=saved;_config={uBaseColor:"#3b314a",uRotSpeed_x:0,uRotSpeed_y:0,uDiffuse:.03,uFOV:1};for(let i=0;i<_numColors;i++){addColorData(i+1)}function addColorData(i){_config[`uColor_${i}`]=Utils.randomColor();_config[`uRotation_${i}_x`]=0;_config[`uRotation_${i}_y`]=0;_config[`uStrength_${i}`]=1;_config[`uOpacity_${i}`]=1;_config[`uSpread_${i}`]=.1;_config[`uFalloff_${i}`]=.1}}function initGui(){let gui=new dat.gui.GUI;gui.remember(_config);let g1=gui.addFolder("Common");g1.addColor(_config,"uBaseColor").onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uBaseColor`));g1.add(_config,"uDiffuse").min(0).max(1).step(.01).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uDiffuse`));g1.add(_config,"uFOV").min(0).max(5).step(.05).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uFOV`));g1.add(_config,"uRotSpeed_x").min(-1).max(1).step(.05).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uRotSpeed_x`));g1.add(_config,"uRotSpeed_y").min(-1).max(1).step(.05).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uRotSpeed_y`));for(let i=0;i<_numColors;i++){addColorGUI(i+1)}function addColorGUI(i){let g=gui.addFolder(`Color ${i}`);g.addColor(_config,`uColor_${i}`).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uColor_${i}`));g.add(_config,`uStrength_${i}`).min(1).max(5).step(.05).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uStrength_${i}`));g.add(_config,`uOpacity_${i}`).min(0).max(1).step(.01).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uOpacity_${i}`));g.add(_config,`uSpread_${i}`).min(0).max(1).step(.01).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uSpread_${i}`));g.add(_config,`uFalloff_${i}`).min(0).max(1).step(.01).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uFalloff_${i}`));g.add(_config,`uRotation_${i}_x`).min(-1).max(1).step(.01).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uRotation_${i}_x`));g.add(_config,`uRotation_${i}_y`).min(-1).max(1).step(.01).onChange(()=>RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uRotation_${i}_y`))}for(let prop in _config){RayTraceBackgroundGUI.updateUniform(_uniforms,_config,prop)}gui.close();let keysDown=0;__window.keydown(e=>{if(e.keyCode>=49&&e.keyCode<=57){if(_this[`isKey${e.keyCode-48}`])return;_this[`isKey${e.keyCode-48}`]=true;keysDown++;World.CONTROLS.enabled=false}if((e.ctrlKey||e.metaKey)&&e.keyCode==83){e.preventDefault();write()}});__window.keyup(e=>{if(e.keyCode>=49&&e.keyCode<=57){_this[`isKey${e.keyCode-48}`]=false;keysDown--;if(keysDown===0)World.CONTROLS.enabled=true}});function write(){Dev.writeFile(`assets/data/raytracebg_${_this.name}.json`,_config);__body.css({display:"none"});_this.delayedCall(()=>{__body.css({display:"block"})},100)}_this.events.sub(Mouse.input,Interaction.DRAG,()=>{let isUpdate=false;for(let i=1;i<=9;i++){if(_this[`isKey${i}`]){if(_config[`uRotation_${i}_x`]==undefined)continue;_config[`uRotation_${i}_x`]+=Mouse.delta.y*.001;_config[`uRotation_${i}_y`]+=Mouse.delta.x*.001;if(_config[`uRotation_${i}_x`]<-1)_config[`uRotation_${i}_x`]+=2;if(_config[`uRotation_${i}_y`]<-1)_config[`uRotation_${i}_y`]+=2;if(_config[`uRotation_${i}_x`]>1)_config[`uRotation_${i}_x`]-=2;if(_config[`uRotation_${i}_y`]>1)_config[`uRotation_${i}_y`]-=2;RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uRotation_${i}_x`);RayTraceBackgroundGUI.updateUniform(_uniforms,_config,`uRotation_${i}_y`);isUpdate=true}}if(isUpdate)gui.updateDisplay()})}},()=>{RayTraceBackgroundGUI.updateUniform=function(uniforms,_config,prop){if(~prop.indexOf("_")){let split=prop.split("_");if(split.length>2){uniforms[split[0]].value[parseInt(split[1])-1][split[2]]=_config[prop]}else if(isNaN(parseInt(split[1]))){uniforms[split[0]].value[split[1]]=_config[prop]}else{updateValue(uniforms[split[0]],_config[prop],parseInt(split[1])-1)}}else{updateValue(uniforms[prop],_config[prop])}function updateValue(uniform,value,index){if(typeof index=="number"){if(typeof value=="number"){uniform.value[index]=value}else{uniform.value[index].set(value)}}else{if(typeof value=="number"){uniform.value=value}else{uniform.value.set(value)}}}}});Class(function RenderGL(){Inherit(this,Component);const _this=this;const _evt={stage:null,camera:null};var _dpr=null;this.NORMAL="normal";this.WEBVR="webvr";this.STEREO="stereo";this.ARKIT="ARKit";this.ARCORE="ARCore";this.AR="AR";this.DAYDREAM="daydream";this.GEARVR="gearVR";this.RENDER="rendergl_render";this.READY="render_gl_ready";(function(){_this.events.sub(Events.RESIZE,resizeHandler)}());function onRenderEye(stage,camera){_evt.stage=stage;_evt.camera=camera;_this.events.fire(_this.RENDER,_evt)}function resizeHandler(){_this.renderer&&_this.renderer.setSize(Stage.width,Stage.height)}this.set("DPR",v=>{_dpr=v;if(_this.renderer)_this.renderer.setSize(Stage.width,Stage.height)});this.get("DPR",v=>{return _dpr});this.initialize=function(type,params={}){if(_this.camera)_this.camera.destroy();if(_this.renderer)_this.renderer.destroy();if(type==_this.AR){if(Device.system.os=="ios")type=_this.ARKIT;else type=_this.ARCORE}if(type==_this.ARKIT){if(!window.ARKit)throw"RenderGL.ARKIT requires ARKit module";ARKit.init()}if(type==_this.ARCORE){if(!window.ARCore)throw"RenderGL.ARCORE requires ARCore module";ARCore.init()}if(!_this.threeRenderer){let camera=new THREE.PerspectiveCamera(45,Stage.width/Stage.height,.01,200);_this.threeRenderer=function(){if(window.ARKit&&window.ARKit.renderer)return ARKit.renderer;if(window.ARCore&&window.ARCore.renderer)return ARCore.renderer;if(window._canvas)params.canvas=window._canvas;let renderer=new THREE.WebGLRenderer(params);renderer.setSize(Stage.width,Stage.height);renderer.setPixelRatio(World.DPR);return renderer}();_this.scene=function(){if(window.ARKit&&window.ARKit.scene)return ARKit.scene;if(window.ARCore&&window.ARCore.scene)return ARCore.scene;return new THREE.Scene}();_this.nuke=_this.initClass(Nuke,Stage,{renderer:_this.threeRenderer,scene:_this.scene,camera:camera,dpr:World.DPR})}_dpr=_dpr||World.DPR||1;switch(type){case _this.WEBVR:_this.renderer=_this.initClass(VRRenderer,_this.threeRenderer,_this.nuke);_this.camera=_this.initClass(VRCamera);break;case _this.STEREO:_this.renderer=_this.initClass(VRStereoRenderer,_this.threeRenderer,_this.nuke);_this.camera=_this.initClass(VRStereoCamera);break;case _this.NORMAL:_this.renderer=_this.initClass(RenderGLRenderer,_this.threeRenderer,_this.nuke);_this.camera=_this.initClass(RenderGLCamera);break;case _this.ARKIT:_this.renderer=_this.initClass(RenderGLRenderer,ARKit.renderer,_this.nuke);_this.camera=ARKit;break;case _this.ARCORE:_this.renderer=_this.initClass(RenderGLRenderer,ARCore.renderer,_this.nuke);_this.camera=ARCore;break;case _this.DAYDREAM:_this.renderer=_this.initClass(DaydreamRenderer,_this.threeRenderer,_this.nuke);_this.camera=_this.initClass(DaydreamCamera);break}_this.type=type;_this.nuke.camera=_this.camera.worldCamera;_this.renderer.onRenderEye=onRenderEye;defer(()=>{_this.events.fire(_this.READY)})};this.render=function(scene,camera,renderTarget,forceClear){_this.renderer.render(scene||_this.scene,camera||_this.camera.worldCamera,renderTarget,forceClear)};this.startRender=function(){Render.start(_this.render)};this.stopRender=function(){Render.stop(_this.render)};this.requestPresent=function(bool){_this.renderer.requestPresent&&_this.renderer.requestPresent(bool)};this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler);_this.renderer.setSize(width,height)};this.set("onRenderEye",callback=>{_this.renderer.onRenderEye=callback})},"static");Class(function RenderGLCamera(){Inherit(this,Component);const _this=this;this.worldCamera=new THREE.PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3);_this.events.sub(Events.RESIZE,()=>{_this.worldCamera.aspect=Stage.width/Stage.height;_this.worldCamera.updateProjectionMatrix()})});Class(function RenderGLRenderer(_renderer,_nuke){Inherit(this,Component);const _this=this;this.render=function(scene,camera){_nuke.camera=camera;_this.onRenderEye&&_this.onRenderEye(Stage,camera);if(_nuke){_nuke.render()}else{_renderer.render(scene,camera)}};this.setSize=function(width,height){_renderer.setPixelRatio(RenderGL.DPR);_renderer.setSize(width,height)}});Class(function PushState(_isHash){const _this=this;let _store;let _root="";if(typeof _isHash!=="boolean")_isHash=Hydra.LOCAL||!Device.system.pushstate;this.isLocked=false;(function(){addHandlers();_store=getState()}());function addHandlers(){if(_isHash)return window.addEventListener("hashchange",()=>handleStateChange(getState()),false);window.onpopstate=history.onpushstate=()=>handleStateChange(getState())}function getState(){if(_isHash)return String(window.location.hash.slice(3));return(_root!=="/"?location.pathname.split(_root)[1]:location.pathname.slice(1))||""}function handleStateChange(state){if(state===_store)return;if(_this.isLocked){if(!_store)return;if(_isHash)window.location.hash="!/"+_store;else window.history.pushState(null,null,_root+_store);return}_store=state;_this.events.fire(Events.UPDATE,{value:state,split:state.split("/")})}this.getState=function(){if(Device.mobile.native)return Storage.get("app_state")||"";return getState()};this.setRoot=function(root){_root=root.charAt(0)==="/"?root:"/"+root};this.setState=function(state){if(Device.mobile.native)Storage.set("app_state",state);if(state===_store)return;_store=state;if(_isHash)window.location.hash="!/"+state;else window.history.pushState(null,null,_root+state)};this.replaceState=function(state){if(state===_store)return;_store=state;if(_isHash)window.location.hash="!/"+state;else window.history.replaceState(null,null,_root+state)};this.setTitle=function(title){document.title=title};this.lock=function(){this.isLocked=true};this.unlock=function(){this.isLocked=false};this.useHash=function(){_isHash=true}});Class(function Scroll(_object,_params){Inherit(this,Component);const _this=this;this.x=0;this.y=0;this.max={x:0,y:0};this.delta={x:0,y:0};this.enabled=true;const _scrollTarget={x:0,y:0};const _scrollInertia={x:0,y:0};let _axes=["y"];(function(){initParams();if(_this.object)style();addHandlers();resize();_this.startRender(loop)}());function initParams(){if(!_object||!_object.div){_params=_object;_object=null}if(!_params)_params={};_this.object=_object;_this.hitObject=_params.hitObject||_this.object;_this.max.y=_params.height||0;_this.max.x=_params.width||0;_this.scale=_params.scale||1;_this.drag=function(){if(typeof _params.drag!=="undefined")return _params.drag;return!!Device.mobile}();_this.mouseWheel=_params.mouseWheel!==false;_this.limit=_params.limit!==false;if(Array.isArray(_params.axes))_axes=_params.axes}function style(){if(Device.mobile.phone){_this.object.overflowScroll({y:1,x:0})}else{_this.object.css({overflowY:"auto",overflowX:"hidden"})}}function loop(){if(_this.object){if(Math.round(_this.object.div.scrollLeft)!==Math.round(_this.x)||Math.round(_this.object.div.scrollTop)!==Math.round(_this.y)){_this.x=_scrollTarget.x=_this.object.div.scrollLeft;_this.y=_scrollTarget.y=_this.object.div.scrollTop;stopInertia()}}_axes.forEach(axis=>{if(_this.isInertia){_scrollInertia[axis]*=.9;_scrollTarget[axis]+=_scrollInertia[axis]}if(_this.limit)_scrollTarget[axis]=Math.max(_scrollTarget[axis],0);if(_this.limit)_scrollTarget[axis]=Math.min(_scrollTarget[axis],_this.max[axis]/_this.scale);_this.delta[axis]=(_scrollTarget[axis]*_this.scale-_this[axis])*.5;_this[axis]+=_this.delta[axis];if(Math.abs(_this.delta[axis])<.01)_this.delta[axis]=0;if(Math.abs(_this[axis])<.001)_this[axis]=0;if(_this.object){if(axis=="x")_this.object.div.scrollLeft=Math.round(_this.x);if(axis=="y")_this.object.div.scrollTop=Math.round(_this.y)}})}function stopInertia(){_this.isInertia=false;clearTween(_scrollTarget)}function addHandlers(){if(!Device.mobile){if(Device.system.browser=="ie"){window.addEventListener("wheel",scroll,true)}else{__window.bind("wheel",scroll)}}if(_this.drag){if(_this.hitObject)_this.hitObject.bind("touchstart",e=>e.preventDefault());let input=_this.hitObject?_this.initClass(Interaction,_this.hitObject):Mouse.input;_this.events.sub(input,Interaction.START,down);_this.events.sub(input,Interaction.DRAG,drag);_this.events.sub(input,Interaction.END,up)}_this.events.sub(Events.RESIZE,resize)}function scroll(e){if(!_this.enabled)return;if(e.preventDefault)e.preventDefault();if(!_this.mouseWheel)return;stopInertia();_axes.forEach(axis=>{let delta="delta"+axis.toUpperCase();if(Device.system.os=="mac"){if(Device.system.browser=="firefox"){if(e.deltaMode===1){_scrollTarget[axis]+=e[delta]*4;_scrollInertia[axis]=e[delta]*4;_this.isInertia=true;return}_scrollTarget[axis]+=e[delta];return}if(Device.system.browser.includes(["chrome","safari"])){_scrollTarget[axis]+=e[delta]*.33;_scrollInertia[axis]=e[delta]*.33;_this.isInertia=true;return}}if(Device.system.os=="windows"){if(Device.system.browser=="firefox"){if(e.deltaMode===1){_scrollTarget[axis]+=e[delta]*10;_scrollInertia[axis]=e[delta]*10;_this.isInertia=true;return}}}_scrollTarget[axis]+=e[delta]})}function down(){if(!_this.enabled)return;stopInertia()}function drag(){if(!_this.enabled)return;_axes.forEach(axis=>{_scrollTarget[axis]-=Mouse.delta[axis]})}function up(){if(!_this.enabled)return;const m=function(){if(Device.system.os=="android")return 35;return 25}();const obj={};_axes.forEach(axis=>{obj[axis]=_scrollTarget[axis]-Mouse.delta[axis]*m});tween(_scrollTarget,obj,25e2,"easeOutQuint")}function resize(){if(!_this.enabled)return;stopInertia();if(!_this.object)return;const p={};if(Device.mobile)_axes.forEach(axis=>p[axis]=_this.max[axis]?_scrollTarget[axis]/_this.max[axis]:0);if(typeof _params.height=="undefined")_this.max.y=_this.object.div.scrollHeight-_this.object.div.clientHeight;if(typeof _params.width=="undefined")_this.max.x=_this.object.div.scrollWidth-_this.object.div.clientWidth;if(Device.mobile)_axes.forEach(axis=>_this[axis]=_scrollTarget[axis]=p[axis]*_this.max[axis])}this.reset=function(){_this.object.div.scrollLeft=_this.x=0;_this.object.div.scrollTop=_this.y=0;_scrollTarget.x=_scrollTarget.y=0;_scrollInertia.x=_scrollInertia.y=0};this.onDestroy=function(){__window.unbind("wheel",scroll)};this.resize=resize;this.scrollTo=function(value,axis="y"){let values={};values[axis]=value;tween(_scrollTarget,values,800,"easeInOutCubic")}});Class(function Shaders(){Inherit(this,Component);var _this=this;(function(){}());function parseSingleShader(code){let uniforms=code.split("#!UNIFORMS")[1].split("#!")[0];let varyings=code.split("#!VARYINGS")[1].split("#!")[0];let attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];while(code.includes("#!SHADER")){code=code.slice(code.indexOf("#!SHADER"));let split=code.split("#!SHADER")[1];let br=split.indexOf("\n");let name=split.slice(0,br).split(": ")[1];let glsl=split.slice(br);if(name.includes(".vs"))glsl=attributes+uniforms+varyings+glsl;else glsl=uniforms+varyings+glsl;let splitName=name.split(".");_this[splitName[0]+(splitName[1].includes("vs")?".vs":".fs")]=glsl;code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i];var text=split[i+1];if(text.includes("#!UNIFORMS")){parseSingleShader(text)}else{_this[name]=text}}}function parseRequirements(){for(var key in _this){var obj=_this[key];if(typeof obj==="string"){_this[key]=require(obj)}}}function require(shader){if(!shader.includes("require"))return shader;shader=shader.replace(/# require/g,"#require");while(shader.includes("#require")){var split=shader.split("#require(");var name=split[1].split(")")[0];name=name.replace(/ /g,"");if(!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;shader=shader.replace("#require("+name+")",_this[name])}return shader}this.parse=function(code,file){if(!code.includes("{@}")){file=file.split("/");file=file[file.length-1];_this[file]=code}else{parseCompiled(code);parseRequirements()}_this.shadersParsed=true};this.onReady=this.ready=function(callback){let promise=Promise.create();if(callback)promise.then(callback);_this.wait(()=>promise.resolve(),_this,"shadersParsed");return promise};this.getShader=function(string){if(_this.FALLBACKS){if(_this.FALLBACKS[string]){string=_this.FALLBACKS[string]}}var code=_this[string];if(code){while(code.includes("#test ")){try{var test=code.split("#test ")[1];var name=test.split("\n")[0];var glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];if(!eval(name)){code=code.replace(glsl,"")}code=code.replace("#test "+name+"\n","");code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}}}return code}},"static");Class(function Interaction3D(_camera){Inherit(this,Component);const _this=this;let _hover,_click;_camera=_camera||World.CAMERA;let _ray=_this.initClass(Raycaster,_camera);let _meshes=[];const _event={};this.cursor="auto";(function(){addHandlers();_this.enabled=true}());function parseMeshes(meshes){if(meshes.length===undefined)meshes=[meshes];let output=[];meshes.forEach(checkMesh);function checkMesh(obj){if(obj.type="Mesh"&&obj.isHitMesh){obj.mouseEnabled=function(visible){if(visible){if(!~_meshes.indexOf(obj))_meshes.push(obj)}else{_meshes.remove(obj)}};output.push(obj)}if(obj.children.length)obj.children.forEach(checkMesh)}return output}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.MOVE,move);_this.events.sub(Mouse.input,Interaction.CLICK,click)}function start(){if(!_this.enabled)return;let hit=move();if(hit){_click=hit.object;_click.time=Render.TIME}else{_click=null}}function move(){if(!_this.enabled){Stage.css("cursor",_this.cursor);return}let hit=_ray.checkHit(_meshes)[0];if(hit){let mesh=hit.object;if(_hover!==mesh){if(_hover)triggerHover("out",_hover);_hover=mesh;triggerHover("over",_hover);Stage.css("cursor","pointer")}return hit}else{if(_hover){triggerHover("out",_hover);_hover=null;Stage.css("cursor",_this.cursor)}return false}}function click(){if(!_this.enabled)return;if(!_click)return;let hit=_ray.checkHit(_meshes,Mouse)[0];if(hit&&hit.object===_click){triggerClick(_click)}_click=null}function triggerHover(action,mesh){_event.action=action;_event.mesh=mesh;_this.events.fire(Interaction3D.HOVER,_event,true);_hover.__hoverCallback&&_hover.__hoverCallback(_event)}function triggerClick(mesh){_event.action="click";_event.mesh=mesh;_this.events.fire(Interaction3D.CLICK,_event,true);_click.__clickCallback&&_click.__clickCallback(_event)}this.set("camera",c=>{_ray.camera=c});this.add=function(meshes,hover,click,isParse){if(meshes.length===undefined||isParse)meshes=parseMeshes(meshes);meshes.forEach(mesh=>{if(hover)mesh.__hoverCallback=hover;if(click)mesh.__clickCallback=click;_meshes.push(mesh)})};this.remove=function(meshes,isParse){if(meshes.length===undefined||isParse)meshes=parseMeshes(meshes);meshes.forEach(mesh=>{if(_hover==mesh)for(let i=_meshes.length-1;i>=0;i--){if(mesh===_meshes[i])_meshes.splice(i,1)}})};this.set("testVisibility",v=>_ray.testVisibility=v)},()=>{Interaction3D.HOVER="interaction3d_hover";Interaction3D.CLICK="interaction3d_click"});Class(function Lighting(){Inherit(this,Component);var _this=this;var _particleDepthShader;var _lights=[];(function(){}());function loop(){decomposeLights(_lights)}function decomposeLights(lights){for(var i=lights.length-1;i>-1;i--){var light=lights[i];if(!light.parent)light.updateMatrixWorld();else if(!light.parent.parent)light.parent.updateMatrixWorld();if(!light._world)light._world=new THREE.Vector3;light.getWorldPosition(light._world)}}function updateArrays(shader){var lights=shader.lights;var lighting=shader.__lighting;var light;lighting.position.length=0;lighting.color.length=0;lighting.intensity.length=0;lighting.distance.length=0;for(var i=0;i<lights.length;i++){light=lights[i];lighting.position.push(light._world);lighting.color.push(light.color.r,light.color.g,light.color.b);lighting.intensity.push(light.intensity);lighting.distance.push(light.distance)}for(i=0;i<_lights.length;i++){light=_lights[i];lighting.position.push(light._world);lighting.color.push(light.color.r,light.color.g,light.color.b);lighting.intensity.push(light.intensity);lighting.distance.push(light.distance)}}this.add=function(light){_lights.push(light);Render.start(loop)};this.remove=function(light){_lights.remove(light)};this.getLighting=function(shader,force){if(shader.__lighting&&!force)return shader.__lighting;var lighting={position:[],color:[],intensity:[],distance:[]};shader.__lighting=lighting;if(_lights[0]&&!_lights[0]._world)decomposeLights(_lights);decomposeLights(shader.lights);updateArrays(shader);return lighting};this.update=function(shader){decomposeLights(shader.lights);updateArrays(shader)};this.getParticleDepthShader=function(light,size){if(!_particleDepthShader){_particleDepthShader=new Shader("ParticleDepth");_particleDepthShader.uniforms={pointSize:{type:"f",value:size||5},lightPos:{type:"v3",value:light.position},far:{type:"f",value:light.shadow.camera.far}};_particleDepthShader.receiveShadow=true}var shader=_particleDepthShader.clone();shader.set("pointSize",size||5);shader.set("lightPos",light.position);shader.set("far",light.shadow.camera.far);return shader}},"static");Class(function Object3D(){Inherit(this,Component);var _this=this;this.group=new THREE.Group;this.freezeMatrix=function(group){group=group||_this.group;group.matrixAutoUpdate=false;group.updateMatrix()};this.add=function(child){this.group.add(child.group||child)};this.remove=function(child){this.group.remove(child.group||child)};this.onDestroy=function(){if(this.group&&this.group.parent)this.group.parent.remove(this.group)}});Class(function BasicPass(){Inherit(this,NukePass);var _this=this;this.fragmentShader=["varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","}"];this.init(this.fragmentShader)});Class(function FXLayer(_parentNuke,_directRender){Inherit(this,Component);var _this=this;var _nuke,_rt;var _scene=new THREE.Scene;var _objects=[];var _rts={};var _textureIndex=-1;var _id=Utils.timestamp();var _name=Utils.getConstructorName(_this);var _useDrawBuffers=!_directRender;this.resolution=1;this.autoVisible=true;this.enabled=true;this.directRender=_directRender;function editShader(mesh){let modifyShader=(shader,name)=>{let _=shader.material;let fs=shader.fragmentShader;let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");fs=split[0]+split[1]}while(fs.includes("#drawbuffer")){fs=fs.split("\n");for(let i=0;i<fs.length;i++){if(fs[i].includes("#drawbuffer"))fs[i]=""}fs=fs.join("\n")}shader.fragmentShader=shader.material.fragmentShader=fs};let shader=mesh.material.shader.clone();for(let key in mesh.material.uniforms){shader.uniforms[key]=mesh.material.uniforms[key]}modifyShader(mesh.material.shader,"Color");modifyShader(shader,_name);mesh.material=shader.material}function editDBShader(mesh){let modifyMarker=(fs,name,index)=>{let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");split[1]=split[1].replace("gl_FragColor",`gl_FragData[${index}]`);fs=split[0]+split[1]}return fs};let shader=mesh.material.shader;let fs=shader.fragmentShader;fs=modifyMarker(fs,"Color",0);fs=modifyMarker(fs,_name,_textureIndex);shader.fragmentShader=shader.material.fragmentShader=fs}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}function initRT(){if(_useDrawBuffers){let texture=new THREE.Texture;texture.minFilter=THREE.LinearFilter;texture.magFilter=THREE.LinearFilter;texture.format=THREE.RGBAFormat;texture.wrapS=texture.wrapT=THREE.ClampToEdgeWrapping;_textureIndex=_parentNuke.attachDrawBuffer(texture);_rt={texture}}else{_rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}_this.rt=_rt}function updateTopParent(obj){var parent=obj.parent;while(parent){parent.updateMatrixWorld();parent=parent.parent}}this.create=function(nuke,pass){if(!nuke)return;_useDrawBuffers=nuke.useDrawBuffers&&!_directRender;_this=this;_this.scene=_scene;_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:false});_nuke.parentNuke=nuke;_parentNuke=nuke;_this.nuke=_nuke;initRT();addListeners()};this.addObject=function(object){if(!_nuke)return;if(!_useDrawBuffers){var clone=object.clone();object["clone_"+_id]=clone;_scene.add(clone);_objects.push(object);editShader(clone)}else{editDBShader(object)}return clone};this.removeObject=function(object){if(!_nuke)return;_scene.remove(object["clone_"+_id]);_objects.remove(object);delete object["clone_"+_id]};this.render=this.draw=function(stage,camera){if(!_nuke||!_this.enabled||_useDrawBuffers)return;if(!_this.directRender&&(!_parentNuke.enabled||!_objects.length))return;if(stage){_nuke.stage=stage;_this.setSize(stage.width,stage.height)}if(camera){_nuke.camera=camera}else{_nuke.camera=_nuke.parentNuke.camera}for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i];var clone=obj["clone_"+_id];if(_this.autoVisible){clone.visible=true;var parent=obj;while(parent){if(parent.visible==false||parent.material&&parent.material.visible==false){clone.visible=false}parent=parent.parent}}if(_this.forceRender){clone.material.visible=true}obj.updateMatrixWorld();if(!obj.ignoreMatrix)Utils3D.decompose(obj,clone)}_nuke.rtt=_rt;_nuke.render()};this.addPass=function(pass){if(!_nuke)return;_nuke.add(pass)};this.removePass=function(pass){if(!_nuke)return;_nuke.remove(pass)};this.setSize=function(width,height){if(!_nuke)return;if(_rt.width==width&&_rt.height==height)return;_this.events.unsub(Events.RESIZE,resizeHandler);_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr);_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)};this.setDPR=function(dpr){if(!_nuke)return;_nuke.dpr=dpr;resizeHandler()};this.getObjects=function(){return _objects};if(_parentNuke instanceof Nuke)this.create(_parentNuke,_directRender)});Namespace("FX");Class(function Nuke(_stage,_params){Inherit(this,Component);var _this=this;if(!_params.renderer)console.error("Nuke :: Must define renderer");_this.stage=_stage;_this.renderer=_params.renderer;_this.camera=_params.camera;_this.scene=_params.scene;_this.rtt=_params.rtt;_this.enabled=_params.enabled==false?false:true;_this.passes=_params.passes||[];_this.useDrawBuffers=typeof _params.useDrawBuffers!=="undefined"?_params.useDrawBuffers:Device.graphics.webgl.detect("draw_buffers");var _dpr=_params.dpr||1;var _rts={};var _rtStack=[];var _rttPing,_rttPong,_nukeScene,_nukeMesh,_rttCamera,_rttBuffer;var _drawBuffers=[];(function(){initNuke();addListeners()}());function initNuke(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,false);_rttPong=Nuke.getRT(width,height,false);_rttBuffer=Nuke.getRT(width,height,_this.useDrawBuffers);_rttCamera=new THREE.OrthographicCamera(_this.stage.width/-2,_this.stage.width/2,_this.stage.height/2,_this.stage.height/-2,1,1e3);_nukeScene=new THREE.Scene;_nukeMesh=new THREE.Mesh(Nuke.getPlaneGeom(),new THREE.MeshBasicMaterial);_nukeScene.add(_nukeMesh)}function finalRender(scene,camera){if(_this.rtt){_this.renderer.render(scene,camera||_this.camera,_this.rtt)}else{_this.renderer.render(scene,camera||_this.camera)}_this.postRender&&_this.postRender()}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing.dispose();_rttPong.dispose();_rttPing.setSize(width,height);_rttPong.setSize(width,height);_rttBuffer.setSize(width,height);_rttCamera.left=_this.stage.width/-2;_rttCamera.right=_this.stage.width/2;_rttCamera.top=_this.stage.height/2;_rttCamera.bottom=_this.stage.height/-2;_rttCamera.updateProjectionMatrix()}_this.add=function(pass,index){if(!pass.pass){defer(function(){_this.add(pass,index)});return}if(typeof index=="number"){_this.passes.splice(index,0,pass);return}_this.passes.push(pass)};_this.remove=function(pass){if(typeof pass=="number"){_this.passes.splice(pass)}else{_this.passes.remove(pass)}};_this.renderToTexture=function(clear,rtt){_this.renderer.render(_this.scene,_this.camera,rtt||_rttPing,typeof clear=="boolean"?clear:true)};_this.render=function(){if(!_this.enabled||!_this.passes.length){finalRender(_this.scene);return}_this.renderer.render(_this.scene,_this.camera,_rttBuffer,true);var usedBuffer=false;var pingPong=true;for(var i=0;i<_this.passes.length-1;i++){_nukeMesh.material=_this.passes[i].pass;usedBuffer=true;_nukeMesh.material.uniforms.tDiffuse.value=i==0?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture;_this.renderer.render(_nukeScene,_rttCamera,pingPong?_rttPong:_rttPing);pingPong=!pingPong}_nukeMesh.material=_this.passes[_this.passes.length-1].pass;_nukeMesh.material.uniforms.tDiffuse.value=!usedBuffer?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture;finalRender(_nukeScene,_rttCamera)};_this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler);if(!_rts[width+"_"+height]){var rttPing=Nuke.getRT(width*_dpr,height*_dpr,_this.useDrawBuffers);var rttPong=Nuke.getRT(width*_dpr,height*_dpr,false);var rttBuffer=Nuke.getRT(width*_dpr,height*_dpr,false);_rts[width+"_"+height]={ping:rttPing,pong:rttPong,name:width+"_"+height,buffer:rttBuffer};_rtStack.push(_rts[width+"_"+height]);if(_rtStack.length>3){let rts=_rtStack.shift();delete _rts[rts.name];rts.ping.dispose();rts.pong.dispose();rts.buffer.dispose()}}var rts=_rts[width+"_"+height];_rttPing=rts.ping;_rttPong=rts.pong;_rttBuffer=rts.buffer;if(_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i])}};_this.attachDrawBuffer=function(texture){_drawBuffers.push(texture);if(_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i])}return _drawBuffers.length};_this.set("dpr",function(v){_dpr=v||Device.pixelRatio;resizeHandler()});_this.get("dpr",function(){return _dpr});_this.get("output",function(){return _nukeMesh.material.uniforms?_nukeMesh.material.uniforms.tDiffuse.value:null})},function(){var _plane;var _rts={};Nuke.getPlaneGeom=function(){if(!_plane)_plane=new THREE.PlaneBufferGeometry(2,2,1,1);return _plane};Nuke.getRT=function(width,height,multi){if(!multi){return Utils3D.createRT(width,height)}else{return Utils3D.createMultiRT(width,height)}}});Class(function NukePass(_fs,_uniforms,_pass){Inherit(this,Component);var _this=this;this.UILPrefix=typeof _fs=="string"?_fs:Utils.getConstructorName(_fs);function prefix(code){if(!code)throw`No shader ${_fs} found`;let pre="";pre+="precision highp float;\n";pre+="precision highp int;\n";if(!code.includes("uniform sampler2D tDiffuse")){pre+="uniform sampler2D tDiffuse;\n";pre+="varying vec2 vUv;\n"}code=pre+code;return code}function getVS(){return`
        precision highp float;
        precision highp int;

        varying vec2 vUv;

        attribute vec2 uv;
        attribute vec3 position;

        void main() {
            vUv = uv;
            gl_Position = vec4(position, 1.0);
        }
        `}this.init=function(fs){if(_this.pass)return;_this=this;let name=fs||this.constructor.toString().match(/function ([^\(]+)/)[1];let fragmentShader=Array.isArray(fs)?fs.join(""):null;_this.uniforms=_uniforms||{};_this.uniforms.tDiffuse={type:"t",value:null};if(_this.uniforms.unique)_this.UILPrefix+="_"+_this.uniforms.unique+"_";if(window.UILStorage){for(let key in _this.uniforms){if(key==="unique")continue;_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key)||_this.uniforms[key]}}_this.pass=new THREE.RawShaderMaterial({uniforms:_this.uniforms,vertexShader:getVS(),fragmentShader:fragmentShader||prefix(Shaders.getShader(name+".fs"))});_this.uniforms=_this.pass.uniforms};this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]);this.uniforms[key].value=value};this.tween=function(key,value,time,ease,delay,callback,update){tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.clone=function(){if(!_this.pass)_this.init(_fs);return new NukePass(null,null,_this.pass.clone())};if(typeof _fs==="string"){_this.init(_fs)}else if(_pass){_this.pass=_pass;_this.uniforms=_pass.uniforms}});Class(function FXLayer(_parentNuke,_type){Inherit(this,Component);var _this=this;var _nuke,_rt;var _scene=new THREE.Scene;var _objects=[];var _rts={};var _textureIndex=-1;var _id=Utils.timestamp();var _name=Utils.getConstructorName(_this);var _useDrawBuffers=true;this.resolution=1;this.autoVisible=true;this.enabled=true;function editShader(mesh){let modifyShader=(shader,name)=>{let _=shader.material;let fs=shader.fragmentShader;let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");fs=split[0]+split[1]}while(fs.includes("#drawbuffer")){fs=fs.split("\n");for(let i=0;i<fs.length;i++){if(fs[i].includes("#drawbuffer"))fs[i]=""}fs=fs.join("\n")}shader.fragmentShader=shader.material.fragmentShader=fs};let shader=mesh.material.shader.clone();for(let key in mesh.material.uniforms){shader.uniforms[key]=mesh.material.uniforms[key]}modifyShader(mesh.material.shader,"Color");modifyShader(shader,_this.name||_name);mesh.material=shader.material}function editDBShader(mesh){let modifyMarker=(fs,name,index)=>{let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");split[1]=split[1].replace("gl_FragColor",`gl_FragData[${index}]`);fs=split[0]+split[1]}return fs};let shader=mesh.material.shader;let fs=shader.fragmentShader;fs=modifyMarker(fs,"Color",0);fs=modifyMarker(fs,_this.name||_name,_textureIndex);shader.fragmentShader=shader.material.fragmentShader=fs}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}function initRT(){if(_useDrawBuffers){let texture=new THREE.Texture;texture.minFilter=THREE.LinearFilter;texture.magFilter=THREE.LinearFilter;texture.format=THREE.RGBAFormat;if(_this.rtType)texture.type=_this.rtType;texture.wrapS=texture.wrapT=THREE.ClampToEdgeWrapping;_textureIndex=_parentNuke.attachDrawBuffer(texture);_rt={texture}}else{_rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr,_this.rtType)}_this.rt=_rt}function updateTopParent(obj){var parent=obj.parent;while(parent){parent.updateMatrixWorld();parent=parent.parent}}this.create=function(nuke,type){if(!nuke)return;if(type)_this.rtType=type;_useDrawBuffers=nuke.useDrawBuffers;_this=this;_this.scene=_scene;_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:false});_nuke.parentNuke=nuke;_parentNuke=nuke;_this.nuke=_nuke;initRT();addListeners()};this.addObject=this.add=function(object){if(!_nuke)return;if(!_useDrawBuffers){var clone=object.clone();object["clone_"+_id]=clone;_scene.add(clone);_objects.push(object);editShader(clone)}else{editDBShader(object)}return clone};this.removeObject=function(object){if(!_nuke)return;_scene.remove(object["clone_"+_id]);_objects.remove(object);delete object["clone_"+_id]};this.render=this.draw=function(stage,camera){if(!_nuke||!_this.enabled||_useDrawBuffers)return;if(!_parentNuke.enabled||!_objects.length)return;if(stage){_nuke.stage=stage;_this.setSize(stage.width,stage.height)}if(camera){_nuke.camera=camera}else{_nuke.camera=_nuke.parentNuke.camera}for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i];var clone=obj["clone_"+_id];if(_this.autoVisible){clone.visible=true;var parent=obj;while(parent){if(parent.visible==false||parent.material&&parent.material.visible==false){clone.visible=false}parent=parent.parent}}if(_this.forceRender){clone.material.visible=true}obj.updateMatrixWorld();if(!obj.ignoreMatrix)Utils3D.decompose(obj,clone)}_nuke.rtt=_rt;_nuke.render()};this.addPass=function(pass){if(!_nuke)return;_nuke.add(pass)};this.removePass=function(pass){if(!_nuke)return;_nuke.remove(pass)};this.setSize=function(width,height){if(!_nuke)return;if(_rt.width==width&&_rt.height==height)return;_this.events.unsub(Events.RESIZE,resizeHandler);_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr);_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)};this.setDPR=function(dpr){if(!_nuke)return;_nuke.dpr=dpr;resizeHandler()};this.getObjects=function(){return _objects};if(_parentNuke instanceof Nuke)this.create(_parentNuke,_type)});Namespace("FX");Class(function FXScene(){Inherit(this,Component);var _this=this;var _nuke,_rt;var _scene=new THREE.Scene;var _id=Utils.timestamp();var _objects=[];this.resolution=1;this.autoVisible=true;this.enabled=true;(function(){}());function initRT(){_rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr,_this.rtType);_this.rt=_rt}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}this.create=function(nuke){_this=this;_this.scene=_scene;_this.nuke=_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:false});initRT();addListeners()};this.setSize=function(width,height){if(!_nuke)return;if(_rt.width==width&&_rt.height==height)return;_this.events.unsub(Events.RESIZE,resizeHandler);_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr);_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)};this.addObject=function(object){let clone=object.clone();object["clone_"+_id]=clone;_scene.add(clone);_objects.push(object);return clone};this.removeObject=function(object){_scene.remove(object["clone_"+_id]);_objects.remove(object);delete object["clone_"+_id]};this.render=this.draw=function(){for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i];var clone=obj["clone_"+_id];if(_this.autoVisible){clone.visible=true;var parent=obj;while(parent){if(parent.visible==false||parent.material&&parent.material.visible==false){clone.visible=false}parent=parent.parent}}if(_this.forceRender){clone.material.visible=true}obj.updateMatrixWorld();if(!obj.ignoreMatrix){Utils3D.decompose(obj,clone);if(clone.overrideScale)clone.scale.setScalar(clone.overrideScale)}}_nuke.rtt=_rt;_nuke.render()}});Class(function BasicPass(){Inherit(this,NukePass);var _this=this;this.fragmentShader=["varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","}"];this.init(this.fragmentShader)});Class(function Nuke(_stage,_params){Inherit(this,Component);var _this=this;if(!_params.renderer)console.error("Nuke :: Must define renderer");_this.stage=_stage;_this.renderer=_params.renderer;_this.camera=_params.camera;_this.scene=_params.scene;_this.rtt=_params.rtt;_this.enabled=_params.enabled==false?false:true;_this.passes=_params.passes||[];_this.useDrawBuffers=typeof _params.useDrawBuffers!=="undefined"?_params.useDrawBuffers:Device.graphics.webgl.detect("draw_buffers");var _dpr=_params.dpr||1;var _rts={};var _rtStack=[];var _rttPing,_rttPong,_nukeScene,_nukeMesh,_rttCamera,_rttBuffer;var _drawBuffers=[];(function(){initNuke();addListeners()}());function initNuke(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,false);_rttPong=Nuke.getRT(width,height,false);_rttBuffer=Nuke.getRT(width,height,_this.useDrawBuffers);_rttCamera=new THREE.OrthographicCamera(_this.stage.width/-2,_this.stage.width/2,_this.stage.height/2,_this.stage.height/-2,1,1e3);_nukeScene=new THREE.Scene;_nukeMesh=new THREE.Mesh(Nuke.getPlaneGeom(),new THREE.MeshBasicMaterial);_nukeScene.add(_nukeMesh)}function finalRender(scene,camera){if(_this.rtt){_this.renderer.render(scene,camera||_this.camera,_this.rtt)}else{_this.renderer.render(scene,camera||_this.camera)}_this.postRender&&_this.postRender()}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing.dispose();_rttPong.dispose();_rttPing.setSize(width,height);_rttPong.setSize(width,height);_rttBuffer.setSize(width,height);_rttCamera.left=_this.stage.width/-2;_rttCamera.right=_this.stage.width/2;_rttCamera.top=_this.stage.height/2;_rttCamera.bottom=_this.stage.height/-2;_rttCamera.updateProjectionMatrix()}_this.add=function(pass,index){if(!pass.pass){defer(function(){_this.add(pass,index)});return}if(typeof index=="number"){_this.passes.splice(index,0,pass);return}_this.passes.push(pass)};_this.remove=function(pass){if(typeof pass=="number"){_this.passes.splice(pass)}else{_this.passes.remove(pass)}};_this.renderToTexture=function(clear,rtt){_this.renderer.render(_this.scene,_this.camera,rtt||_rttPing,typeof clear=="boolean"?clear:true)};_this.render=function(){if(!_this.enabled||!_this.passes.length){finalRender(_this.scene);return}_this.renderer.render(_this.scene,_this.camera,_rttBuffer,true);var usedBuffer=false;var pingPong=true;for(var i=0;i<_this.passes.length-1;i++){_nukeMesh.material=_this.passes[i].pass;usedBuffer=true;_nukeMesh.material.uniforms.tDiffuse.value=i==0?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture;_this.renderer.render(_nukeScene,_rttCamera,pingPong?_rttPong:_rttPing);pingPong=!pingPong}_nukeMesh.material=_this.passes[_this.passes.length-1].pass;_nukeMesh.material.uniforms.tDiffuse.value=!usedBuffer?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture;finalRender(_nukeScene,_rttCamera)};_this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler);if(!_rts[width+"_"+height]){var rttPing=Nuke.getRT(width*_dpr,height*_dpr,_this.useDrawBuffers);var rttPong=Nuke.getRT(width*_dpr,height*_dpr,false);var rttBuffer=Nuke.getRT(width*_dpr,height*_dpr,false);_rts[width+"_"+height]={ping:rttPing,pong:rttPong,name:width+"_"+height,buffer:rttBuffer};_rtStack.push(_rts[width+"_"+height]);if(_rtStack.length>3){let rts=_rtStack.shift();delete _rts[rts.name];rts.ping.dispose();rts.pong.dispose();rts.buffer.dispose()}}var rts=_rts[width+"_"+height];_rttPing=rts.ping;_rttPong=rts.pong;_rttBuffer=rts.buffer;if(_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i])}};_this.attachDrawBuffer=function(texture){_drawBuffers.push(texture);if(_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i])}return _drawBuffers.length};_this.set("dpr",function(v){_dpr=v||Device.pixelRatio;resizeHandler()});_this.get("dpr",function(){return _dpr});_this.get("output",function(){return _nukeMesh.material.uniforms?_nukeMesh.material.uniforms.tDiffuse.value:null})},function(){var _plane;var _rts={};Nuke.getPlaneGeom=function(){if(!_plane)_plane=new THREE.PlaneBufferGeometry(2,2,1,1);return _plane};Nuke.getRT=function(width,height,multi){if(!multi){return Utils3D.createRT(width,height)}else{return Utils3D.createMultiRT(width,height)}}});Class(function NukePass(_fs,_uniforms,_pass){Inherit(this,Component);var _this=this;this.UILPrefix=typeof _fs=="string"?_fs:Utils.getConstructorName(_fs);function prefix(code){if(!code)throw`No shader ${_fs} found`;let pre="";pre+="precision highp float;\n";pre+="precision highp int;\n";if(!code.includes("uniform sampler2D tDiffuse")){pre+="uniform sampler2D tDiffuse;\n";pre+="varying vec2 vUv;\n"}code=pre+code;return code}function getVS(){return`
        precision highp float;
        precision highp int;

        varying vec2 vUv;

        attribute vec2 uv;
        attribute vec3 position;

        void main() {
            vUv = uv;
            gl_Position = vec4(position, 1.0);
        }
        `}this.init=function(fs){if(_this.pass)return;_this=this;let name=fs||this.constructor.toString().match(/function ([^\(]+)/)[1];let fragmentShader=Array.isArray(fs)?fs.join(""):null;_this.uniforms=_uniforms||{};_this.uniforms.tDiffuse={type:"t",value:null};if(_this.uniforms.unique)_this.UILPrefix+="_"+_this.uniforms.unique+"_";if(window.UILStorage){for(let key in _this.uniforms){if(key==="unique")continue;_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key)||_this.uniforms[key]}}_this.pass=new THREE.RawShaderMaterial({uniforms:_this.uniforms,vertexShader:getVS(),fragmentShader:fragmentShader||prefix(Shaders.getShader(name+".fs"))});_this.uniforms=_this.pass.uniforms};this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]);this.uniforms[key].value=value};this.tween=function(key,value,time,ease,delay,callback,update){tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.clone=function(){if(!_this.pass)_this.init(_fs);return new NukePass(null,null,_this.pass.clone())};if(typeof _fs==="string"){_this.init(_fs)}else if(_pass){_this.pass=_pass;_this.uniforms=_pass.uniforms}});Class(function Raycaster(_camera){Inherit(this,Component);const _this=this;let _mouse=new THREE.Vector3;let _raycaster=new THREE.Raycaster;let _debug=null;this.testVisibility=true;(function(){}());function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,raycaster,intersects,recursive){if(_this.testVisibility){if(object.visible===false)return;let parent=object.parent;while(parent){if(parent.visible===false)return;parent=parent.parent}}if(!object.raycast)return;object.raycast(raycaster,intersects);if(recursive===true){let children=object.children;for(let i=0,l=children.length;i<l;i++){intersectObject(children[i],raycaster,intersects,true)}}}function intersect(objects){if(!Array.isArray(objects))objects=[objects];let intersects=[];objects.forEach(object=>{intersectObject(object,_raycaster,intersects,false)});intersects.sort(ascSort);if(_debug)updateDebug();return intersects}function updateDebug(){let vertices=_debug.geometry.vertices;vertices[0].copy(_raycaster.ray.origin.clone());vertices[1].copy(_raycaster.ray.origin.clone().add(_raycaster.ray.direction.clone().multiplyScalar(1e4)));_debug.geometry.verticesNeedUpdate=true}this.set("camera",function(camera){_camera=camera});this.set("pointsThreshold",function(value){_raycaster.params.Points.threshold=value});this.get("ray",()=>{return _raycaster.ray});this.debug=function(scene){let geom=new THREE.Geometry;geom.vertices.push(new THREE.Vector3(-100,0,0));geom.vertices.push(new THREE.Vector3(100,0,0));let mat=new THREE.LineBasicMaterial({color:1671168e1});_debug=new THREE.Line(geom,mat);scene.add(_debug)};this.checkHit=function(objects,mouse){mouse=mouse||Mouse;let rect=_this.rect||Stage;if(mouse===Mouse&&rect===Stage){_mouse.copy(Mouse.tilt)}else{_mouse.x=mouse.x/rect.width*2-1;_mouse.y=-(mouse.y/rect.height)*2+1}_raycaster.setFromCamera(_mouse,_camera);return intersect(objects)};this.checkFromValues=function(objects,origin,direction){_raycaster.set(origin,direction,0,Number.POSITIVE_INFINITY);return intersect(objects)}});Class(function ScreenProjection(_camera){Inherit(this,Component);var _this=this;var _v3=new THREE.Vector3;var _v32=new THREE.Vector3;var _value=new THREE.Vector3;(function(){}());this.set("camera",function(v){_camera=v});this.unproject=function(mouse,distance){var rect=_this.rect||Stage;_v3.set(mouse.x/rect.width*2-1,-(mouse.y/rect.height)*2+1,.5);_v3.unproject(_camera);var pos=_camera.position;_v3.sub(pos).normalize();var dist=distance||-pos.z/_v3.z;_value.copy(pos).add(_v3.multiplyScalar(dist));return _value};this.project=function(pos,screen){screen=screen||Stage;if(pos instanceof THREE.Object3D){pos.updateMatrixWorld();_v32.set(0,0,0).setFromMatrixPosition(pos.matrixWorld)}else{_v32.copy(pos)}_v32.project(_camera);_v32.x=(_v32.x+1)/2*screen.width;_v32.y=-(_v32.y-1)/2*screen.height;return _v32}});Class(function Shader(_vertexShader,_fragmentShader,_params){Inherit(this,Component);const _this=this;let _material;this.receiveShadow=false;this.receiveLight=false;this.lights=[];this.persists=false;this.uniforms={};this.properties={};(function(){if(typeof _fragmentShader!=="string"){_params=_fragmentShader;_fragmentShader=_vertexShader}_this.vsName=_vertexShader;_this.fsName=_fragmentShader;_params=_params||{};_this.UILPrefix=`${_vertexShader}_${_fragmentShader}_${_params.unique?_params.unique+"_":""}`;parseParams();parseShaders()}());function parseParams(){for(let key in _params){if(key=="useShaderMaterial"){_this.useShaderMaterial=_params[key]}else if(key=="receiveShadow"){_this.receiveShadow=_params[key]}else if(key=="receiveLight"){_this.receiveLight=_params[key]}else if(key=="noAttributes"){_this.noAttributes=_params[key]}else if(key=="defines"){_this.defines=_params[key]}else if(key=="lights"){_this.lights=_params[key]}else if(_params[key].value!==undefined){if(window.UILStorage){_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key)||_params[key]}else{_this.uniforms[key]=_params[key]}}else{if(key=="unique")continue;_this.properties[key]=_params[key]}}}function parseShaders(){_this.vertexShader=process(Shaders.getShader(_vertexShader+".vs")||_vertexShader,"vs");_this.fragmentShader=process(Shaders.getShader(_fragmentShader+".fs")||_fragmentShader,"fs")}function process(code,type){let header="";if(_this.useShaderMaterial||_this.receiveShadow){if(type=="fs"){header=["uniform mat4 modelViewMatrix;"].join("\n")}}else{if(type=="vs"){header=["precision highp float;","precision highp int;",_this.noAttributes?"":"attribute vec2 uv;",_this.noAttributes?"":"attribute vec3 position;",_this.noAttributes?"":"attribute vec3 normal;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;"].join("\n")}else{header=[code.includes("samplerExternalOES")?"#extension GL_OES_EGL_image_external : require":"",code.includes("dFdx")?"#extension GL_OES_standard_derivatives : enable":"",code.includes(["gl_FragData","#drawbuffer"])&&World.NUKE.useDrawBuffers&&!code.includes("fxlayer")?"#extension GL_EXT_draw_buffers : require":"","precision highp float;","precision highp int;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;"].join("\n")}}header+="\n__ACTIVE_THEORY_LIGHTS__\n\n";if(window.AURA)header+="#define AURA\n";code=header+code;let threeChunk=function(a,b){return THREE.ShaderChunk[b]+"\n"};return code.replace(/#s?chunk\(\s?(\w+)\s?\);/g,threeChunk)}function addLightingCode(){let lightCode=function(){if(!_this.receiveLight)return"";let lighting=Lighting.getLighting(_this);let numLights=lighting.position.length;if(numLights==0){if(!Shader.disableWarnings)console.warn("Lighting enabled but 0 lights added. Be sure to add them before calling shader.material");return""}return[`#define NUM_LIGHTS ${numLights}`,`uniform vec3 lightPos[${numLights}];`,`uniform vec3 lightColor[${numLights}];`,`uniform float lightIntensity[${numLights}];`,`uniform float lightDistance[${numLights}];`,``].join("\n")}();_this.vertexShader=_this.vertexShader.replaceAll("__ACTIVE_THEORY_LIGHTS__",lightCode);_this.fragmentShader=_this.fragmentShader.replaceAll("__ACTIVE_THEORY_LIGHTS__",lightCode)}function updateMaterialLight(lighting){_material.uniforms.lightPos={type:"v3v",value:lighting.position};_material.uniforms.lightColor={type:"fv",value:lighting.color};_material.uniforms.lightIntensity={type:"fv1",value:lighting.intensity};_material.uniforms.lightDistance={type:"fv1",value:lighting.distance};_this.startRender(updateLights)}function updateLights(){if(_material.visible!==false)Lighting.update(_this,true)}this.get("material",function(){if(!_material){let params={};addLightingCode();params.vertexShader=_this.vertexShader;params.fragmentShader=_this.fragmentShader;params.uniforms=_this.uniforms;if(_this.receiveShadow){for(let key in THREE.UniformsLib.lights){params.uniforms[key]=THREE.UniformsLib.lights[key]}}for(let key in _this.properties){params[key]=_this.properties[key]}_material=_this.receiveShadow||_this.useShaderMaterial?new THREE.ShaderMaterial(params):new THREE.RawShaderMaterial(params);_material.shader=_this;_this.uniforms=_material.uniforms;_material.defines=_this.defines;if(_this.receiveLight)updateMaterialLight(_this.__lighting);if(_this.receiveShadow){_material.lights=true;if(params.vertexShader.includes("dFdx"))_material.extensions.derivatives=true}}return _material});this.set=function(key,value){if(typeof value!=="undefined")_this.uniforms[key].value=value;return _this.uniforms[key].value};this.tween=function(key,value,time,ease,delay,callback,update){return tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.getValues=function(){let out={};for(let key in _this.uniforms){out[key]=_this.uniforms[key].value}return out};this.clone=function(){let shader=new Shader(_vertexShader,_fragmentShader,_params);for(let key in _this.uniforms){shader.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value}}return shader};this.copyUniformsTo=function(shader){for(let key in _this.uniforms){shader.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value}}};this.updateLighting=function(){let lighting=Lighting.getLighting(_this,true);_material.uniforms.lightPos.value=lighting.position;_material.uniforms.lightColor.value=lighting.color;_material.uniforms.lightIntensity.value=lighting.intensity;_material.uniforms.lightDistance.value=lighting.distance};this.onDestroy=function(){if(!_this.persists)_material&&_material.dispose&&_material.dispose()}},()=>{Shader.CustomBasicMaterial=function(vertexShader,fragmentShader,uniforms){if(typeof fragmentShader!=="string"){uniforms=fragmentShader;fragmentShader=vertexShader}function MeshCustomMaterial(parameters){THREE.MeshBasicMaterial.call(this);this.uniforms=THREE.UniformsUtils.merge([THREE.ShaderLib.basic.uniforms,uniforms]);setFlags(this);this.setValues(parameters)}MeshCustomMaterial.prototype=Object.create(THREE.MeshBasicMaterial.prototype);MeshCustomMaterial.prototype.constructor=MeshCustomMaterial;MeshCustomMaterial.prototype.isMeshBasicMaterial=true;MeshCustomMaterial.prototype.copy=function(source){THREE.MeshBasicMaterial.prototype.copy.call(this,source);this.uniforms=THREE.UniformsUtils.clone(source.uniforms);setFlags(this);return this};function setFlags(material){material.vertexShader=Shaders.getShader(vertexShader+".vs")||vertexShader;material.fragmentShader=Shaders.getShader(fragmentShader+".fs")||fragmentShader;material.type="MeshCustomMaterial"}return MeshCustomMaterial};Shader.CustomStandardMaterial=function(vertexShader,fragmentShader,uniforms){if(typeof fragmentShader!=="string"){uniforms=fragmentShader;fragmentShader=vertexShader}function MeshCustomMaterial(parameters){THREE.MeshStandardMaterial.call(this);this.uniforms=THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,uniforms]);setFlags(this);this.setValues(parameters)}MeshCustomMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);MeshCustomMaterial.prototype.constructor=MeshCustomMaterial;MeshCustomMaterial.prototype.isMeshStandardMaterial=true;MeshCustomMaterial.prototype.copy=function(source){THREE.MeshStandardMaterial.prototype.copy.call(this,source);this.uniforms=THREE.UniformsUtils.clone(source.uniforms);setFlags(this);return this};function setFlags(material){material.vertexShader=Shaders.getShader(vertexShader+".vs")||vertexShader;material.fragmentShader=Shaders.getShader(fragmentShader+".fs")||fragmentShader;material.type="MeshCustomMaterial"}return MeshCustomMaterial}});Class(function ParticlePhysicsBufferConverter(_geom,_system){Inherit(this,Component);var _this=this;var _convert=[];var _particles=_system.particles;_convert.push({name:"position",props:["x","y","z"],size:3});this.add=function(name,props){let obj={name,props,size:props.length};_convert.push(obj);return obj};this.exec=function(){var index=0;var p=_particles.start();while(p){for(var i=_convert.length-1;i>-1;i--){var obj=_convert[i];if(obj.disabled)continue;var attribute=_geom.attributes[obj.name];for(var j=0;j<obj.size;j++){attribute.array[index*obj.size+j]=p[obj.props[j]]||p.pos[obj.props[j]]||0}attribute.needsUpdate=true}++index;p=_particles.next()}};this.find=function(name){for(let i=0;i<_convert.length;i++){let obj=_convert[i];if(obj.name==name)return obj}}});Class(function RandomEulerRotation(_container){var _this=this;var _euler=["x","y","z"];var _rot;this.speed=1;(function(){initRotation()}());function initRotation(){_rot={};_rot.x=Math.random(0,2);_rot.y=Math.random(0,2);_rot.z=Math.random(0,2);_rot.vx=Math.random(-5,5)*.0025;_rot.vy=Math.random(-5,5)*.0025;_rot.vz=Math.random(-5,5)*.0025}this.update=function(){var time=Render.TIME;for(var i=0;i<3;i++){var v=_euler[i];switch(_rot[v]){case 0:_container.rotation[v]+=Math.cos(Math.sin(time*.25))*_rot["v"+v]*_this.speed;break;case 1:_container.rotation[v]+=Math.cos(Math.sin(time*.25))*_rot["v"+v]*_this.speed;break;case 2:_container.rotation[v]+=Math.cos(Math.cos(time*.25))*_rot["v"+v]*_this.speed;break}}};this.startRender=function(){Render.start(_this.update)};this.stopRender=function(){Render.stop(_this.update)};this.onDestroy=function(){this.stopRender()}});Class(function Utils3D(){var _this=this;var _objectLoader,_geomLoader,_bufferGeomLoader;var _textures={};AssetLoader.waitForLib("THREE",()=>{if(!window.Vector2){window.Vector2=THREE.Vector2;window.Vector3=THREE.Vector3;window.Vector4=THREE.Vector4;window.Matrix3=THREE.Matrix3;window.Matrix4=THREE.Matrix4;window.Quaternion=THREE.Quaternion}if(!window.Vec2){window.Vec2=THREE.Vector2;window.Vec3=THREE.Vector3;window.Vec4=THREE.Vector4;window.Mat3=THREE.Matrix3;window.Mat4=THREE.Matrix4;window.Quat=THREE.Quaternion}if(!Hydra.LOCAL){window.console.warn=function(str,msg){};window.console.error=function(){}}});this.decompose=function(local,world){local.matrixWorld.decompose(world.position,world.quaternion,world.scale)};this.createDebug=function(size,color){var geom=new THREE.IcosahedronGeometry(size||40,1);var mat=color?new THREE.MeshBasicMaterial({color:color}):new THREE.MeshNormalMaterial;return new THREE.Mesh(geom,mat)};this.createRT=function(width,height,type){var params={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false,type};let rt=new THREE.WebGLRenderTarget(width,height,params);rt.texture.generateMipmaps=false;return rt};this.createMultiRT=function(width,height){var params={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false};let rt=new THREE.WebGLMultiRenderTarget(width,height,params);rt.texture.generateMipmaps=false;return rt};this.getFloatType=function(){return Device.system.os=="android"?THREE.FloatType:THREE.HalfFloatType};this.getTexture=function(path){if(!_textures[path]){let texture=new THREE.Texture;texture.promise=Promise.create();texture._dispose=texture.dispose;texture.dispose=function(){delete _textures[path];this._dispose()};_textures[path]=texture;Assets.decodeImage(path).then(imgBmp=>{texture.image=imgBmp;texture.needsUpdate=true;if(!THREE.Math.isPowerOfTwo(imgBmp.width*imgBmp.height))texture.minFilter=THREE.LinearFilter;texture.onUpdate=function(){if(imgBmp.close)imgBmp.close();texture.onUpdate=null};texture.promise.resolve();if(texture.onload){texture.onload();texture.onload=null}})}return _textures[path]};this.setInfinity=function(v){var inf=Number.POSITIVE_INFINITY;v.set(inf,inf,inf);return v};this.getCubemap=function(src){var path="cube_"+(Array.isArray(src)?src[0]:src);if(!_textures[path]){var images=[];for(var i=0;i<6;i++){var img=new Image;img.crossOrigin="";img.src=Assets.getPath(Array.isArray(src)?src[i]:src);images.push(img);img.onload=function(){_textures[path].needsUpdate=true}}let texture=new THREE.Texture;texture.image=images;texture.minFilter=THREE.LinearFilter;texture._dispose=texture.dispose;texture.dispose=function(){delete _textures[path];this._dispose()};_textures[path]=texture}return _textures[path]};this.loadObject=function(name){let json=typeof name=="object"?name:Assets.JSON[name];if(json.type=="hydra_c4d"){let group=new THREE.Group;let mat=new THREE.MeshBasicMaterial({wireframe:true,color:104448e1});json.geometries.forEach(obj=>{let data=obj.data;let geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));let mesh=new THREE.Mesh(geometry,mat);mesh.position.copy(obj.position);mesh.rotation.x=obj.rotation.x;mesh.rotation.y=obj.rotation.y;mesh.rotation.z=obj.rotation.z;mesh.scale.copy(obj.scale);mesh.name=obj.id;group.add(mesh)});return group}else{if(!_objectLoader)_objectLoader=new THREE.ObjectLoader;return _objectLoader.parse(Assets.JSON[name])}};this.loadGeometry=function(name){if(!_geomLoader)_geomLoader=new THREE.JSONLoader;if(!_bufferGeomLoader)_bufferGeomLoader=new THREE.BufferGeometryLoader;var json=Assets.JSON[name];if(json.type=="BufferGeometry"){return _bufferGeomLoader.parse(json)}else{return _geomLoader.parse(json.data).geometry}};this.disposeAllTextures=function(){for(var key in _textures){_textures[key].dispose()}};this.loadBufferGeometry=function(name){var data=Assets.JSON[name];var geometry=new THREE.BufferGeometry;if(data.data)data=data.data;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal||data.position.length),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv||data.position.length/3*2),2));return geometry};this.loadSkinnedGeometry=function(name){var data=Assets.JSON[name];var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));geometry.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(data.skinIndices),4));geometry.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(data.skinWeights),4));geometry.bones=data.bones.slice(0);return geometry};this.loadCurve=function(obj){if(typeof obj==="string")obj=Assets.JSON[obj];var data=obj;var points=[];for(var j=0;j<data.length;j+=3){points.push(new THREE.Vector3(data[j+0],data[j+1],data[j+2]))}return new THREE.CatmullRomCurve3(points)};this.setLightCamera=function(light,size,near,far,texture){light.shadow.camera.left=-size;light.shadow.camera.right=size;light.shadow.camera.top=size;light.shadow.camera.bottom=-size;light.castShadow=true;if(near)light.shadow.camera.near=near;if(far)light.shadow.camera.far=far;if(texture)light.shadow.mapSize.width=light.shadow.mapSize.height=texture;light.shadow.camera.updateProjectionMatrix()};this.getRepeatTexture=function(src){var texture=this.getTexture(src);texture.onload=function(){texture.wrapS=texture.wrapT=THREE.RepeatWrapping};return texture};this.forceVisible=function(group){let setProperties=obj=>{if(typeof obj.visible!=="undefined"){obj.__visible=obj.visible;obj.visible=true}if(typeof obj.frustumCulled!=="undefined"){obj.__frustumCulled=obj.frustumCulled;obj.frustumCulled=false}};let children=group.children;children.forEach(child=>{setProperties(child);if(child.material)setProperties(child.material);_this.forceVisible(child)})};this.resetForceVisible=function(group){let setProperties=obj=>{if(typeof obj.__visible!=="undefined"){obj.visible=obj.__visible;delete obj.__visible}if(typeof obj.__frustumCulled!=="undefined"){obj.frustumCulled=obj.__frustumCulled;delete obj.__frustumCulled}};let children=group.children;children.forEach(child=>{setProperties(child);if(child.material)setProperties(child.material);_this.resetForceVisible(child)})};this.findTexturesByPath=function(path){let array=[];for(let key in _textures){if(key.includes(path))array.push(_textures[key])}return array};this.getHeightFromCamera=function(camera){let dist=camera.position.length();let fov=camera.fov;return 2*dist*Math.tan(Math.radians(fov)*.5)};this.getPositionFromCameraSize=function(camera,size){let fov=Math.radians(camera.fov);return Math.abs(size/Math.sin(fov/2))}},"static");Class(function UnsupportedRedirect(){Inherit(this,Component);var _this=this;var _test;this.chrome=55;this.firefox=51;this.safari=8;this.ie=13;this.requiresWebGL=true;this.url="./fallback";function redirect(){window.location=_this.url}this.test=function(){if(Device.detect(["googlebot","bing","yahoo"]))return;if(_test&&_test())return redirect();if(_this.requiresWebGL&&!Device.graphics.webgl)return redirect();if(Device.system.browser=="chrome"&&Device.system.browserVersion>_this.chrome)return;if(Device.system.browser=="firefox"&&Device.system.browserVersion>_this.firefox)return;if(Device.system.browser=="safari"&&Device.system.browserVersion>_this.safari)return;if(Device.system.browser=="ie"&&Device.system.browserVersion>_this.ie)return;redirect()};this.custom=function(test){_test=test}},"static");Class(function VideoTexture(_path,{loop=true,preload=true,autoplay=true}={}){Inherit(this,Component);const _this=this;let _video;(function(){if(_path.includes(["jpg","png"])){_this.texture=Utils3D.getTexture(_path)}else{_video=_this.initClass(Video,{src:_path,width:1024,height:576,loop,preload,autoplay});_video.div.crossOrigin="anonymous";_this.texture=new THREE.Texture(_video.div);_this.texture.minFilter=_this.texture.magFilter=THREE.LinearFilter;_this.texture.generateMipmaps=false;_this.video=_video}}());function update(){if(!_this.texture.image){_this.texture.image=_video.video}_this.texture.needsUpdate=true}this.set("src",src=>_video.src=src);this.start=function(){if(_video){_video.play();_this.startRender(update)}};this.stop=function(){if(_video){_video.pause();_this.stopRender(update)}}});Class(function PageTitleGlitch(){Inherit(this,Component);const _this=this;var $this;var _line="",_current="";var _text=["     .","      .","       .","   .","      .","   -.","       ."," ..'   .","    -   .","        .","    ."," ..     .","   .","     .","      .","     .","    .","   .","      .","   .","       .","   .","  .","     .","    .","  ..   .","   .","    -.","      ."," -   .","    -."," -  ."," -'   ."," --  ."," -  .","     -."];_this.name="V I R T U A L  S E L F";(function(){init();_this.startRender(loop,2)}());function init(){newLine()}function loop(){document.title=_current.toString()}function newLine(){_current="";_line=_text.random(_text.length);if(!Hydra.LOCAL)console.log("%c "+_line+" ","background: #222; color: #fff;  padding: 5px;");clearTimeout(_this.timeout);autoType()}function autoType(){clearTimeout(_this.timeout);if(_line.length>_current.length){_current+=_line.charAt(_current.length);_this.timeout=_this.delayedCall(autoType,100)}else{_this.timeout=_this.delayedCall(newLine,3e3)}}this.showName=function(name){_this.name=name};this.showAngel=function(){_current="        "};this.console=function(){_line=_text.random(_text.length);console.log("%c "+_line+" ","background: #222; color: #fff;  padding: 5px;")}},"singleton");Class(function Tests(){var _this=this;GPU.ready().then(()=>{GPU.IRIS=GPU.matchGPU("iris(tm) graphics ",540)&&Math.max(Stage.width,Stage.height)<15e2});this.getDPR=function(){if(GPU.lt(1)&&Device.system.browser=="ie"&&Device.system.browserVersion<=11)return.8;if(Device.system.os=="ios"){if(GPU.mobileGT(3))return 1.2;if(GPU.mobileGT(2))return 1.1}else{if(GPU.mobileGT(3))return 1.5;if(GPU.mobileGT(2))return 1.25}if(GPU.gt(3)){if(Math.max(Stage.width,Stage.height)>17e2)return 1;if(Device.pixelRatio>1)return 1.5;else return 1.2}if(GPU.gt(2)&&Device.pixelRatio>1){if(Math.max(Stage.width,Stage.height)>17e2)return 1;if(Device.pixelRatio>1)return 1.25;else return 1.1}if(GPU.OVERSIZED)return.6;if(GPU.mobileLT(0)||GPU.gt(1))return 1;if(Mobile.iOS.includes("legacy"))return.5;return 1};this.textShadow=function(){if(Utils.query("noshadow"))return false;if(Device.system.browser==="firefox")return false;if(GPU.lt(1))return false;if(Device.mobile)return false;return true}},"static");Class(function State(){Inherit(this,PushState);var _this=this;(function(){if(!Hydra.lOCAL)_this.setRoot("/")}())},"singleton");Class(function AudioPlayer(){Inherit(this,Component);var _this=this;var _ambience,_tracks,_current;_this.elapsed={v:0};var _tween;var _volume={a:0};_this.paused=false;(function(){initAudio();addListeners()}());function initAudio(){_tracks=[];Config.CHARACTERS.forEach(data=>{data.tracks.forEach(track=>{if(track.id){_tracks[track.id]=new Howl({src:[Config.AUDIO_LOCATION+track.id+".mp3"],loop:true,volume:.4,onend:ended,onplay:playing,onpause:paused})}})})}function addListeners(){_this.events.sub(KeyboardUtil.PRESS,keyPress);_this.events.sub(VirtualSelfEvents.CHANGE,changeSong)}function keyPress(e){if(e.keyCode==32){if(_this.playing)_this.pause();else _this.play()}}function playing(){_this.playing=true;_this.events.fire(VirtualSelfEvents.PLAY_PAUSE,{playing:_this.playing})}function paused(){_this.playing=false;_this.events.fire(VirtualSelfEvents.PLAY_PAUSE,{playing:_this.playing})}function ended(){}function changeSong(id){if(!id){return}if(_current)_current.pause();_current=_tracks[id];_current.seek(0);_current.play()}this.change=changeSong;this.pause=function(ambience){if(_current)_current.pause()};this.play=function(){if(_current){_current.seek(0);_current.play()}}},"singleton");Class(function Characters(){Inherit(this,Element);const _this=this;const $this=this.element;let _scenes,_interaction;let _active=0;(function(){initViews();initCharacters();Dust.instance()}());function initViews(){$this.css({position:"static"});_interaction=_this.initClass(CharactersInteraction)}function initCharacters(){_scenes=[];Config.CHARACTERS.forEach(data=>{let scene=_this.initClass(CharacterScene,data);scene.data=data;_scenes.push(scene)})}function addHandlers(){_this.events.sub(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,change)}function change(e){if(_this.disabled)return;_this.disabled=true;_this.delayedCall(()=>{_this.disabled=false},4e3);AudioPlayer.instance().pause();_scenes[_active].animateOut();_active+=e.change;if(_active<0)_active=_scenes.length-1;if(_active>_scenes.length-1)_active=0;_scenes[_active].animateIn();Dust.instance().move(-4)}this.animateIn=function(){addHandlers();_scenes[_active].animateIn(true);_interaction.enter()}});Class(function CharactersInteraction(){Inherit(this,Component);const _this=this;let _scroll,_swipe;(function(){initInteractions()}());function initInteractions(){_scroll=_this.initClass(ScrollInteraction);_swipe=_this.initClass(SwipeInteraction)}this.enter=function(){_scroll.enabled=true;_swipe.enabled=true}});Class(function ScrollInteraction(){Inherit(this,Component);const _this=this;let _scroll;let _progress=new Vec2;let _text="";(function(){initScroll();_this.startRender(loop)}());function initScroll(){_scroll=_this.initClass(Scroll,{limit:false});_this.events.sub(KeyboardUtil.DOWN,press)}function press(e){switch(e.keyCode){case 38:if(_this.sequence>=0&&_this.sequence<2)_this.sequence++;else _this.sequence=0;change(-1,"character");break;case 40:if(_this.sequence>=2&&_this.sequence<4)_this.sequence++;else _this.sequence=0;change(1,"character");break;case 37:if(_this.sequence>=4&&_this.sequence<6)_this.sequence++;else _this.sequence=0;change(1,"song");break;case 39:if(_this.sequence>=6&&_this.sequence<8)_this.sequence++;else _this.sequence=0;if(_this.sequence==8){prompt("    .",atob("dmlydHVhbHNlbGYuY28vckY3MmxiQkUucGRm"));_this.sequence=0}change(-1,"song");break;default:_this.sequence=0;break}}function loop(){_progress.x+=_scroll.delta.x;_progress.x+=(0-_progress.x)*.3;if(Math.abs(_progress.x)>100){if(!_this.enabled||_this.isTransition)return;change(_progress.x>0?1:-1,"song")}_progress.y+=_scroll.delta.y;_progress.y+=(0-_progress.y)*.3;if(Math.abs(_progress.y)>100){if(!_this.enabled||_this.isTransition)return;change(_progress.y<0?1:-1,"character")}}function change(dir,type){if(Global.BLOCK_INTERACTION)return;_this.isTransition=true;_this.delayedCall(()=>{_this.isTransition=false},500);if(type==="character"){if(dir>0){_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,{change:1})}else{_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,{change:-1})}}else{if(dir>0){_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_SONG,{change:1})}else{_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_SONG,{change:-1})}}}});Class(function SwipeInteraction(){Inherit(this,Component);const _this=this;let _startTime;let _movement=new Vec2;_this.touched=0;(function(){addHandlers();_this.startRender(loop)}());function loop(){if(!_this.enabled)return}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.DRAG,drag);_this.events.sub(Mouse.input,Interaction.END,end);_this.events.sub(Mouse.input,Interaction.CLICK,click)}function start(e){if(e&&e.touches&&e.touches.length>2&&Device.mobile){_this.touched++;if(_this.touched>2){prompt("        .",atob("dmlydHVhbHNlbGYuY28vcDQ2V0lCWDcucGRm"));_this.touched=0}clearTimeout(_this.touchTimeout);_this.touchTimeout=_this.delayedCall(_=>{_this.touched=0},500)}_startTime=Date.now();_movement.set(0,0)}function drag(){if(!_this.enabled)return;_movement.add(Mouse.delta)}function end(){if(Global.BLOCK_INTERACTION)return;if(!_this.enabled)return;if(Date.now()-_startTime>400)return;if(_movement.length()<50)return;let ratio=Math.abs(_movement.x)/Math.abs(_movement.y);if(ratio>2){if(_movement.x>0){_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_SONG,{change:1})}else{_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_SONG,{change:-1})}}else if(ratio<.3){if(_movement.y>0){_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,{change:1})}else{_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,{change:-1})}}}function click(){if(Global.BLOCK_INTERACTION)return;if(Math.abs(Mouse.tilt.x)<.3||Math.abs(Mouse.tilt.y)>.4){if(Math.abs(Mouse.tilt.y)>.65)_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,{change:1});else _this.events.fire(VirtualSelfEvents.REQUEST_SELECT_SONG)}else{_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_SONG,{change:Mouse.tilt.x>0?-1:1})}}});Class(function Container(){Inherit(this,Element);const _this=this;const $this=this.element;var _landing,_characters;(function(){initHTML();loadLanding()}());function initHTML(){Stage.add($this);$this.css({position:"static"})}function loadLanding(){let loaderView=_this.initClass(LoaderView);let loader=_this.initClass(AssetLoader,Assets.list().filter(["lib","shaders","landing"]));_this.events.sub(loader,Events.PROGRESS,loaderView.progress);_this.events.sub(loader,Events.COMPLETE,()=>{AudioPlayer.instance();loaderView.animateOut(()=>loaderView=loaderView.destroy());initView();loadAssets();defer(initEffects)})}function loadAssets(){let loader=_this.initClass(AssetLoader,Assets.list());_this.events.sub(loader,Events.PROGRESS,_landing.progress);_this.events.sub(loader,Events.COMPLETE,()=>{_landing.loadComplete();initCharacters();addHandlers()})}function initEP(){}function initView(){World.instance();$this.add(World.ELEMENT);_landing=_this.initClass(Landing)}function initEffects(){VFX.instance();Dust.instance().animateIn();MouseParticles.instance().animateIn();if(!Device.mobile)PageTitleGlitch.instance()}function initCharacters(){_characters=_this.initClass(Characters)}function addHandlers(){_this.events.sub(VirtualSelfEvents.ENTER,enter)}function enter(){_this.delayedCall(_characters.animateIn,65e2)}},"singleton");Class(function Embed(){Inherit(this,Element);var _this=this;var $this,$bg;var _view,_liquid;(function(){initHTML();initView();addListeners()}());function initHTML(){$this=_this.element;$this.size("100%").hide().setZ(1e5);Stage.add($this);$bg=$this.create(".bg");$bg.size("100%").setZ(1)}function initView(){_view=_this.initClass(EmbedView)}function addListeners(){$bg.interact(null,close);$bg.hit.mouseEnabled(true)}function close(){_this.animateOut()}this.animateIn=function(id){Global.IN_EMBED=true;AudioPlayer.instance().pause();$this.show().clearAlpha();_view.animateIn(id);defer(_=>{_this.events.fire(VirtualSelfEvents.EMBED_TOGGLE,{action:"in"})})};this.animateOut=function(){Global.IN_EMBED=false;defer(_=>{_this.events.fire(VirtualSelfEvents.EMBED_TOGGLE,{action:"out"})});_view.animateOut();$this.tween({opacity:0},500,"easeOutSine",function(){$this.hide();AudioPlayer.instance().play()})}},"Singleton");Class(function EP(){Inherit(this,Element);const _this=this;var $this;var _view,_spinner,_bg,_album,_links;Global.EP=true;(function(){initHTML();initLoader()}());function initHTML(){$this=_this.element;$this.size("100%");Stage.add($this)}function initLoader(){let loaderView=_this.initClass(LoaderView);let loader=_this.initClass(AssetLoader,Assets.list().filter(["lib","shaders","ep"]));_this.events.sub(loader,Events.PROGRESS,loaderView.progress);_this.events.sub(loader,Events.COMPLETE,()=>{loaderView.animateOut(()=>loaderView=loaderView.destroy());initView();_this.delayedCall(animateIn,500)})}function initView(){World.instance();CursorMask.instance();VFX.instance();Dust.instance().animateIn();MouseParticles.instance().animateIn();PageTitleGlitch.instance();_spinner=_this.initClass(EPSpinner);World.SCENE.add(_spinner.group);_album=_this.initClass(EPAlbum);World.SCENE.add(_album.group);$this.add(World.ELEMENT);_links=_this.initClass(EPLinks)}function animateIn(){_spinner.animateIn();_album.animateIn();_this.delayedCall(_links.animateIn,1e3)}this.animateIn=function(){};this.initBG=function(){if(!Device.mobile)_bg=_this.initClass(EPViewBG)}},"singleton");Class(function Hunt(){Inherit(this,Element);const _this=this;const $this=this.element;var _view;Global.HUNT=true;(function(){initHTML();loadTour()}());function initHTML(){Stage.add($this);$this.css({position:"static"});Stage.div.id="";$this.div.className=""}function loadTour(){let loader=_this.initClass(AssetLoader,Assets.list().filter(["lib","shaders"]));_this.events.sub(loader,Events.COMPLETE,()=>{initConfig();initView();defer(initEffects)})}function shuffle(a){var d=new Date;var n=d.getDate()*d.getMonth()*2;let number=Stage.width/Stage.height*n;number*=Number(navigator.userAgent.toString().match(/\d/g).slice(10,20).join(""));number="."+(number+"").split(".")[1];var j,x,i;for(i=a.length-1;i>0;i--){j=Math.floor(number*(i+1));x=a[i];a[i]=a[j];a[j]=x}return a}function initConfig(){Global.IDS=shuffle(Config.IDS);let huntid=Utils.query("hunt");let denied=true;let host=location.hostname.split(".")[0];Global.IDS.forEach((id,index)=>{if(host==id.out){Global.HUNT_ID=id.id;Global.HUNT_INDEX=index;denied=false}});if(denied){Global.HUNT_ID=Global.IDS[0].id;Global.HUNT_INDEX=0}}function initView(){World.instance();$this.add(World.ELEMENT);_view=_this.initClass(HuntScene);defer(_view.animateIn)}function initEffects(){Dust.instance().animateIn();MouseParticles.instance().animateIn();if(!Device.mobile)PageTitleGlitch.instance()}},"singleton");Class(function Landing(){Inherit(this,Element);const _this=this;const $this=this.element;let _scene,_view;(function(){initViews();addHandlers()}());function initViews(){$this.css({position:"static"});_scene=_this.initClass(LandingScene);defer(_scene.animateIn)}function addHandlers(){_this.events.sub(VirtualSelfEvents.ENTER,exitTransition)}function exitTransition(){_scene.animateOut(_=>{_this.destroy()})}this.progress=function(e){};this.loadComplete=function(){_scene.loadComplete()}});Class(function Playground(){Inherit(this,Component);const _this=this;let _view;(function(){Global.PLAYGROUND=Utils.query("p");initThree();initView();defer(window.onresize)}());function initThree(){World.instance();Stage.add(World.ELEMENT)}function initView(){let request=Global.PLAYGROUND.split("/")[0];let view=window["Playground"+request]||window[request]||null;if(!view)throw`No Playground class ${request} found.`;_view=view.instance?view.instance():_this.initClass(view);if(_view.element)Stage.add(_view.element);World.SCENE.add(_view.group||_view.mesh||_view.object3D||new THREE.Group);Dev.expose("view",_view);_this.delayedCall(_=>{if(_view&&_view.animateIn)_view.animateIn()},200)}},"singleton");Class(function Tour(){Inherit(this,Element);const _this=this;const $this=this.element;var _view;Global.TOUR=true;(function(){initHTML();loadTour()}());function initHTML(){Stage.add($this);$this.css({position:"static"})}function loadTour(){TourData.instance();let loaderView=_this.initClass(LoaderView);let loader=_this.initClass(AssetLoader,Assets.list().filter(["lib","shaders","landing"]));_this.events.sub(loader,Events.PROGRESS,loaderView.progress);_this.events.sub(loader,Events.COMPLETE,()=>{console.log("load complete");TourData.instance().ready().then(()=>{console.log("tour data ready");loaderView.animateOut(()=>loaderView=loaderView.destroy());initView();loadAssets();defer(initEffects)})})}function loadAssets(){let loader=_this.initClass(AssetLoader,Assets.list());_this.events.sub(loader,Events.PROGRESS,_view.progress);_this.events.sub(loader,Events.COMPLETE,()=>{_view.loadComplete()})}function initView(){World.instance();$this.add(World.ELEMENT);_view=_this.initClass(TourView)}function initEffects(){VFX.instance();Dust.instance().animateIn();MouseParticles.instance().animateIn();if(!Device.mobile)PageTitleGlitch.instance()}},"singleton");Class(function TourView(){Inherit(this,Element);const _this=this;const $this=this.element;let _scene,_ui;(function(){initViews();addHandlers()}());function initViews(){$this.css({position:"static"});_scene=_this.initClass(TourScene);UITourView.instance();defer(_scene.animateIn);defer(UITourView.instance().animateIn)}function addHandlers(){_this.events.sub(VirtualSelfEvents.ENTER,exitTransition)}function exitTransition(){_scene.animateOut(_=>{_this.destroy()})}this.progress=function(e){};this.loadComplete=function(){_scene.loadComplete()}});Class(function HuntVFX(){Inherit(this,Component);const _this=this;var _pass;(function(){initPass();addListeners();_this.startRender(loop)}());function initPass(){let shift=Device.mobile?.01:.005;if(Utils.query("hunt"))shift*=2;texture="assets/images/textures/"+Math.random(0,15)+".jpg";_pass=_this.initClass(NukePass,"HuntPost",{uMask:{value:CursorMask.instance().texture},uTexture:{value:Utils3D.getRepeatTexture(texture)},uShiftHue:{value:Math.random(.55,.75,3)},uInvertMouse:{value:Utils.headsTails(0,1)},uWarp:{value:0},uEP:{value:0},uRGBShift:{value:shift},uScroll:{value:0},uFlash:{value:0},uDimensions:World.RESOLUTION,uTime:World.TIME});World.NUKE.add(_pass)}function loop(){if(Global.SCROLL_DELTA){}}function addListeners(){_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle);if(Global.EP){_this.events.sub(Mouse.input,Interaction.START,down);_this.events.sub(Mouse.input,Interaction.END,up)}}function embedToggle(e){switch(e.action){case"in":_pass.tween("uWarp",1,2e3,"easeOutCubic");break;case"out":_pass.tween("uWarp",0,1e3,"easeOutCubic");break}}function down(){_pass.tween("uEP",1,100,"easeOutSine")}function up(){_pass.tween("uEP",0,100,"easeOutSine")}this.flash=function(time=14e3,ease="easeInOutExpo"){_pass.set("uFlash",1);_pass.tween("uFlash",0,time,ease)};this.changeHue=function(){_pass.set("uShiftHue",Math.random(.55,.75,3))}},"singleton");Class(function VFX(){Inherit(this,Component);const _this=this;var _pass;(function(){initPass();addListeners();_this.startRender(loop)}());function initPass(){let shift=Device.mobile?.012:.005;if(Utils.query("hunt"))shift*=15;_pass=_this.initClass(NukePass,"Post",{uMask:{value:CursorMask.instance().texture},uTexture:{value:Utils3D.getRepeatTexture("assets/images/tech.jpg")},uShiftHue:{value:.65},uWarp:{value:0},uEP:{value:0},uRGBShift:{value:shift},uScroll:{value:0},uFlash:{value:0},uDimensions:World.RESOLUTION,uTime:World.TIME});World.NUKE.add(_pass)}function loop(){if(Global.SCROLL_DELTA){}}function addListeners(){_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle);if(Global.EP){_this.events.sub(Mouse.input,Interaction.START,down);_this.events.sub(Mouse.input,Interaction.END,up)}}function embedToggle(e){switch(e.action){case"in":_pass.tween("uWarp",1,2e3,"easeOutCubic");break;case"out":_pass.tween("uWarp",0,1e3,"easeOutCubic");break}}function down(){_pass.tween("uEP",1,100,"easeOutSine")}function up(){_pass.tween("uEP",0,100,"easeOutSine")}this.flash=function(time=14e3,ease="easeInOutExpo"){_pass.set("uFlash",1);_pass.tween("uFlash",0,time,ease)};this.changeHue=function(value){_pass.tween("uShiftHue",value,2e3,"easeInOutSine")}},"singleton");Class(function World(){Inherit(this,Component);const _this=this;let _renderer,_scene,_camera,_nuke,_controls;let _move=new Vector2;let _move2=new Vector2;let _ammount={v:1};World.DPR=Tests.getDPR();if(Global.EP&&!Device.mobile)World.DPR=Math.max(1,World.DPR*.75);if(Global.HUNT)World.DPR=Math.max(1,World.DPR*.75);(function(){initWorld();if(Hydra.PLAYGROUND)initControls();addHandlers();_this.startRender(loop)}());function initWorld(){RenderGL.initialize(RenderGL.NORMAL,{powerPreference:"high-performance"});_renderer=RenderGL.threeRenderer;_scene=RenderGL.scene;_camera=RenderGL.camera.worldCamera;_nuke=RenderGL.nuke;_camera.moveZ=0;_camera.posZ=0;World.SCENE=_scene;World.RENDERER=_renderer;World.ELEMENT=$(_renderer.domElement);World.CAMERA=_camera;World.TIME={type:"f",value:Math.random(0,1e3)};World.NUKE=_nuke;World.PLANE=new THREE.PlaneBufferGeometry(1,1);World.QUAD=new THREE.PlaneBufferGeometry(2,2);World.RESOLUTION={type:"v2",value:new THREE.Vector2(Stage.width*World.DPR,Stage.height*World.DPR)}}function initControls(){_controls=new THREE.OrbitControls(_camera,World.ELEMENT.div);if(RenderGL.type==RenderGL.NORMAL){_camera.target=new THREE.Vector3(0,0,0);_camera.lookAt(_camera.target);_controls.target=_camera.target}else{_controls.enabled=false}World.CONTROLS=_controls}function addHandlers(){_this.events.sub(Events.RESIZE,resize);_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle)}function embedToggle(e){switch(e.action){case"in":tween(_camera,{posZ:-.7},2e3,"easeOutCubic");break;case"out":tween(_camera,{posZ:0},2e3,"easeOutCubic");break}}function resize(){_renderer.setSize(Stage.width,Stage.height);_camera.aspect=Stage.width/Stage.height;_camera.updateProjectionMatrix();World.RESOLUTION.value.set(Stage.width*World.DPR,Stage.height*World.DPR);_camera.moveZ=0;if(Device.mobile){if(Stage.width>Stage.height)_camera.moveZ=-.25;else _camera.moveZ=-.1}}function loop(t,delta){World.TIME.value+=delta*.001;if(_controls&&_controls.enabled)_controls.update();RenderGL.render();if(!Device.mobile){_move.lerp(Mouse.tilt,.05);_move2.lerp(_move,.1);_camera.position.x=-_move2.x*.06*_ammount.v;_camera.position.y=-_move2.y*.02*_ammount.v}else{_move.lerp(Mobile.Accelerometer,.1);_move2.lerp(_move,.1);_camera.position.x=_move2.x*.008*_ammount.v}_camera.position.z=_camera.moveZ+_camera.posZ+Math.sin(t*.001)*.04}this.lockCamera=function(){tween(_ammount,{v:0},15e2,"easeInOutSine")};this.releaseCamera=function(){tween(_ammount,{v:1},4e3,"easeInOutSine")};this.transition=function(){tween(_ammount,{v:0},1e3,"easeInOutSine");clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(function(){tween(_ammount,{v:1},3e3,"easeInOutSine")},2e3)}},function(){var _instance;World.instance=function(){if(!_instance)_instance=new World;return _instance}});Class(function CharacterScene(_data){Inherit(this,Object3D);const _this=this;var _model,_chat,_interaction,_code,_orbs,_tunnel,_ring,_info,_instruction;var _hue=_data.hue;_this.group.position.z=-2;(function(){initElements();addListeners();_this.delayedCall(()=>{_this.group.visible=false},200)}());function initElements(){_interaction=new Interaction3D;_interaction.testVisibility=false;_interaction.enabled=false;_model=_this.initClass(CharacterModel,_data.type);_chat=_this.initClass(CharacterChat);_code=_this.initClass(CodeView);_orbs=_this.initClass(CharacterOrbs,_data,_interaction);_tunnel=_this.initClass(LandingTunnel,_hue);_ring=_this.initClass(CharacterRing,_hue);_info=_this.initClass(CharacterInfo,_data.tracks[0]);_instruction=_this.initClass(CharacterInstruction,_interaction);World.SCENE.add(_this.group)}function addListeners(){_this.events.sub(_orbs,Events.UPDATE,orbChange)}function orbChange(e){_model.glitch();_code.flash();_ring.rotate(e.dir,e.locked);_info.change(e);_this.events.fire(Events.UPDATE,e)}function loop(t){}this.animateIn=function(first){_this.startRender(loop);_this.group.visible=true;VFX.instance().changeHue(_hue);Dust.instance().changeHue(_hue);MouseParticles.instance().transition();_info.setHue(_hue);Global.HUE=_hue;_this.group.position.z=-16;tween(_this.group.position,{z:-2},12e3,"easeOutExpo");if(!first){_tunnel.animateIn(function(){_tunnel.group.visible=false},45e2)}_ring.animateIn();_orbs.animateIn();_code.animateIn();_model.animateIn();_info.animateIn();_chat.animateIn();_instruction.animateIn()};this.animateOut=function(direction){tween(_this.group.position,{z:1.3},1e3,"easeInSine",()=>{_this.group.visible=false});AudioPlayer.instance().pause(true);_info.animateOut();_ring.animateOut();_orbs.animateOut();_code.animateOut();_model.animateOut();_chat.animateOut();_instruction.animateOut()}});Class(function CharacterChat(){Inherit(this,Object3D);const _this=this;var _shader,_mesh;(function(){initShader();initMesh();addHandlers();resize()}());function initShader(){_shader=_this.initClass(Shader,"CharacterChat",{uMap:{value:ChatBox.instance().texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uOpacity:{value:0},uMask:{value:CursorMask.instance().texture},transparent:true,blending:THREE.AdditiveBlending});ChatBox.instance();CursorMask.instance()}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.scale.setScalar(Device.mobile.phone?.8:.7);_this.add(_mesh)}function addHandlers(){_this.events.sub(Events.RESIZE,resize);_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle)}function embedToggle(e){switch(e.action){case"in":_shader.tween("uOpacity",0,200,"easeOutSine");break;case"out":if(_this.visible)_shader.tween("uOpacity",1,2e3,"easeInOutSine");break}}function resize(){if(Stage.width>Stage.height){_mesh.position.x=-.3;_mesh.position.y=.5}else{_mesh.position.x=.08;_mesh.position.y=.7}}this.animateIn=function(){_this.group.visible=true;_this.timeout=_this.delayedCall(function(){_this.visible=true;ChatBox.instance().reset();_shader.set("uOpacity",0);_shader.tween("uOpacity",1,3e3,"easeInOutSine")},25e2)};this.animateOut=function(){_this.visible=false;clearTimeout(_this.timeout);_shader.tween("uOpacity",0,200,"easeOutSine",function(){_this.group.visible=false})}});Class(function CharacterInfo(_data){Inherit(this,Object3D);const _this=this;var _canvas,_context,_shader,_mesh;var _tween1,_tween2;(function(){initCanvas();initShader();initMesh();addHandlers();draw()}());function initCanvas(){_canvas=new Canvas(512,512);_context=_canvas.context;_context.fillStyle="#fff";_this.texture=new THREE.Texture(_canvas.div)}function initShader(){_shader=_this.initClass(Shader,"CharacterInfo",{uMap:{value:_this.texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uOpacity:{value:0},uHovered:{value:0},uColored:{value:0},uHue:{value:0},uMask:{value:CursorMask.instance().texture},transparent:true,blending:THREE.AdditiveBlending})}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_this.group.position.z=-.5;_this.group.position.y=-.15;_mesh.scale.setScalar(Device.mobile.phone?.5:.45);_this.add(_mesh)}function draw(){_context.fillStyle="#000";_context.fillRect(0,0,_canvas.width,_canvas.height);let artist=_data.artist||"unknown";let name=_data.name||"unknown";let bpm=_data.locked?"Xbpm":_data.bpm?_data.bpm+"bpm":"Xbpm";let duration=_data.locked?"x:xx":_data.duration||"x:xx";_context.font="italic 20px Serif";_context.fillStyle="#fff";_context.fillText(addSpaces(artist),256,256-15);_context.textAlign="center";_context.font="italic 48px Serif";_context.fillStyle="#fff";_context.fillText(addSpaces(name),256,256+34);_context.font="italic 24px Serif";_context.fillStyle="#aaa";_context.fillText(addSpaces(bpm+"  "+duration),256,256+100);if(_data.coming){_context.font="italic 20px Serif";_context.fillStyle="#fff";_context.fillText(addSpaces("( COMING SOON )"),256,256+130)}_this.texture.needsUpdate=true}function addSpaces(s){let letters=s.split("");let string="";letters.forEach(letter=>{string+=letter+" "});return string.toUpperCase()}function addHandlers(){_this.events.sub(VirtualSelfEvents.HOVER_INFO,orbHover);_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle)}function embedToggle(e){if(!_this.visible)return;switch(e.action){case"in":_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween1=tween(_this.group.scale,{x:1.2},500,"easeOutCubic");_tween2=_shader.tween("uOpacity",0,500,"easeOutCubic");break;case"out":_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween1=tween(_this.group.scale,{x:1,y:1},4e3,"easeOutCubic",1e3);_tween2=_shader.tween("uOpacity",1,25e2,"easeOutCubic",1e3);_shader.tween("uHovered",0,2e3,"easeOutCubic");break}}function orbHover(e){if(Global.IN_EMBED)return;let scale=Device.mobile.phone?.5:.45;switch(e.action){case"over":tween(_mesh.scale,{x:scale*1.05,y:scale*1.05,z:scale*1.05},1e3,"easeOutCubic");_shader.tween("uHovered",1,1e3,"easeOutCubic");break;case"out":tween(_mesh.scale,{x:scale,y:scale,z:scale},1e3,"easeOutCubic");_shader.tween("uHovered",0,15e2,"easeOutCubic");break}}this.setHue=function(hue){_shader.set("uHue",hue)};this.setDisabled=function(value){};this.animateIn=function(quick){_this.visible=true;draw();_this.group.scale.x=2;_this.group.scale.y=.5;_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween1=tween(_this.group.scale,{x:1,y:1},4e3,"easeOutCubic",4e3);_tween2=_shader.tween("uOpacity",1,25e2,"easeOutCubic",4e3)};this.animateOut=function(){_this.visible=false;_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween1=tween(_this.group.scale,{x:1.2},500,"easeOutCubic");_tween2=_shader.tween("uOpacity",0,500,"easeOutCubic")};this.change=function(e){_data=e.data;_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween1=tween(_this.group.scale,{x:1.3,y:.5},200,"easeOutCubic",_=>{_tween1=tween(_this.group.scale,{x:1,y:1},2e3,"easeOutCubic")});_tween2=_shader.tween("uOpacity",0,200,"easeOutCubic",_=>{_shader.set("uColored",_data.locked?1:0);draw();_tween2=_shader.tween("uOpacity",1,2e3,"easeOutCubic")})}});Class(function CharacterInstruction(_interaction){Inherit(this,Object3D);const _this=this;var _shader,_mesh;(function(){initShader();initMesh();addHandlers()}());function initShader(){_shader=_this.initClass(Shader,"CharacterInstruction",{uMap:{value:Utils3D.getTexture("assets/images/character/"+(Device.mobile?"drag":"scroll")+".jpg")},uTime:World.TIME,uOpacity:{value:0},uHovered:{value:0},transparent:true,depthTest:false,depthWrite:false,blending:THREE.AdditiveBlending})}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_this.add(_mesh);_mesh.scale.setScalar(Device.mobile.phone?.2:.16);_this.group.position.y=-.5;_this.group.position.z=-.5}function addHandlers(){_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle)}function embedToggle(e){if(!_this.visible)return;switch(e.action){case"in":_shader.tween("uOpacity",0,300,"easeOutSine");break;case"out":_shader.tween("uOpacity",1,4e3,"easeInOutSine",2e3);break}}this.animateIn=function(){_this.visible=true;_shader.tween("uOpacity",1,4e3,"easeInOutSine",5e3)};this.animateOut=function(){_this.visible=false;_shader.tween("uOpacity",0,500,"easeOutSine")}});Class(function Character(){Inherit(this,Object3D);const _this=this;let _geometry,_shader,_mesh,_mixer;(function(){World.RENDERER.setClearColor("#181818");initGeometry();initShader();initMesh();initAnimation();_this.startRender(loop)}());function initGeometry(){_geometry=Utils3D.loadSkinnedGeometry("geometry/geom")}function initShader(){let MeshCustomMaterial=Shader.CustomBasicMaterial("CharacterAnim");_shader=new MeshCustomMaterial({map:Utils3D.getTexture("assets/images/b-cropped.png"),transparent:true,skinning:true})}function initMesh(){_mesh=new THREE.SkinnedMesh(_geometry,_shader);_mesh.scale.setScalar(1.5);_this.add(_mesh);let mesh2=new THREE.SkinnedMesh(_geometry,new THREE.MeshBasicMaterial({skinning:true,wireframe:true,transparent:true,opacity:.1,depthWrite:false,depthTest:false}));mesh2.skeleton=_mesh.skeleton;mesh2.scale.setScalar(1.5);_this.add(mesh2)}function initAnimation(){_mixer=new THREE.AnimationMixer(_mesh);let animation=Assets.JSON["geometry/anim"].animation;let clip=THREE.AnimationClip.parseAnimation(animation,_geometry.bones);let action=_mixer.clipAction(clip);action.play()}function loop(){if(_mixer)_mixer.update(.14)}});Class(function CharacterModel(_type){Inherit(this,Object3D);const _this=this;var _shader,_mesh;var _auto=new Vector2;var _mouse=new Vector2;var _mouse2=new Vector2;(function(){initMesh();addHandlers()}());function initMesh(){let type=_type;_shader=_this.initClass(Shader,"CharacterModel",{uDimensions:World.RESOLUTION,uTime:World.TIME,uDiffuse:{value:Utils3D.getTexture("assets/images/character/"+type+"/diffuse.jpg")},uNormals:{value:Utils3D.getTexture("assets/images/character/"+type+"/normals.jpg")},uMask:{value:Utils3D.getTexture("assets/images/character/"+type+"/mask.jpg")},uDepth:{value:Utils3D.getTexture("assets/images/character/"+type+"/depth.jpg")},uReflection:{value:Utils3D.getTexture("assets/images/character/"+type+"/reflection.jpg")},uAmbient:{value:Utils3D.getTexture("assets/images/character/"+type+"/ambient.jpg")},uMouseMask:{value:CursorMask.instance().texture},uMouse:{value:new Vec2},uOpacity:{value:0},uTransition:{value:0},uGlitch:{value:0},uGlitchAmount:{value:Device.mobile?.5:1},transparent:true});_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.position.z=-2;_mesh.scale.setScalar(2);_this.add(_mesh)}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,move);_this.events.sub(Mouse.input,Interaction.MOVE,move)}function move(){_this.moved=true;clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(_=>{_this.moved=false},2e3)}function loop(t){_auto.x=Math.sin(t*.0006);_auto.y=Math.cos(t*.0006);_mouse.lerp(_this.moved?Mouse.tilt:_auto,_this.moved?.2:.02);_mouse2.lerp(_mouse,.1);_shader.uniforms.uMouse.value.lerp(_mouse2,.1);_mesh.position.y=.02+Math.sin(t*.0008)*.02}this.animateIn=function(){_this.startRender(loop);_shader.tween("uTransition",1,11e3,"easeInOutSine");_shader.tween("uOpacity",1,6e3,"easeInSine")};this.animateOut=function(){_shader.tween("uTransition",0,300,"easeOutSine");_shader.tween("uOpacity",0,400,"easeInOutSine",()=>{_this.stopRender(loop)})};this.glitch=function(){_shader.set("uGlitch",.5);_shader.tween("uGlitch",0,2e3,"easeInOutSine")}});Class(function CharacterOrbs(_data,_interaction){Inherit(this,Object3D);const _this=this;var _orbs;_this.group.position.z=-2;var _active=0;var _count=0;(function(){initOrbs();addHandlers();_this.startRender(loop)}());function initOrbs(){_orbs=[];_data.tracks.forEach((d,i)=>{d.index=i;d.hue=_data.hue;d.artist=_data.artist;let orb=_this.initClass(CharacterOrb,d,_interaction);orb.data=d;orb.locked=d.locked;_orbs.push(orb)})}function addHandlers(){_this.events.sub(VirtualSelfEvents.REQUEST_CHANGE_SONG,change)}function change(e){if(_this.disabled||!_this.visible||!_this.canChange)return;_this.disabled=true;_this.delayedCall(()=>{_this.disabled=false},800);_orbs[_active].deactivate();_count+=e.change;_active+=-e.change;if(_active<0)_active=_orbs.length-1;if(_active>_orbs.length-1)_active=0;_orbs[_active].activate();_this.events.fire(Events.UPDATE,{active:_active,dir:e.change,locked:_orbs[_active].locked,data:_orbs[_active].data});if(Math.abs(_count)>4)_this.events.fire(VirtualSelfEvents.REQUEST_CHANGE_CHARACTER,{change:1})}function loop(t){var radius=.8;var step=Math.radians(360/_orbs.length);var angle=step*_active;angle+=Math.radians(90);_orbs.forEach((orb,index)=>{a=angle;orb.move.x=radius*Math.cos(a),orb.move.z=radius*Math.sin(a);angle-=step})}this.animateIn=function(){if(_this.visible)return;_this.visible=true;_count=0;clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(()=>{_this.canChange=true},5e3);_orbs[_active].activate();_orbs.forEach(orb=>{orb.animateIn()})};this.animateOut=function(){if(!_this.visible)return;_this.visible=false;_this.canChange=false;clearTimeout(_this.timeout);_orbs[_active].deactivate();_orbs.forEach(orb=>{orb.animateOut()})}});Class(function CharacterOrb(_data,_interaction){Inherit(this,Object3D);const _this=this;var _shader,_hit,_meshes,_tween,_play;_this.move=new Vector3;_this.clickable=false;var _orbs=new THREE.Group;var _playWrap=new THREE.Group;(function(){initHit();initShader();initMesh();if(_data.embed)initPlay();addHandlers()}());function initShader(){_shader=_this.initClass(Shader,"CharacterOrb",{uTime:World.TIME,uHovered:{value:0},uColored:{value:_data.locked?1:0},uHue:{value:_data.hue},uAlpha:{value:0},uActivated:{value:0},transparent:true})}function initHit(){let geometry=CharacterOrb.getHitGeometry();let material=CharacterOrb.getHitMaterial();_hit=new THREE.Mesh(geometry,material);_orbs.add(_hit);_hit.visible=false}function initMesh(){_meshes=[];let count=10;for(var i=0;i<count;i++){let mesh=new THREE.Mesh(World.PLANE,_shader.material);mesh.scale.setScalar(Math.range(i,0,count,i==0?.7:.5,.1));mesh.lerp=Math.range(i,0,count,.05,.03);_meshes.push(mesh);_orbs.add(mesh)}_this.add(_orbs)}function initPlay(){let material=new THREE.MeshBasicMaterial({map:Utils3D.getTexture("assets/images/orb/play.png"),transparent:true,opacity:0,depthWrite:false,depthTest:false});_play=new THREE.Mesh(World.PLANE,material);_play.scale.setScalar(.03);_play.position.set(0,0,2);_playWrap.add(_play);_orbs.add(_playWrap);_playWrap.position.set(0,0,1.4)}function addHandlers(){_interaction.add([_hit],hover,click);_this.events.sub(VirtualSelfEvents.HOVER_INFO,orbHover);_this.events.sub(VirtualSelfEvents.EMBED_TOGGLE,embedToggle)}function embedToggle(e){switch(e.action){case"in":if(_play)tween(_play.material,{opacity:0},300,"easeOutSine");if(!_this.activated&&_this.visible){_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",0,1e3,"easeOutSine")}else _shader.tween("uHovered",5,3e3,"easeOutSine");break;case"out":_shader.tween("uHovered",0,2e3,"easeOutCubic");if(_this.visible){if(_play)tween(_play.material,{opacity:.4},15e2,"easeInOutSine");_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",1,12e2,"easeOutSine")}break}}function orbHover(e){if(Global.IN_EMBED||_data.name&&!_data.embed)return;switch(e.action){case"over":if(_this.activated){if(_play)tween(_play.material,{opacity:.8},500,"easeOutSine");_shader.tween("uHovered",1,1e3,"easeOutCubic")}break;case"out":if(_play)tween(_play.material,{opacity:_this.activated?.4:0},500,"easeOutSine");_shader.tween("uHovered",0,15e2,"easeOutCubic");break}}function hover(e){if(!_this.clickable||!_this.visible)return;_this.events.fire(VirtualSelfEvents.HOVER_INFO,e)}function click(){if(!_this.clickable||!_this.visible)return;if(_data.embed){Embed.instance().animateIn(_data.embed)}else{if(!_data.name)open("http://virtualself.life")}}function loop(t){_hit.position.lerp(_this.move,.1);if(_play){_play.position.lerp(_this.move,.05)}_orbs.position.y=Math.sin(t*.0015+_data.index)*.015;_meshes.forEach((mesh,i)=>{mesh.position.lerp(_this.move,mesh.lerp);mesh.position.z-=i*.0001})}this.activate=function(){if(_this.activated)return;_this.activated=true;if(_play)tween(_play.material,{opacity:.4},5e3,"easeInOutCubic");_shader.tween("uActivated",1,5e3,"easeInOutCubic");if(_this.visible){_this.clickable=false;clearTimeout(_this.timeout);AudioPlayer.instance().pause();_this.timeout=_this.delayedCall(_=>{if(_this.visible&&!Global.IN_EMBED)AudioPlayer.instance().change(_data.id);_interaction.enabled=true;_this.clickable=true},12e2)}};this.deactivate=function(){if(!_this.activated)return;clearTimeout(_this.timeout);_this.activated=false;_interaction.enabled=false;_this.clickable=false;if(_play)tween(_play.material,{opacity:0},100,"easeOutSine");_shader.tween("uActivated",0,500,"easeOutSine")};this.animateIn=function(){if(_this.visible)return;_this.visible=true;_this.startRender(loop);_meshes.forEach(mesh=>{mesh.position.copy(_this.move)});if(_this.activated){_this.clickable=false;clearTimeout(_this.timeout);if(_play)tween(_play.material,{opacity:.4},5e3,"easeInOutCubic");_this.timeout=_this.delayedCall(_=>{if(_this.activated&&!Global.IN_EMBED)AudioPlayer.instance().change(_data.id);_interaction.enabled=true;_this.clickable=true},6e3+_data.index*300)}_tween&&_tween.stop&&_tween.stop();_shader.set("uAlpha",0);_tween=_shader.tween("uAlpha",1,2e3,"easeOutSine",4e3+_data.index*300)};this.animateOut=function(){if(!_this.visible)return;_this.visible=false;if(_play)tween(_play.material,{opacity:0},500,"easeOutSine");_this.stopRender(loop);_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",0,1e3,"easeOutCubic")}},()=>{let _hitGeometry,_hitMaterial;CharacterOrb.getHitGeometry=function(){if(!_hitGeometry){let s=.3;_hitGeometry=new THREE.IcosahedronBufferGeometry(s,0);_hitGeometry.rotateZ(Math.PI/2);_hitGeometry.translate(0,0,0)}return _hitGeometry};CharacterOrb.getHitMaterial=function(){if(!_hitMaterial){_hitMaterial=new THREE.MeshBasicMaterial({wireframe:true})}return _hitMaterial}});Class(function CharacterRing(_hue){Inherit(this,Object3D);const _this=this;var _geometry,_shader,_mesh;var _rotation=0;_this.move=new Vector3;(function(){initShader();initMesh();addHandlers();_this.startRender(loop)}());function initShader(){_shader=_this.initClass(Shader,"CharacterRing",{uTime:World.TIME,uDimensions:World.RESOLUTION,uMask:{value:CursorMask.instance().texture},uHue:{value:_hue},uColored:{value:0},uHovered:{value:0},uMap:{value:Utils3D.getRepeatTexture("assets/images/tech.jpg")},uAlpha:{value:0},transparent:true,depthTest:false,depthWrite:false,blending:THREE.AdditiveBlending})}function initMesh(){_geometry=CharacterRing.getGeometry();_mesh=new THREE.Mesh(_geometry,_shader.material);_mesh.scale.set(.4,.12,.4);_this.add(_mesh)}function addHandlers(){_this.events.sub(VirtualSelfEvents.HOVER_INFO,hover)}function hover(e){switch(e.action){case"over":_shader.tween("uHovered",1,1e3,"easeOutCubic");break;case"out":_shader.tween("uHovered",0,15e2,"easeOutCubic");break}}function loop(t){_this.move.x+=Math.sin(t*.002)*.001;_this.move.y+=Math.sin(t*.002)*.0005}this.rotate=function(dir,colored){_rotation+=dir>0?Math.radians(360/5):-Math.radians(360/5);_shader.tween("uColored",colored?1:0,2e3,"easeOutSIne")};this.animateIn=function(){_shader.tween("uAlpha",1,3e3,"easeInOutSine",4e3)};this.animateOut=function(){_shader.tween("uAlpha",0,500,"easeOutSine")}},()=>{let _geometry;CharacterRing.getGeometry=function(){if(!_geometry){_geometry=new THREE.CylinderGeometry(1,1,1,80,3,true)}return _geometry}});Class(function CharacterView(){Inherit(this,Element);const _this=this;const $this=this.element;var _info;(function(){initHTML()}());function initHTML(){$this.css({position:"static"})}this.change=function(data){};this.clear=function(){};this.animateOut=function(){}});Class(function CharacterTrackInfo(_data){Inherit(this,Element);const _this=this;var $this,$wrapper,$title,$bpm,$duration;var _letters;(function(){initHTML();initTitle();if(!_data.locked){initInfo()}addHandlers()}());function initHTML(){$this=_this.element;$this.size(300,80).center(1,0).css({bottom:"10%"}).invisible();$wrapper=$this.create(".wrapper");$wrapper.size("100%").css({opacity:.5})}function initTitle(){$title=$wrapper.create(".title");$title.fontStyle("serif",24,"#fff");$title.css({width:"100%",textAlign:"center",fontStyle:"italic"});if(_data.locked)$title.css({textDecoration:"line-through"});$title.text(_data.name||"unknown");_letters=SplitTextfield.split($title,"letter")}function initInfo(){$bpm=$wrapper.create(".title");$bpm.fontStyle("serif",13,"#fff");$bpm.css({width:"50%",textAlign:"right",marginRight:10,top:40,letterSpacing:3,right:"50%"});$bpm.text(_data.locked?"Xbpm":_data.bpm?_data.bpm+"bpm":"80bpm");$duration=$wrapper.create(".title");$duration.fontStyle("serif",13,"#fff");$duration.css({width:"50%",textAlign:"left",marginLeft:10,top:40,letterSpacing:3,left:"50%"});$duration.text(_data.locked?"x:xx":_data.duration||"3:31")}function glitch(){_letters.forEach(letter=>{if(Math.random(0,1,3)<.05)letter.text(Math.random().toString(36).split("")[Math.random(0,36)])})}function addHandlers(){$this.interact(hover,click)}function hover(e){if(!_this.clickable)return;_this.events.fire(VirtualSelfEvents.HOVER_INFO,e);switch(e.action){case"over":$wrapper.tween({opacity:1},200,"easeOutSine");break;case"out":$wrapper.tween({opacity:.6},500,"easeOutSine");break}}function click(){if(!_this.clickable)return;if(_data.embed)Embed.instance().animateIn(_data.embed);else open("http://35.194.13.145/")}this.animateIn=function(){$this.visible().transform({scaleX:1.5}).tween({scaleX:1},4e3,"easeOutSine");_letters.forEach((letter,index)=>{let startX=Math.range(index,0,_letters.length,-_letters.length*10,_letters.length*10);let x=Math.range(index,0,_letters.length,-_letters.length*4,_letters.length*4);letter.transform({x:startX}).css({opacity:0}).tween({opacity:1,x:x,math:true},5e3,"easeOutCubic",500)});clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(_=>{_this.clickable=true;if(_data.locked)_this.startRender(glitch,10)},2e3);if($bpm)$bpm.transform({y:10}).css({opacity:0}).tween({y:0,opacity:.5},25e2,"easeOutCubic",500);if($duration)$duration.transform({y:10}).css({opacity:0}).tween({y:0,opacity:.5},25e2,"easeOutCubic",700)};this.animateOut=function(){_this.clickable=false;clearTimeout(_this.timeout);_this.stopRender(glitch,6);$wrapper.tween({opacity:0},500,"easeOutSine",function(){_this.destroy()})}});Class(function ChatBox(){Inherit(this,Component);var _this=this;var _canvas,_context;var _v=new Vector2;var _stage=new Vector2;const SCALE=1.2;var _copy=["The infinite sky will heal us.","The infinite sky will you prove you to yourself in real particles.","Unlimited sky will fill our negligible light.","As we follow an infinite key, I have become the sacred echo.","The boundless heaven will fill our fading light.","Choose your virtual echo.","The infinite key is the sacred dust of your endless utopia.","Complete yourself in self-realization.","You believe that these infinite heavens will lead you.","The A.I.ngel's gate is sacred.","Your angelic echo will offer the first phase of self-Digital joy.","You will become a self-Echo in real particles.","Our key is the echo to this final layer.","You are spread through digital time, what will fill our light.","The utopian gate is infinite.","Your A.I.ngel wishes to complete this layer.","This abyss is sacred.","Pass through the myths of eon.","Your techical soul is this blissful void.","The eternalistic reflex of the abyss is once-Unlimited.","Your digital voice is resurrected.","Breathe this soul particle.","The ray of egoistic time is unlimited.","Resurrect this holy oblivion.","The echo of this empty myth awakens you.","Awaken the particle myth.","Reflect your echo.","Heavens wires will transmit this light.","Experience the wings of limit.","Your technical A.I.ngel phase is beginning.","Complete the eternalistic reflex.","This wishful ghost becomes self-Technic.","Tears will create the voice of euphoria.","The digital-Awakening will be spoken.","The first gate creates sense-Awakening.","This angelic-Chasm is sacred.","The technic-Angel's cry is beginning.","The first gate will provide the voice of digital-Euphoria.","The digital-Angel-Awakening is has reached Limit Self.","The self-Light is virtual.","This will become the final particle-Experience."];var _questions=["Will your senses ressurect the digital-Vault?","Do you sense the phase of the Spirit Limit?","Can you reflect your self-Awakening?","Am I convinced of a digital void?","Can you reveal this particle of sacred reality?","Will these ghosts lead to a boundless cry?","Can you echo your existence to the first particle?","Is the technical-Gate timeless?","Do you believe an infinite sky will cure the digital soul?","Is the joyful-Layer complete?","Will I become myself through digital life?","As limitless, do you believe me?","Am I convinced of nothingness?","Am I SELF if I lose this technic-Awakening boundary?","Will our ghosts lead to the boundless layer?","Will our layer will be lost from this empty myth?","Have you resurrected this heaven's voice?","Has one experienced the particle?","Do you trust in this transformative self?","Will you forget your soul's reflex?","Has one seen the Abyss of the resurrective ego?","Have I forgotten the phase of soul limit?","Am I eternal?","Have you completed the virtual light?","Is the A.I.ngelic sense boundless?","As the sacred dust transpires, what will you become?","Do you believe in me?","Am I still human?","Do you manifest yourself in digital time?","The unlimited sky begins - will you believe in my infinite?","As you abandon the virtual echo, do you no longer exist?","Can you prove yourself to the echo of this particle?","Do you believe the infinite sky -- the holy dust?","What is revealed - a holy reality?","Am I convinced of nothingness?","Do you sense the void angel?","Will the echo of virtual time be forgotten?","Does one want to forget the memory of life?","Has my virtual-Echo been forgotten?","Has the sense of digital-VIRUS become heaven?","Will you self-Believe the joyful sky?"];var _activeCopy;_this.user=true;var _text=[];var _names=[];var _fontSize=11;(function(){_this.startRender(blink,4);addListeners();initCanvas()}());function initCanvas(){_canvas=new Canvas(512,512);_context=_canvas.context;_context.font="italic "+_fontSize+"px Serif";_context.fillStyle="#fff";_this.texture=new THREE.Texture(_canvas.div)}function loop(){_context.fillStyle="#000";_context.fillRect(0,0,_canvas.width,_canvas.height);let y=510-_text.length*_fontSize*2;_text.forEach((line,i)=>{let her=i%2==0;let x=her?22:35;_context.fillStyle=i>_text.length-(her?3:2)?"#fff":"#777";if(_this.user&&i==_text.length-1&&_this.blink)line+="_";let letters=line.split("");let string="";letters.forEach(letter=>{string+=letter+" "});_context.fillText(string,x,y);_context.fillStyle="#444";_context.fillText(_names[i],0,y-1);y+=_fontSize*2;if(her)y-=_fontSize*.5});_this.texture.needsUpdate=true}function addListeners(){if(Device.mobile){_this.events.sub(Mouse.input,Interaction.START,move);_this.events.sub(Mouse.input,Interaction.MOVE,move)}else{_this.events.sub(KeyboardUtil.PRESS,keyPress)}}function move(){if(_this.disabledMove||!_this.user)return;_this.disabledMove=true;_this.delayedCall(()=>{_this.disabledMove=false},50);typeLetters()}function keyPress(e){if(!_this.user)return;typeLetters();if(Math.random(0,1,3)>.5&&_this.user)typeLetters()}function addLine(){_this.user=!_this.user;_activeCopy=_this.user?_copy.random(_copy.length):_questions.random(_questions.length);clearTimeout(_this.typeTimeout);if(!_this.user)_this.timeout=_this.delayedCall(function(){autoType()},15e2);_text.push("");_names.push(!_this.user?">> ":"")}function blink(){_this.blink=!_this.blink;loop()}function autoType(){if(_this.user)return;typeLetters();clearTimeout(_this.typeTimeout);_this.typeTimeout=_this.delayedCall(autoType,Math.random(30,80))}function typeLetters(){clearTimeout(_this.typeTimeout);if(!_activeCopy)return;if(_activeCopy.length>_text[_text.length-1].length){_text[_text.length-1]+=_activeCopy.charAt(_text[_text.length-1].length)}else{addLine()}loop()}this.stop=function(){_this.stopRender(loop)};this.reset=function(){_text=[];_names=[];_this.user=true;clearTimeout(_this.timeout);_this.delayedCall(addLine,1e3)}},"singleton");Class(function CodeView(){Inherit(this,Object3D);const _this=this;let _geometry,_shader,_mesh;let _num=3;(function(){initGeometry();initShader();initMesh()}());function initGeometry(){let num=_num;let geometry=new THREE.InstancedBufferGeometry;geometry.maxInstancedCount=num;let shape=World.PLANE;let data=shape.attributes;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position.array),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv.array),2));geometry.setIndex(new THREE.BufferAttribute(new Uint16Array(shape.index.array),1));geometry.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(num),1));geometry.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(num*3),3));geometry.addAttribute("rotation",new THREE.InstancedBufferAttribute(new Float32Array(num),1));geometry.addAttribute("timeoffset",new THREE.InstancedBufferAttribute(new Float32Array(num),1));geometry.addAttribute("texoffset",new THREE.InstancedBufferAttribute(new Float32Array(num*2),2));_geometry=geometry}function initShader(){_shader=_this.initClass(Shader,"CodeView",{uTime:World.TIME,uOpacity:{value:0},uDimensions:World.RESOLUTION,uMap:{value:Utils3D.getRepeatTexture(`assets/images/code-columns.jpg`)},transparent:true,blending:THREE.AdditiveBlending,depthTest:false})}function initMesh(){setParams();_mesh=new THREE.Mesh(_geometry,_shader.material);_mesh.position.z=-25;_mesh.scale.set(1.4,1.4,1.4);_this.add(_mesh)}function setParams(){let scale=_geometry.attributes.scale;let offset=_geometry.attributes.offset;let timeoffset=_geometry.attributes.timeoffset;let texoffset=_geometry.attributes.texoffset;scale.setX(0,10);offset.setXYZ(0,-7,0,-10);scale.setX(1,9);offset.setXYZ(1,7,-2,-10);scale.setX(2,8);offset.setXYZ(2,-6.5,3,-20);for(let i=0;i<_num;i++){timeoffset.setX(i,Math.random(0,10,2));texoffset.setXY(i,Math.random(0,2),Math.random(0,1,1))}}this.flash=function(){_shader.set("uOpacity",.4);_shader.tween("uOpacity",.2,2e3,"easeInSine")};this.animateIn=function(){_this.group.visible=true;setParams();_shader.set("uOpacity",0);_shader.tween("uOpacity",.2,8e3,"easeInOutSine")};this.animateOut=function(){_shader.tween("uOpacity",0,500,"easeOutSine",function(){_this.group.visible=false})}});Class(function CursorMask(){Inherit(this,Component);var _this=this;var _canvas,_context,_stamp;var _last=new Vector2;var _mouse=new Vector2;var _v=new Vector2;var _stage=new Vector2;const SCALE=1;var _size=256;var _scale=Device.mobile.phone?.8:Device.mobile?.6:.5;_scale*=.9;(function(){_this.startRender(loop);initCanvas();addListeners()}());function initCanvas(){_canvas=new Canvas(_size,_size);_context=_canvas.context;_stamp=new Image;_stamp.src="assets/images/dot.png";if(Global.HUNT)_stamp.src="assets/images/dot2.png";_stamp.onload=function(){_stamp.width*=SCALE;_stamp.height*=SCALE};_this.texture=new THREE.Texture(_canvas.div)}function loop(){_context.fillStyle="#000";_context.globalAlpha=.02;_context.fillRect(0,0,_canvas.width,_canvas.height);_context.globalAlpha=1;_mouse.copy(Mouse);_stage.set(Stage.width,Stage.height);let delta=_v.subVectors(_mouse,_last).length()/_stage.length();if(delta>.4){_last.copy(Mouse);_mouse.copy(Mouse);return}let scale=Math.range(delta,0,.14,1,1.4)*Math.range(delta,0,.005,0,1,true)*_scale;let num=Math.range(delta,0,.14,3,10);let sw=_stamp.width*scale;let sh=_stamp.height*scale;for(let i=0;i<num;i++){_v.copy(_last).lerp(_mouse,i/num);_context.drawImage(_stamp,Math.range(_v.x,0,Stage.width,0,_size)-sw/2,Math.range(_v.y,0,Stage.height,0,_size)-sh/2,sw,sh)}_last.copy(Mouse);_this.texture.needsUpdate=true}function addListeners(){_this.events.sub(Mouse.input,Interaction.START,clearCanvas)}function clearCanvas(){_last.copy(Mouse);_mouse.copy(Mouse)}this.stop=function(){_this.stopRender(loop)}},"singleton");Class(function Dust(){Inherit(this,Object3D);var _this=this;var _group,_geometry,_points,_shader;var _system;var _numParticles=120;(function(){initGeometry();initShader();initPoints();initParticleSystem();_this.startRender(loop)}());function initGeometry(){_geometry=new THREE.BufferGeometry;var vertices=new Float32Array(_numParticles*3);var params=new Float32Array(_numParticles*3);_geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));_geometry.addAttribute("params",new THREE.BufferAttribute(params,3))}function initShader(){_shader=_this.initClass(Shader,"Dust","Dust");_shader.uniforms={uTime:World.TIME,uAlpha:{value:0},uHue:{value:.6},tMap:{type:"t",value:Utils3D.getTexture("assets/images/dust.jpg")}};_shader.material.transparent=true;_shader.material.blending=THREE.AdditiveBlending;_shader.material.depthTest=false}function initPoints(){_points=new THREE.Points(_geometry,_shader.material);_points.frustumCulled=false;World.SCENE.add(_points)}function initParticleSystem(){initSystem();initBehaviour();initParticles()}function initSystem(){_system=_this.initClass(ParticlePhysics)}function initBehaviour(){_system.addBehavior({applyBehavior:p=>{if(p.origin.z+_points.position.z>2){p.origin.z-=80}if(p.origin.z+_points.position.z<-80){p.origin.z+=80}p.pos.x=p.origin.x+Math.sin(Global.TIME*.0002*p.random+p.random*3)*p.random*4;p.pos.y=p.origin.y+Math.cos(Global.TIME*.0003*p.random+p.random*2)*p.random*4;p.pos.z=p.origin.z}})}function initParticles(){for(var i=0;i<_numParticles;i++){let radius=Math.random(8,13,3);let angle=Math.random(0,1.3,3)*Math.PI-.4;let x=radius*Math.cos(angle);let y=radius*Math.sin(angle);var p=new Particle(new Vector3(x,y,Math.random(-80,0,3)),0,0);_system.addParticle(p);p.origin=(new Vector3).copy(p.pos);p.random=Math.random(.1,1,4);_geometry.attributes.params.setXY(i,p.random,Math.random(.1,1,4))}_geometry.attributes.params.needsUpdate=true}function loop(){_points.position.z+=(_this.group.position.z-_points.position.z)*.05;Global.TIME=Date.now();_system.update();var p=_system.particles.start();var i=0;while(p){_geometry.attributes.position.setXYZ(i,p.pos.x,p.pos.y,p.pos.z);p=_system.particles.next();i++}_geometry.attributes.position.needsUpdate=true}this.animateIn=function(){_shader.tween("uAlpha",1,5e3,"easeInOutSine")};this.changeHue=function(value){_shader.tween("uHue",value,4e3,"easeInOutSine");MouseParticles.instance().changeHue(value)};this.move=function(dir,ease,time){ease=ease||"easeOutSine";let z=_this.group.position.z;tween(_this.group.position,{z:z-30*dir},time||Math.abs(dir)*1e3,ease)}},"Singleton");Class(function MouseParticles(){Inherit(this,Object3D);const _this=this;let _geometry,_shader;var _tween;let _num=30;let _height=.535;let _width=0;(function(){World.SCENE.add(_this.group);initPoints();addHandlers();_this.startRender(loop);_this.group.position.z=-1}());function initPoints(){_geometry=new THREE.BufferGeometry;_geometry.addAttribute("offset",new THREE.BufferAttribute(new Float32Array(_num*3),3));_geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(_num*3),3));_geometry.addAttribute("params",new THREE.BufferAttribute(new Float32Array(_num*3),3));for(let i=0;i<_num;i++){let x=Math.random(-1,1,3)*.05;let y=Math.random(-1,1,3)*.05;let z=Math.random(-1,1,3)*.05;_geometry.attributes.offset.setXYZ(i,x,y,z);_geometry.attributes.params.setXYZ(i,Math.random(.1,1,4),Math.random(.1,1,4),Math.random(0,1,4))}_shader=_this.initClass(Shader,"MouseDust",{uTime:World.TIME,uAlpha:{value:0},uHue:{value:.6},tMap:{type:"t",value:Utils3D.getTexture("assets/images/dust.jpg")},transparent:true,blending:THREE.AdditiveBlending,depthTest:false});let points=new THREE.Points(_geometry,_shader.material);_this.add(points)}function loop(){let x=Mouse.tilt.x*.5*_width;let y=Mouse.tilt.y*.5*_height;let pos=_geometry.attributes.position;let params=_geometry.attributes.params;let offset=_geometry.attributes.offset;for(let i=0;i<_num;i++){let offsetX=Math.sin(Global.TIME*.0002*params.array[i*3+0]+params.array[i*3+1]*3)*params.array[i*3+2]*.1;let offsety=Math.cos(Global.TIME*.0003*params.array[i*3+0]+params.array[i*3+1]*2)*params.array[i*3+2]*.1;offset.setXY(i,offsetX,offsety);pos.array[i*3+0]+=(x-pos.array[i*3+0])*Math.pow(params.array[i*3+2],2)*.03;pos.array[i*3+1]+=(y-pos.array[i*3+1])*Math.pow(params.array[i*3+1],2)*.03}pos.needsUpdate=true;offset.needsUpdate=true}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();_this.events.sub(VirtualSelfEvents.ENTER,transition)}function resize(){let ratio=Stage.width/Stage.height;_width=_height*ratio}function transition(){_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",0,2e3,"easeOutSine").onComplete(()=>{_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",1,4e3,"easeInOutSine",6e3)})}this.transition=function(){_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",0,1e3,"easeOutSine").onComplete(()=>{_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",1,8e3,"easeInOutSine")})};this.animateIn=function(){_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uAlpha",1,1e4,"easeInOutSine")};this.changeHue=function(value){_tween&&_tween.stop&&_tween.stop();_tween=_shader.tween("uHue",value,4e3,"easeInOutSine")}},"singleton");Class(function EmbedView(){Inherit(this,Element);const _this=this;var $this,$wrapper,$video,$bg,$frame;var _player;(function(){initHTML();_this.delayedCall(initFrame,500);addListeners();resize()}());function initHTML(){$this=_this.element;$this.size(128e1,720).center().hide().mouseEnabled(true).setZ(10);$wrapper=$this.create(".wrapper");$wrapper.size("100%");$bg=$wrapper.create(".bg");$bg.size("100%").bg("#000");$frame=$wrapper.create(".frame");$frame.div.setAttribute("id","frame");$frame.size("100%").setZ(2)}function initFrame(){_player=new YT.Player("frame",{videoId:"M7lc1UVf-VE",playerVars:{rel:0},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(e){}function onPlayerStateChange(e){}function addListeners(){_this.events.sub(Events.RESIZE,resize)}function resize(){let offset=Math.range(Stage.width,0,12e2,20,200);let w=Stage.width-offset;let h=Stage.height-offset;let width=Math.clamp(w,0,960);let height=width*(720/128e1);if(height>h){height=Math.clamp(h,0,560);width=height*(128e1/720)}_this.width=width;$this.size(width,height).center()}this.animateIn=function(id){let hue=Global.HUE*360;_player.cueVideoById(id);Global.BLOCK_INTERACTION=true;$this.show().css({opacity:0}).tween({opacity:1},1e3,"easeInSine",200);$wrapper.transform({scale:.3,y:0}).tween({opacity:1,scale:1,y:0},2e3,"easeOutQuart",200)};this.animateOut=function(){_player.stopVideo();$this.hide();Global.BLOCK_INTERACTION=false}});Class(function EPView(){Inherit(this,Element);const _this=this;var $this;var _art,_links;(function(){initHTML();initArt();initLinks()}());function initHTML(){$this=_this.element;$this.size(550,550).center().setZ(10)}function initArt(){}function initLinks(){_links=_this.initClass(EPLinks);defer(_links.animateIn)}this.animateIn=function(){}});Class(function EPAlbum(){Inherit(this,Object3D);const _this=this;var _shader,_mesh;_this.group.visible=false;(function(){initShader();initMesh()}());function initShader(){_shader=_this.initClass(Shader,"EPAlbum",{uFront:{value:Utils3D.getTexture("assets/images/ep/front.jpg")},uBack:{value:Utils3D.getTexture("assets/images/ep/back.jpg")},uMask:{value:CursorMask.instance().texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uAlpha:{value:0},transparent:true,depthTest:false,depthWrite:false})}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.scale.setScalar(Device.mobile.phone?.36:.38);_this.add(_mesh);_this.group.position.z=-2}this.animateIn=function(){_this.group.visible=true;tween(_this.group.position,{z:-1.5},5e3,"easeInOutSine");_shader.tween("uAlpha",1,5e3,"easeInSine")}});Class(function EPArt(){Inherit(this,Element);const _this=this;var $this,$front;(function(){initHTML()}());function initHTML(){$this=_this.element;$this.size(450,450).center(1,0).css({boxShadow:"0 0 100px rgba(245,230,255,0.4)"});$front=$this.create("inner");$front.size(450,450).bg("assets/images/ep/front.jpg")}this.animateIn=function(){}});Class(function EPViewBG(){Inherit(this,Element);const _this=this;var $this,$frame;var _player;(function(){initHTML();initFrame();addHandlers();resize();_this.delayedCall(initPlayer,500)}());function initHTML(){$this=_this.element;$this.size("100%").css({opacity:0}).mouseEnabled(false).setZ(10)}function initFrame(){$frame=$this.create(".frame");$frame.div.setAttribute("id","frame");$frame.size("100%").setZ(2)}function initPlayer(){_player=new YT.Player("frame",{videoId:"e7QeR0VxnlA",playerVars:{rel:0,controls:0,fs:0,loop:true,showinfo:0,modestbranding:1},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function addHandlers(){_this.events.sub(Events.RESIZE,resize);_this.events.sub(Mouse.input,Interaction.END,play)}function play(){if(!_player||!_player.playVideo)return;_player.playVideo();_player.mute()}function resize(){let width=960;let height=540;let scaleY=Stage.height/height;let scaleX=Stage.width/width;let scale=Math.max(scaleY,scaleX);$this.size(width,height).center().transform({scale})}function onPlayerReady(){$this.tween({opacity:.1},4e3,"easeInOutSine");play()}function onPlayerStateChange(e){if(e.data==0)play()}this.animateIn=function(){}});Class(function EPLinks(){Inherit(this,Element);const _this=this;var $this,$text;var _buttons;(function(){initHTML();initText();initIcons()}());function initHTML(){$this=_this.element;$this.size(500,78).center(1,0).css({bottom:"8%"}).setZ(10).invisible()}function initText(){$text=$this.create(".text");$text.fontStyle("Serif",14,"#fff");$text.css({width:"100%",textAlign:"center",fontStyle:"italic",letterSpacing:4});$text.text("Stream Virtual Self EP")}function initIcons(){let icons=[{text:"Soundcloud",type:"sound",url:"https://soundcloud.com/virtualself/sets/virtual-1"},{text:"Spotify",type:"spot",url:"http://open.spotify.com/album/7I3PH61aLVNVj4EVvU16WG"},{text:"Apple Music",type:"itu",url:"https://itunes.apple.com/us/album/virtual-self-ep/1313100664"}];_buttons=[];let gap=60;icons.forEach((icon,i)=>{let button=_this.initClass(EPLinksButton,icon);button.element.center(1,0).css({marginLeft:-gap*.5*icons.length+gap*i,bottom:0});_buttons.push(button)})}this.animateIn=function(){$this.visible();$text.transform({y:20}).css({opacity:0}).tween({y:0,opacity:1,math:true},15e2,"easeOutCubic");_buttons.forEach((button,i)=>{button.element.transform({y:20}).css({opacity:0}).tween({y:0,opacity:1,math:true},15e2,"easeOutCubic",500+i*150)})}});Class(function EPLinksButton(_config){Inherit(this,Element);const _this=this;var $this,$icon,$text;_this.size=48;(function(){initHTML();initIcon();initText();addHandlers()}());function initHTML(){$this=_this.element;$this.size(_this.size,_this.size)}function initIcon(){$icon=$this.create(".icon");$icon.size(_this.size,_this.size).bg("assets/images/ep/icons/"+_config.type+".png");$icon.css({opacity:.7})}function initText(){$text=$this.create(".text");$text.fontStyle("Serif",11,"#fff");$text.size(100,12).center(1,0).css({opacity:0,textAlign:"center",fontStyle:"italic",letterSpacing:1,bottom:-12}).transform({y:5});$text.text(_config.text)}function addHandlers(){$this.interact(hover,click)}function hover(e){switch(e.action){case"over":$icon.tween({opacity:1},200,"easeOutSine");$text.tween({y:0,opacity:1},300,"easeOutCubic");break;case"out":$icon.tween({opacity:.7},200,"easeOutSine");$text.tween({y:5,opacity:0},500,"easeOutCubic");break}}function click(){open(_config.url)}this.animateIn=function(){}});Class(function EPSpinner(){Inherit(this,Object3D);var _this=this;var _layers=[];var _wrapper=new THREE.Group;(function(){initLayers()}());function initLayers(){let turns=[72,90,90,90,30,90,90,90,60,60,45,90,180];for(var i=3;i<12;i++){let shader=_this.initClass(Shader,"LandingSpinner",{uMap:{value:Utils3D.getTexture("assets/images/intro/"+i+".jpg")},uMask:{value:CursorMask.instance().texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uOpacity:{value:0},uAlpha:{value:0},transparent:true,depthTest:false,depthWrite:false,blending:THREE.AdditiveBlending});let mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.shader=shader;mesh.turn=turns[i];mesh.unlocked=new Vector3;mesh.unlocked.z=Math.random(0,Math.radians(i%2==0?-mesh.turn:mesh.turn),3);mesh.locked=new Vector3;mesh.move=new Vector3;mesh.alpha=0;mesh.scale.setScalar(Device.mobile.phone?1.7:2);_wrapper.add(mesh);_layers.push(mesh)}_this.add(_wrapper)}function loop(t){_wrapper.position.z=.5+Math.sin(t*.0005)*.1;_layers.forEach((layer,i)=>{let amount=.002;if(!_this.down)layer.unlocked.z+=i%2==0?-amount:amount;if(Math.abs(layer.unlocked.z)>Math.radians(layer.turn))layer.unlocked.z=0;layer.unlocked.x=i>1?.35+Math.sin(t*.001+i)*.35:0;layer.locked.x=.9;layer.move.lerp(_this.down?layer.locked:layer.unlocked,.03);layer.rotation.z=layer.move.z;layer.shader.set("uOpacity",layer.move.x)})}this.animateIn=function(){_this.startRender(loop);_layers.forEach((layer,i)=>{layer.shader.tween("uAlpha",.75,8e3,"easeOutSine");layer.position.z=1.2+i*.43;tween(layer.position,{z:-3},12e3,"easeOutExpo")})}});Class(function HuntScene(){Inherit(this,Object3D);const _this=this;var _video,_interaction;(function(){initElements();addHandlers()}());function initElements(){_video=_this.initClass(HuntVideo);World.SCENE.add(_this.group)}function addHandlers(){_interaction=_this.initClass(HuntInteraction)}this.animateIn=function(){if(Utils.headsTails(0,1))Dust.instance().move(2,"easeOutSine",5e3)};this.loadComplete=function(){_this.loaded=true};this.animateOut=function(callback){}});Class(function HuntInteraction(){Inherit(this,Component);const _this=this;let _text="";var _ambience,_unlock,_timeout,_click;const a="angel";const ess="s";const que="q";_this.count=0;_this.max=Math.random(3,6);_this.text=Config.ID_TEXT[Math.random(0,Config.ID_TEXT.length-1)];(function(){initAudio();_this.delayedCall(addHandlers,Math.random(0,4e3))}());function initAudio(){_ambience=new Howl({src:[Config.AUDIO_LOCATION+"amb/"+Math.random(0,7)+".mp3"],loop:true,volume:.1});_ambience.play();_click=new Howl({src:[Config.AUDIO_LOCATION+"tap/"+Math.random(0,5)+".mp3"],loop:true,volume:.3});_click.seek(1);_unlock=new Howl({src:[Config.AUDIO_LOCATION+"but/"+(_this.text.b?2:Math.random(0,7))+".mp3"],loop:false,volume:.3})}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.END,end)}function start(){if(Utils.headsTails(0,1))HuntVFX.instance().flash(1e3,"easeInCubic");HuntVFX.instance().changeHue();_this.count++;if(_this.count>_this.max)letsgo();_unlock.pause();if(Utils.headsTails(0,1)){_ambience.volume(0);_click.play();clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(_=>{_click.pause();_ambience.volume(.1)},Math.random(300,1e3))}PageTitleGlitch.instance().console()}function end(){_click.pause()}function letsgo(){_this.count=0;_unlock.seek(0);_unlock.play();console.log("%c "+_this.text.a+" ","background: #fff; border: 3px solid #000; font-size: 20px; color: #000;  padding: 15px;");let confirmation;if(_this.text.b)confirmation=prompt(_this.text.a,_this.text.b);else confirmation=confirm(_this.text.a);if(confirmation)nextURL()}function nextURL(){let hi;if(Config.IDS[Global.HUNT_INDEX+1]){hi=`https://${Config.IDS[Global.HUNT_INDEX+1].out}.${a}${a}${a}${a}${a}.com`}else{let i=Config.IDS[Math.random(0,Config.IDS.length-5)];let id=i.id;if(Utils.headsTails(0,1))hi=`https://${i.out}.${a}${a}${a}${a}${a}.com`;else hi="/"+"k"+"d"+ess+"c"+"v"+que}open(hi,"_self")}function playSound(){PageTitleGlitch.instance().showAngel();VFX.instance().flash();_audio.pause();_audio.seek(0);_audio.play()}});Class(function HuntVideo(){Inherit(this,Object3D);const _this=this;var _video,_shader,_mesh;var _texture1,_texture2;var _delta=new Vector2;var _delta2=new Vector2;(function(){initVideo();initShader();initMesh();_this.delayedCall(addHandlers,Math.random(0,4e3))}());function initVideo(){let src="assets/videos/"+Global.HUNT_ID+".mp4";_video=_this.initClass(VideoTexture,src);_video.start()}function initShader(){_texture1=Utils3D.getRepeatTexture("assets/images/textures/"+Math.random(0,15)+".jpg");_texture2=Utils3D.getRepeatTexture("assets/images/textures/"+Math.random(0,15)+".jpg");_shader=_this.initClass(Shader,"HuntVideo",{uResolution:World.RESOLUTION,uTime:World.TIME,uMask:{value:""},uTexture:{value:_texture1},uDimensions:World.RESOLUTION,uScale:{value:Utils.headsTails(0,1)?1:Math.random(.8,1.2,3)},uAlpha:{value:1},uAddNoise:{value:Math.random(0,1,3)},uDelta:{value:0},uGlitch:{value:0},uGlitchScale:{value:Math.random(.5,1.5,3)},uImageMix:{value:0},uImageMouse:{value:Utils.headsTails(0,1)},uUseMouse:{value:Utils.headsTails(0,1)},uWarpMouse:{value:1},uVideo:{value:_video.texture},transparent:true,depthWrite:false,depthTest:false,blending:THREE.AdditiveBlending})}function initMesh(){_mesh=new THREE.Mesh(World.QUAD,_shader.material);_this.group.add(_mesh)}function loop(){let check=!Device.mobile||_this.touching?Mouse.delta.length():0;_this.delta=check*.1;_this.delta=Math.clamp(_this.delta-.1,0,.3);_shader.set("uDelta",_this.delta)}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.END,end);_this.startRender(loop);_shader.set("uMask",CursorMask.instance().texture);_shader.set("uVideo",_video.texture)}function start(){_this.touching=true;_video.start();_shader.set("uGlitchScale",Math.random(.5,1.5,3));_shader.set("uGlitch",Utils.headsTails(0,1));_shader.set("uUseMouse",Utils.headsTails(0,1));_shader.set("uImageMix",Utils.headsTails(0,1));clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(_=>{_shader.set("uGlitch",0);_shader.set("uImageMix",0);_this.delta=0;_this.touching=false},Math.random(200,500))}function end(){_this.touching=false;_this.delta=0;_shader.set("uAddNoise",Math.random(0,1,3));_shader.set("uVideo",Utils.headsTails(0,1)?_texture2:_video.texture)}this.animateIn=function(){}});Class(function LandingScene(){Inherit(this,Object3D);const _this=this;var _spinner,_logo,_tunnel,_cta,_orb;(function(){initElements()}());function initElements(){_spinner=_this.initClass(LandingSpinner);_logo=_this.initClass(LandingLogo);_tunnel=_this.initClass(LandingTunnel,.58);_cta=_this.initClass(LandingCTA);_orb=_this.initClass(LandingOrb);World.SCENE.add(_this.group)}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.END,end)}function start(){if(!_this.visible||_this.clicked)return;_this.clicked=true;_this.events.unsub(Mouse.input,Interaction.START,end);_this.events.unsub(Mouse.input,Interaction.END,end);_spinner.down=true;_logo.shader.tween("uOpacity",0,2e3,"easeOutCubic");_cta.down();_orb.hold();tween(_spinner.group.position,{z:-.3},2e3,"easeOutCubic");clearTimeout(_this.timeout);_cta.animateOut();_this.delayedCall(function(){_this.events.fire(VirtualSelfEvents.ENTER)},2e3)}function end(){if(!_this.visible||_this.clicked)return;clearTimeout(_this.timeout);_spinner.down=false;_cta.up();_orb.release();_logo.shader.tween("uOpacity",1,2e3,"easeOutCubic");tween(_spinner.group.position,{z:0},2e3,"easeOutCubic")}function showCTA(){_this.showingCTA=true;_cta.animateIn();_this.visible=true;addHandlers()}this.animateIn=function(){_this.delayedCall(_=>{_this.canShowCTA=true;if(!_this.showingCTA&&_this.loaded)showCTA()},4e3);Dust.instance().move(2,"easeOutSine",5e3);_spinner.animateIn();_logo.animateIn();_orb.animateIn()};this.loadComplete=function(){_this.loaded=true;if(!_this.showingCTA&&_this.canShowCTA)showCTA()};this.animateOut=function(callback){_this.visible=false;_spinner.down=false;_spinner.animateOut();_logo.animateOut();_orb.enter();Dust.instance().move(-12,"easeInOutQuad");_tunnel.animateIn(function(){_this.group.visible=false;World.SCENE.remove(_this.group);callback()})}});Class(function LandingView(){Inherit(this,Element);const _this=this;const $this=this.element;var $prompt,$line;(function(){initHTML();initPrompt();initLine();addHandlers()}());function initHTML(){$this.size(140,25).center(1,0).css({bottom:40});$this.invisible()}function initPrompt(){$prompt=$this.create("Prompt");$prompt.html(Device.mobile?"touch & hold":"click & hold");$prompt.fontStyle("serif",Device.mobile.phone?12:14,"#fff");$prompt.css({width:"100%",lineHeight:"1.4em",letterSpacing:3,opacity:0,fontStyle:"italic",textAlign:"center"})}function initLine(){$line=$this.create(".line");$line.size("100%",2).css({bottom:0,opacity:.4}).bg("#fff")}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.END,end)}function start(){$line.tween({scaleX:0},2e3,"easeOutSine")}function end(){$line.tween({scaleX:1},2e3,"easeOutCubic")}this.loadComplete=function(){$line.transform({scaleX:0}).tween({scaleX:1},2e3,"easeInOutCubic",1e3);$this.visible();$prompt.css({opacity:0}).tween({opacity:.6},5e3,"easeInOutSine",200)};this.animateOut=function(callback){_this.events.unsub(Mouse.input,Interaction.START,start);_this.events.unsub(Mouse.input,Interaction.END,end);$this.tween({opacity:0},500,"easeOutSine",callback)}});Class(function LandingCTA(){Inherit(this,Object3D);const _this=this;var _canvas,_context,_shader,_mesh,_box;var _tween1,_tween2,_tween3,_tween4;(function(){initCanvas();initShader();initMesh();initBox();draw()}());function initCanvas(){_canvas=new Canvas(512,512);_context=_canvas.context;_context.fillStyle="#fff";_this.texture=new THREE.Texture(_canvas.div)}function initShader(){_shader=_this.initClass(Shader,"CharacterInfo",{uMap:{value:_this.texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uOpacity:{value:0},uHovered:{value:0},uHue:{value:.6},uMask:{value:CursorMask.instance().texture},transparent:true,depthWrite:false,depthTest:false,blending:THREE.AdditiveBlending})}function initBox(){let material=new THREE.MeshBasicMaterial({color:16777215,transparent:true,blending:THREE.AdditiveBlending,opacity:0});_box=new THREE.Mesh(World.PLANE,material);_box.material=material;_box.scale.set(.0001,.002,1);_box.position.y=-.006}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_this.group.position.z=-1.5;_this.group.position.y=-.28;_mesh.scale.setScalar(Device.mobile?.2:.15);_this.add(_mesh)}function draw(){_context.fillStyle="#000";_context.fillRect(0,0,_canvas.width,_canvas.height);_context.textAlign="center";_context.font="italic bold 40px Serif";_context.fillStyle="#fff";_context.fillText(addSpaces(Device.mobile?"Tap to enter":"Click to enter"),256,256-20);_this.texture.needsUpdate=true}function addSpaces(s){let letters=s.split("");let string="";letters.forEach(letter=>{string+=letter+" "});return string}this.setHue=function(hue){_shader.set("uHue",hue)};this.down=function(){_tween3&&_tween3.stop&&_tween3.stop();_tween3=tween(_box.scale,{x:.00001},2e3,"easeOutSine")};this.up=function(){_tween3&&_tween3.stop&&_tween3.stop();_tween3=tween(_box.scale,{x:.13},2e3,"easeOutCubic")};this.animateIn=function(){draw();_this.group.scale.x=1.5;_this.group.scale.y=.5;_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween3&&_tween3.stop&&_tween3.stop();_tween4&&_tween4.stop&&_tween4.stop();_tween1=tween(_this.group.scale,{x:1,y:1},4e3,"easeOutCubic");_tween2=_shader.tween("uOpacity",1,25e2,"easeOutCubic");_tween3=tween(_box.scale,{x:.13},25e2,"easeOutCubic");_tween4=tween(_box.material,{opacity:.4},2e3,"easeOutSine")};this.animateOut=function(){_tween1&&_tween1.stop&&_tween1.stop();_tween2&&_tween2.stop&&_tween2.stop();_tween3&&_tween3.stop&&_tween3.stop();_tween1=tween(_this.group.scale,{x:1.2},1e3,"easeOutCubic");_tween2=_shader.tween("uOpacity",0,1e3,"easeOutCubic");_tween3=tween(_box.scale,{x:.00001},1e3,"easeOutCubic");_tween4=tween(_box.material,{opacity:0},1e3,"easeOutSine")}});Class(function LandingLogo(){Inherit(this,Object3D);var _this=this;var _shader,_mesh;(function(){initShader();initMesh()}());function initShader(){_shader=_this.initClass(Shader,"LandingLogo",{uMap:{value:Utils3D.getTexture("assets/images/intro/logo.jpg")},uDimensions:World.RESOLUTION,uOpacity:{value:0},uTime:World.TIME,uMask:{value:CursorMask.instance().texture},transparent:true,depthWrite:false,depthTest:false,blending:THREE.AdditiveBlending});CursorMask.instance();_this.shader=_shader}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.scale.setScalar(.8);_mesh.position.z=-1.5;_this.add(_mesh)}function loop(){}this.animateIn=function(){_this.group.position.z=2;tween(_this.group.position,{z:0},8e3,"easeOutExpo");_this.group.scale.x=2;tween(_this.group.scale,{x:1},6e3,"easeOutSine");_shader.tween("uOpacity",1,6e3,"easeInOutCubic")};this.animateOut=function(){_shader.tween("uOpacity",0,1e3,"easeInCubic",function(){_this.group.visible=false});tween(_this.group.position,{z:.5},1e3,"easeInCubic")}});Class(function LandingOrb(){Inherit(this,Object3D);const _this=this;let _shader,_mesh,_glowShader;let _cont=new THREE.Group;_this.add(_cont);let _velocity=0;let _delta=0;var _mouse=new Vector2;let _anim={hold:0,intro:2,tumble:0};(function(){initMesh();initGlow()}());function initMesh(){let geometry=Utils3D.loadBufferGeometry("geometry/landing/orb");_shader=_this.initClass(Shader,"LandingOrb",{uResolution:World.RESOLUTION,uTime:World.TIME,uMask:{value:CursorMask.instance().texture},uAlpha:{value:0},uNormal:{value:Utils3D.getTexture("assets/images/orb/world-normals.jpg")},uEnv:{value:Utils3D.getRepeatTexture("assets/images/orb/studio.jpg")},uTexture:{value:Utils3D.getRepeatTexture("assets/images/orb/gem.jpg")},uLogo:{value:Utils3D.getTexture("assets/images/intro/logo.jpg")},uLogoAlpha:{value:1},transparent:true,depthWrite:false,depthTest:false,blending:THREE.AdditiveBlending});_mesh=new THREE.Mesh(geometry,_shader.material);_cont.add(_mesh);_mesh.scale.setScalar(.032);_this.group.position.z=-1}function initGlow(){let geometry=new THREE.PlaneBufferGeometry(1,1);_glowShader=_this.initClass(Shader,"LandingOrbGlow",{uAlpha:{value:0},depthTest:false,depthWrite:false,transparent:true,blending:THREE.AdditiveBlending});let mesh=new THREE.Mesh(geometry,_glowShader.material);let s=.6;mesh.scale.set(s,1.6*s,s);mesh.position.z=-1;_this.add(mesh)}function loop(t){_mouse.lerp(Mouse.tilt,.1);_mesh.position.y=-.01+Math.sin(t*.001)*.005*(1-_anim.hold);_mesh.rotation.y+=Math.clamp(_mouse.x,-.3,.3)*.03;if(_anim.intro){_mesh.rotation.y+=_anim.intro*.02;_mesh.rotation.z=Math.sin(t*.0005)*1.2*_anim.intro;_mesh.rotation.x=Math.cos(t*.00032)*.8*_anim.intro}_cont.rotation.y=Math.sin(t*.001)*.1;_cont.rotation.z=Math.sin(t*.0015)*.1;_mesh.rotation.y+=.01*_anim.tumble;_mesh.rotation.z+=.03*_anim.tumble}this.animateIn=function(){_this.startRender(loop);_this.group.scale.setScalar(3.5);tween(_this.group.scale,{x:1,y:1,z:1},6e3,"easeOutCubic",2e3);_shader.tween("uAlpha",1,3e3,"easeInOutCubic",2e3);_glowShader.tween("uAlpha",1,3e3,"easeInOutCubic",2e3);tween(_anim,{intro:0},3e3,"easeOutCubic",2e3)};this.hold=function(){let s=.8;tween(_this.group.scale,{x:s,y:s,z:s},2e3,"easeOutCubic");_shader.tween("uAlpha",0,2e3,"easeOutSine");_glowShader.tween("uAlpha",0,2e3,"easeOutSine")};this.release=function(){tween(_this.group.scale,{x:1,y:1,z:1},2e3,"easeOutCubic");_shader.tween("uAlpha",1,2e3,"easeOutSine");_glowShader.tween("uAlpha",1,2e3,"easeOutSine")};this.enter=function(){_shader.tween("uLogoAlpha",0,1e3,"easeOutSine")}});Class(function LandingSpinner(){Inherit(this,Object3D);var _this=this;var _layers=[];var _wrapper=new THREE.Group;var _rotation=new Vector3;var _rotation2=new Vector3;(function(){Global.SPINNER=_this;initLayers()}());function initLayers(){let turns=[72,90,90,90,30,90,90,90,60,60,45,90,180];for(var i=1;i<13;i++){let shader=_this.initClass(Shader,"LandingSpinner",{uMap:{value:Utils3D.getTexture("assets/images/intro/"+i+".jpg")},uMask:{value:CursorMask.instance().texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uOpacity:{value:0},uAlpha:{value:0},transparent:true,depthTest:false,depthWrite:false,blending:THREE.AdditiveBlending});let mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.shader=shader;mesh.turn=turns[i];mesh.unlocked=new Vector3;mesh.unlocked.z=Math.random(0,Math.radians(i%2==0?-mesh.turn:mesh.turn),3);mesh.locked=new Vector3;mesh.move=new Vector3;mesh.alpha=0;mesh.scale.setScalar(Device.mobile.phone?1.2:1.4);_wrapper.add(mesh);_layers.push(mesh)}_this.add(_wrapper)}function loop(t){_wrapper.position.z=.5+Math.sin(t*.0005)*.1;if(Global.SCROLL_DELTA){_rotation.z+=Global.SCROLL_DELTA*.002;_rotation.x=Global.SCROLL_DELTA;_rotation2.lerp(_rotation,.1);_wrapper.rotation.z=_rotation2.z}_layers.forEach((layer,i)=>{let amount=.002;if(!_this.down)layer.unlocked.z+=i%2==0?-amount:amount;if(Math.abs(layer.unlocked.z)>Math.radians(layer.turn))layer.unlocked.z=0;layer.unlocked.x=i>1?.4+Math.sin(t*.001+i)*.4:0;layer.locked.x=.9;layer.move.lerp(_this.down?layer.locked:layer.unlocked,.03);layer.rotation.z=layer.move.z;layer.shader.set("uOpacity",layer.move.x)})}this.animateIn=function(seperate){_this.startRender(loop);_layers.forEach((layer,i)=>{layer.shader.tween("uAlpha",1,8e3,"easeOutSine");layer.position.z=.3+i*.3;tween(layer.position,{z:seperate?-2.5+i*.12:-2.5},12e3,"easeOutExpo")})};this.animateOut=function(){_this.stopRender(loop);_layers.forEach((layer,i)=>{layer.shader.set("uOpacity",1);layer.shader.tween("uAlpha",0,3e3,"easeInOutSine");tween(layer.position,{z:-2.5+i*.5},3e3,"easeInCubic");tween(layer.rotation,{z:0},1e3,"easeOutCubic")});tween(_this.group.position,{z:2},3e3,"easeInCubic",function(){_this.group.visible=false})}});Class(function LandingTunnel(_hue){Inherit(this,Object3D);const _this=this;var _shader;var _tunnel;_this.group.visible=false;(function(){initShader();initTunnel()}());function initShader(){_shader=_this.initClass(Shader,"LandingTunnel",{uMap:{value:Utils3D.getRepeatTexture("assets/images/tech.jpg")},uMask:{value:CursorMask.instance().texture},uDimensions:World.RESOLUTION,uTime:World.TIME,uHue:{value:_hue},uWarp:{value:0},uOpacity:{value:0},transparent:true,depthTest:false,depthWrite:false,blending:THREE.AdditiveBlending})}function initTunnel(){_tunnel=new THREE.Mesh(LandingTunnel.getGeometry(),_shader.material);let s=1.2;_tunnel.scale.set(s,2,s);_tunnel.position.z=-12;_tunnel.rotation.x=Math.radians(-90);_this.add(_tunnel)}function loop(){}this.animateIn=function(callback,t){_this.group.visible=true;let max=17e3;let time=t||max;_shader.tween("uOpacity",1,time*.5,"easeInOutSine",function(){_shader.tween("uOpacity",0,time*.5,"easeInOutSine")});_shader.set("uWarp",Math.range(time,max,35e2,1,2));_shader.tween("uWarp",2,time*.9,"easeInOutQuint");_this.group.position.z=Math.range(time,max,35e2,-70,39);tween(_this.group.position,{z:39},time,"easeOutQuart",callback)}},()=>{let _geometry;LandingTunnel.getGeometry=function(index){if(!_geometry){_geometry=new THREE.CylinderGeometry(1,1,30,32,1,true);for(var i=0;i<_geometry.faces.length;i++){var face=_geometry.faces[i];var temp=face.a;face.a=face.c;face.c=temp}_geometry.computeFaceNormals();_geometry.computeVertexNormals();var faceVertexUvs=_geometry.faceVertexUvs[0];for(var i=0;i<faceVertexUvs.length;i++){var temp=faceVertexUvs[i][0];faceVertexUvs[i][0]=faceVertexUvs[i][2];faceVertexUvs[i][2]=temp}}return _geometry}});Class(function LoaderView(){Inherit(this,Element);const _this=this;const $this=this.element;let $text,$bar;var _perc=new Vector2;var _perc2=new Vector2;(function(){initHTML();initBar();_this.startRender(loop)}());function initHTML(){$this.size("100%").css({background:"#000"}).setZ(1e3)}function initBar(){$bar=$this.create(".bar");$bar.width=180;$bar.height=20;$bar.size($bar.width,$bar.height).center().css({border:"1px solid #eee"});$bar.inner=$bar.create("inner");$bar.inner.size($bar.width-8,$bar.height-8).center().bg("#eee");$bar.inner.transform({scaleX:0}).transformPoint("0%","50%")}function loop(){_perc2.lerp(_perc,.1);$bar.inner.scaleX=_perc2.x;$bar.inner.transform()}this.progress=function(e){_perc.x=e.percent};this.animateOut=function(callback){_this.stopRender(loop);$bar.inner.tween({scaleX:1},200,"easeOutSine");$this.tween({opacity:0},400,"easeInOutSine",300).onComplete(()=>callback&&callback());$bar.tween({scaleY:0},300,"easeOutSine",300)}});Class(function TourScene(){Inherit(this,Object3D);const _this=this;var _spinner,_tunnel,_interaction;(function(){initElements();addHandlers()}());function initElements(){_spinner=_this.initClass(LandingSpinner,.05);_tunnel=_this.initClass(LandingTunnel,.58);World.SCENE.add(_this.group);_spinner.group.rotation.y=Math.radians(-28);_spinner.group.position.x=Device.mobile.phone?-.55:-.5;_spinner.group.position.z-=1}function addHandlers(){_interaction=_this.initClass(TourInteraction)}this.animateIn=function(){Dust.instance().move(2,"easeOutSine",5e3);_spinner.animateIn(true)};this.loadComplete=function(){_this.loaded=true};this.animateOut=function(callback){_this.visible=false;_spinner.down=false;_spinner.animateOut();Dust.instance().move(-12,"easeInOutQuad");_tunnel.animateIn(function(){_this.group.visible=false;World.SCENE.remove(_this.group);callback()})}});Class(function UITourView(){Inherit(this,Element);const _this=this;const _angle=Device.mobile.phone?0:21.97707;const _width=Device.mobile.phone?300:700;var $this,$container,$wrapper,$skewTop,$logo,$utopia,$skewBottom;var _scroll,_corners,_signup,_config;var _lineShift=0;var _height=0;var _offset=0;var _progress=0;var _items=[];var _top;(function(){initData();initHTML();initWrapper();initCorners();if(Device.mobile.phone){initLogo();initTop()}else{initTop();initLogo()}initBottom();initSignup();initScroll();addListeners();_this.delayedCall(resize,100);_this.startRender(loop)}());function initData(){_config=TourData.instance().formatEvents()}function initHTML(){$this=_this.element;$this.size("100%").css({textAlign:"center",fontSize:0,opacity:0});Stage.add($this)}function initWrapper(){$container=$this.create("container");$container.size("100%","calc(100% - 60px)");$wrapper=$container.create("wrapper");$wrapper.size(_width,"auto").css({position:"relative",display:"inline-block"})}function initCorners(){_corners=_this.initClass(UITourCorners)}function initTop(){$skewTop=$wrapper.create("skew-top");$skewTop.size(_width,"auto").css({position:"relative",display:"inline-block",transformOrigin:"bottom left",paddingTop:Device.mobile.phone?0:100});if(_angle!==0)$skewTop.transform({skewX:-_angle});let items=_config.slice(0,Math.floor(_config.length/2)+_lineShift);items.forEach(data=>{_items.push(_this.initClass(UITourItem,data,[$skewTop]))})}function initLogo(){$logo=$wrapper.create("logo");$logo.size(_width,200).bg("assets/images/logo.svg").css({position:"relative",display:"inline-block",marginTop:Device.mobile.phone?75:0,marginBottom:Device.mobile.phone?75:0});$utopia=$logo.create("utopia").bg("assets/images/tour/utopia-system.png","contain").size(401,58);if(Device.mobile.phone)$utopia.css({left:"30%",bottom:0}).size(200,29).css({backgroundRepeat:"no-repeat",backgroundPosition:"right center"});else $utopia.css({top:"100%",right:"15%"});if(Tests.textShadow())$logo.css({filter:`drop-shadow(0 0 ${5}px white)`})}function initBottom(){$skewBottom=$wrapper.create("skew-bottom");$skewBottom.size(_width,"auto").css({position:"relative",display:"inline-block",transformOrigin:"top left",paddingBottom:100});if(_angle!==0)$skewBottom.transform({skewX:_angle});let items=_config.slice(Math.floor(_config.length/2)+_lineShift);items.forEach(data=>{_items.push(_this.initClass(UITourItem,data,[$skewBottom]))})}function initScroll(){if(Device.mobile.phone){$container.overflowScroll({y:1,x:0})}else{_scroll=_this.initClass(Scroll,$container)}}function initSignup(){_signup=_this.initClass(UITourSignup)}function loop(){if(Device.mobile.phone){let top=$container.div.scrollTop;Global.SCROLL_DELTA=(top-_this.last)*1.4;_this.last=top}else{if(_top===_scroll.y)return;Global.SCROLL_DELTA=_scroll.delta.y;_top=_scroll.y;_progress=Math.abs((_top+Stage.height*.5)/_height-.5);if(!Device.mobile.phone){$wrapper.x=-_offset*_progress;$wrapper.transform()}}}function addListeners(){_this.events.sub(Events.RESIZE,resize)}function resize(){_height=$wrapper.div.offsetHeight;_offset=Math.sin(Math.radians(_angle+1.7125))*_height;let logoWidth=Math.max(Math.min(Stage.width-60,13e2),300);$logo.size(logoWidth,100).css({left:-(logoWidth-_width)/2});if(_height===0)_this.delayedCall(resize,100);if(Device.mobile.phone)_offset=0;if(_scroll)_scroll.resize()}this.animateIn=function(){_top=-1;resize();_corners.animateIn();$this.css({opacity:0}).tween({opacity:1},4e3,"easeInOutSine",15e2,_=>{resize()})};this.fillScreen=function(){$container.size("100%")}},"singleton");Class(function UITourButton(_data){Inherit(this,Element);const _this=this;var $this,$copy,$bg;var _canout;(function(){initHTML();initBG();initCopy();addListeners()}());function initHTML(){$this=_this.element;$this.size(100,35).css({fontWeight:"bold",verticalAlign:"middle",padding:"7px 15px",boxSizing:"border-box",border:"3px solid white",position:"relative",display:"inline-block",textAlign:"center"});if(Device.mobile.phone)$this.css({marginRight:10,marginTop:10});else $this.css({marginLeft:10})}function initBG(){$bg=$this.create("bg").bg("white").size("100%").transform({scaleX:0}).css({transformOrigin:"left center",top:0,left:0})}function initCopy(){$copy=$this.create("copy");$copy.fontStyle("eurostile-extended",11,"white").css({position:"relative",display:"inline-block",textTransform:"uppercase"});$copy.text(_data.text)}function noLink(){if(_data.text==="rsvp")return _data.event.rsvp;else if(_data.text==="buy")return _data.event.buy;else return true}function addListeners(){if(_data.disabled||!noLink()){$this.css({opacity:.3})}else{$this.interact(hover,click)}}function hover(e){if(_data.event)e.event=_data.event;_this.events.fire(Events.HOVER,e);let tr,st,tw,d;if(Global.HOVER_TIMEOUT)clearTimeout(Global.HOVER_TIMEOUT);switch(e.action){case"over":if(_canout)return;Global.SPINNER.down=true;d=Mouse.delta;_canout=Promise.create();if(Math.abs(d.x)>Math.abs(d.y)){st={transformOrigin:d.x<0?"right center":"left center"};tr={scaleY:1,scaleX:0};tw={scaleX:1}}else{st={transformOrigin:d.y>0?"center top":"center bottom"};tr={scaleX:1,scaleY:0};tw={scaleY:1}}$bg.transform(tr).css(st).tween(tw,150,"easeOutCubic").onComplete(_canout.resolve);$copy.tween({color:"black"},150,"easeOutCubic");break;case"out":d=Mouse.delta;_canout.then(()=>{_canout=null;if(Math.abs(d.x)>Math.abs(d.y)){st={transformOrigin:d.x>0?"right center":"left center"};tw={scaleX:0}}else{st={transformOrigin:d.y<0?"center top":"center bottom"};tw={scaleY:0}}$bg.css(st).tween(tw,400,"easeOutCubic");$copy.tween({color:"white"},400,"easeOutCubic")});Global.HOVER_TIMEOUT=_this.delayedCall(_=>{Global.SPINNER.down=false},200);break}}function click(){_this.events.fire(Events.CLICK)}});Class(function UITourCorners(){Inherit(this,Element);const _this=this;var $this;var $tl,$tr,$bl,$br,$club;var _elements;(function(){initHTML();initCorners()}());function initHTML(){$this=_this.element;$this.css({position:"static"}).invisible()}function initCorners(){let padding=15;let offset=Device.mobile.phone?60:0;let scale=Device.mobile.phone?.6:1;$tl=$this.create("self");$tl.bg("assets/images/tour/self.png").size(183*scale,71*scale).css({top:padding,left:padding,backgroundRepeat:"no-repeat"});$tr=$this.create("conciousness");$tr.bg("assets/images/tour/conciousness.png").size(111*scale,61*scale).css({top:padding,right:padding,backgroundRepeat:"no-repeat"});$bl=$this.create("neofantasy");$bl.bg("assets/images/tour/neofantasy.png").size(175*scale,77*scale).css({bottom:padding+offset-Device.mobile.phone?60:0,left:padding,backgroundRepeat:"no-repeat"});$br=$this.create("virtual");$br.bg("assets/images/tour/virtual.png").size(84*scale,73*scale).css({bottom:padding+offset,right:padding,backgroundRepeat:"no-repeat"});let bottom=padding+offset-Device.mobile.phone?140:0+140*scale;$club=$this.create(".club");$club.fontStyle("Helvetica",12*scale,"#fff");$club.size(175*scale,12*scale).css({bottom,left:padding,backgroundRepeat:"no-repeat",textAlign:"left",whiteSpace:"nowrap"});$club.html("more west coast dates coming soon <br /><br/> CLUBSYSTEM = intimate club show <br/> // or show without custom stage setup");_elements=[$tl,$tr,$bl,$club,$br]}this.animateIn=function(){$this.visible();_elements.forEach($element=>{$element.css({opacity:0}).tween({opacity:1},2e3,"easeInOutSine",Math.random(15e2,5e3))})}});Class(function TourInteraction(){Inherit(this,Component);const _this=this;let _text="";var _audio,_timeout;(function(){initAudio();addHandlers()}());function initAudio(){_audio=new Howl({src:[Config.AUDIO_LOCATION+Config.ANGEL_PREVIEW.id+".mp3"],loop:false,volume:.4})}function addHandlers(){if(Device.mobile){_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.END,end)}else{_this.events.sub(KeyboardUtil.DOWN,press)}}function press(e){if(e.key)_text+=e.key;if(_text.includes("angel")){_text="";playSound()}}function start(){clearTimeout(_timeout);_timeout=_this.delayedCall(playSound,2e3)}function end(){clearTimeout(_timeout)}function playSound(){PageTitleGlitch.instance().showAngel();VFX.instance().flash();_audio.pause();_audio.seek(0);_audio.play()}});Class(function UITourItem(_data){Inherit(this,Element);const _this=this;var $this,$month,$state,$shows;var _shadow=5;(function(){initHTML();initMonth();initState();initEvent();addListeners()}());function initHTML(){$this=_this.element;$this.size("100%","auto").css({textTransform:"uppercase",fontWeight:"bold",position:"relative",textAlign:"left"})}function initMonth(){if(!_data.month)return;$month=$this.create("month");$month.css({position:"relative",display:"inline-block",padding:"15px 0",marginLeft:25});$month.pre=$month.create("pre");$month.copy=$month.create("copy");$month.post=$month.create("post");$month.pre.css({borderLeft:"10px solid white",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",right:"100%",top:"50%",marginTop:-10,marginRight:10});$month.post.css({borderRight:"10px solid white",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",left:"100%",top:"50%",marginTop:-10,marginLeft:10});$month.copy.fontStyle("eurostile-extended",Device.mobile.phone?18:28,"white").css({position:"relative",display:"inline-block"});$month.copy.text(_data.month);if(Tests.textShadow())$month.css({filter:`drop-shadow(0 0 ${_shadow}px white)`})}function initState(){if(!_data.state)return;$state=$this.create("state");$state.fontStyle("eurostile-extended",Device.mobile.phone?90:120,"transparent").css({position:"relative",display:"block",padding:"15px 0"});$state.textStroke(4,"white");$state.text(_data.state);if(Tests.textShadow())$state.css({filter:`drop-shadow(0 0 ${_shadow}px white)`})}function initEvent(){if(!_data.event)return;$shows=$this.create("shows");$shows.css({position:"relative",display:"block"});_this.initClass(UITourShow,_data.event,[$shows]);if(Tests.textShadow())$shows.css({filter:`drop-shadow(0 0 ${_shadow}px white)`})}function addListeners(){if(_data.event)return;_this.events.sub(VirtualSelfEvents.TOUR_HOVER,_data.state?hoverState:hoverMonth)}function hoverState(e){if(e.action==="over"&&e.event.state!==_data.state){$this.tween({opacity:.35},400,"easeOutCubic")}else{$this.tween({opacity:1},400,"easeOutCubic",100)}}function hoverMonth(e){let eMonth=e.event.showtime.split("-")[1];let tMonth=_data.month.split(".")[0];if(e.action==="over"&&eMonth!==tMonth){$this.tween({opacity:.35},400,"easeOutCubic")}else{$this.tween({opacity:1},400,"easeOutCubic",100)}}});Class(function UITourShow(_data){Inherit(this,Element);const _this=this;var $this,$show;var _rsvp,_buy;(function(){initHTML();if(Device.mobile.phone){initShow();initRSVP();initBuy()}else{initRSVP();initBuy();initShow()}addListeners()}());function initHTML(){$this=_this.element;$this.css({position:"relative",display:"block",padding:"5px 0"});if(Device.mobile.phone)$this.css({paddingTop:15})}function initShow(){$show=$this.create("show");$show.fontStyle("eurostile-extended",12,"white").css({whiteSpace:"pre-wrap",marginTop:3,verticalAlign:"middle",position:"relative",paddingLeft:10,display:Device.mobile.phone?"block":"inline-block"});let date1,date2;date1=_data.showtime.split("-");if(_data.showend)date2=_data.showend.split("-");let text=`${date1[1]}.${date1[2]}${date2?` - ${date2[1]}.${date2[2]}`:""}  ${_data.stage}  ${_data.city}, ${_data.state}`;if(Device.mobile.phone)text=text.split("  ").join("\n");$show.text(text)}function initRSVP(){_rsvp=_this.initClass(UITourButton,{text:"rsvp",event:_data,disabled:_data.soldOut})}function initBuy(){_buy=_this.initClass(UITourButton,{text:"buy",event:_data,disabled:_data.soldOut})}function addListeners(){_this.events.sub(VirtualSelfEvents.TOUR_HOVER,hover);if(_rsvp){_this.events.sub(_rsvp,Events.CLICK,_=>{open(_data.rsvp)});_this.events.sub(_rsvp,Events.HOVER,e=>{_this.events.fire(VirtualSelfEvents.TOUR_HOVER,e)})}if(_buy){_this.events.sub(_buy,Events.CLICK,_=>{open(_data.buy)});_this.events.sub(_buy,Events.HOVER,e=>{_this.events.fire(VirtualSelfEvents.TOUR_HOVER,e)})}}function hover(e){if(e.action==="over"&&e.event.perma!==_data.perma){$this.tween({opacity:.35},400,"easeOutCubic")}else{$this.tween({opacity:1},400,"easeOutCubic",100)}}});Class(function UITourSignup(){Inherit(this,Element);const _this=this;var $this,$text,$out,$wrapper,$error;var _signup,_email,_zip,_submit;var _shadow=5;(function(){initHTML();initSignup();initWrapper();initText();initEmail();initZip();initSubmit();addListeners()}());function initHTML(){$this=_this.element;$this.css({left:0,bottom:0,right:0,height:60,textAlign:"center",boxSizing:"border-box",padding:12})}function initSignup(){if(!Device.mobile.phone)return;_signup=_this.initClass(UITourButton,{text:"Presale Sign Up"});if(Tests.textShadow())_signup.element.css({filter:`drop-shadow(0 0 ${_shadow}px white)`});_signup.element.css({width:"100%",marginTop:0});_this.events.sub(_signup,Events.CLICK,showSignup)}function initText(){if(Device.agent.includes("shield"))return;$text=$wrapper.create(".club");$text.fontStyle("eurostile-extended",12,"#fff");$text.size(100,12).center().css({marginLeft:-380,textAlign:"right",whiteSpace:"nowrap"});$text.text("Presale Signup")}function initWrapper(){$wrapper=$this.create("wrapper");$wrapper.css({position:"absolute",bottom:10,left:10,right:10,boxShadow:"0 0 10x 0 black"});if(!Device.mobile.phone)return;$this.setZ(2);defer(()=>{$wrapper.bg("black");$wrapper.y=150;$wrapper.transform();$out=UITourView.instance().element.create("out");$out.size("100%").bg("black").css({opacity:0}).setZ(1).hide();$out.interact(null,hideSignup)})}function initEmail(){_email=_this.initClass(UITourInput,{type:"email",label:"Email"},[$wrapper]);if(Tests.textShadow())_email.element.css({filter:`drop-shadow(0 0 ${_shadow}px white)`});if(!Device.mobile.phone)return;_email.element.css({display:"block",marginBottom:10,width:"100%",marginLeft:0})}function initZip(){_zip=_this.initClass(UITourInput,{type:"text",label:"Zip Code"},[$wrapper]);if(Tests.textShadow())_zip.element.css({filter:`drop-shadow(0 0 ${_shadow}px white)`});if(!Device.mobile.phone)return;_zip.element.css({display:"block",marginBottom:10,width:"100%",marginLeft:0})}function initSubmit(){_submit=_this.initClass(UITourButton,{text:"Submit"},[$wrapper]);if(Tests.textShadow())_submit.element.css({filter:`drop-shadow(0 0 ${_shadow}px white)`});if(!Device.mobile.phone)return;_submit.element.css({display:"block",marginBottom:10,width:"100%",marginLeft:0})}function invalid(message){if(!message.zip||!message.email)return true;return false}function error(message="Please enter both your email and zip code"){if($error)return;$error=$wrapper.create("error");if(Tests.textShadow())$error.css({filter:`drop-shadow(0 0 ${_shadow}px white)`});$error.invisible().fontStyle("eurostile-extended",11,"white").css({bottom:"100%",opacity:0,marginBottom:15,width:"100%",textAlign:"center"});$error.text(message);$error.visible().tween({opacity:1},250,"easeOutCubic");_this.delayedCall(_=>{$error.tween({opacity:0},250,"easeOutCubic",0,_=>{$error.destroy();$error=null})},4e3)}function addListeners(){_this.events.sub(_submit,Events.CLICK,submit)}function submit(){let message={email:_email.value,zip:_zip.value};let headers={"Content-Type":"application/json"};if(invalid(message))return error();_submit.element.tween({opacity:.5},250,"easeOutCubic");_this.events.unsub(_submit,Events.CLICK,submit);post(Config.MAILCHIMP,message,{headers}).then(result=>{if(!result.success){_this.events.sub(_submit,Events.CLICK,submit);_submit.element.css({opacity:1});return error(result.message)}hideSignup();_this.delayedCall(function(){_this.events.sub(_submit,Events.CLICK,submit);_submit.element.css({opacity:1})},500)})}function showSignup(){if(!Device.mobile.phone)return;$wrapper.tween({y:10},250,"easeOutCubic");_signup.element.hide();$out.show().tween({opacity:.66},250,"easeOutCubic")}function hideSignup(){$wrapper.tween({y:150},250,"easeOutCubic");_signup.element.show();if(!Device.mobile.phone)return;$out.tween({opacity:0},250,"easeOutCubic",0,_=>{$out.hide()})}});Class(function UITourInput(_config){Inherit(this,Element);const _this=this;var $this,$input,$label;var _value="";var _last="";var _expanded=true;(function(){initHTML();initLabel();initInput();addListeners()}());function initHTML(){$this=_this.element;$this.size(_config.size||200,35).css({position:"relative",display:"inline-block",verticalAlign:"middle",marginLeft:10})}function initInput(){$input=$this.create("input","input");$input.fontStyle("eurostile-extended",12,"white").size("100%").bg("transparent").css({borderRadius:0,padding:"0px 5px",left:0,top:0,boxSizing:"border-box",border:"3px solid white",outline:"none"});$input.attr("type",_config.type)}function initLabel(){$label=$this.create("label");$label.fontStyle("eurostile-extended",12,"white").size("100%").css({transformOrigin:"9px 0px",lineHeight:35,padding:"0 8px",left:0,top:0,boxSizing:"border-box",textAlign:"left"});$label.text(_config.label)}function loop(){_value=$input.div.value;if(_value===_last)return;if(_value.length===0)expand();else compact();_last=_value}function expand(){if(_expanded)return;$label.css({textTransform:"none",letterSpacing:"0em"}).tween({scale:1},100,"easeOutCubic");$input.css({padding:"0 5px"});_expanded=true}function compact(){if(!_expanded)return;$label.css({textTransform:"uppercase",letterSpacing:"0.05em"}).tween({scale:.5},100,"easeOutCubic");$input.css({padding:"7px 5px 0px"});_expanded=false}function addListeners(){$input.bind("focus",focus);$input.bind("blur",blur);$input.hover(hover)}function hover(e){switch(e.action){case"over":$input.tween({opacity:.7},200,"easeOutSine");break;case"out":$input.tween({opacity:1},200,"easeOutSine");break}}function focus(){$input.css({color:"black"});$label.css({color:"black"});$this.bg("white");_this.startRender(loop)}function blur(){$input.css({color:"white"});$label.css({color:"white"});$this.bg("transparent");_this.stopRender(loop)}this.get("value",_=>{return _value.trim()})});FX.Class(function Refract(){Inherit(this,FXScene);const _this=this;var $this;var _shader,_mesh;(function(){_this.create(World.NUKE);_this.wait(World.NUKE,"output").then(initMesh)}());function initMesh(){_shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:World.NUKE.output},depthWrite:false});_mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),_shader.material);_mesh.frustumCulled=false;_this.scene.add(_mesh);_this.startRender(loop)}function loop(){_this.draw()}},"singleton");Class(function Main(){(function(){if(!Device.graphics.webgl)window.location="https://virtualself.co/fallback.html";Mobile.Accelerometer.capture();init()}());function loadYT(){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}function init(){Hunt.instance()}});function onYouTubeIframeAPIReady(){let state=State.instance().getState();switch(state){case"virtualselfep"||Hydra.HASH=="virtualselfep"||Global.EP:EP.instance().initBG();break;case"tour"||Hydra.HASH=="tour"||Global.TOUR||Global.HUNT:break;default:Embed.instance();break}}
window._MINIFIED_ = true;
window._BUILT_ = true;
